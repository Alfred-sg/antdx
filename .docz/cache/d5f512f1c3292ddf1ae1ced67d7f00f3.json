{"remainingRequest":"/Users/alfred/Desktop/dvp/plutarch/node_modules/_thread-loader@2.1.2@thread-loader/dist/cjs.js??ref--5-1!/Users/alfred/Desktop/dvp/plutarch/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js??ref--5-2!/Users/alfred/Desktop/dvp/plutarch/node_modules/_source-map-loader@0.2.4@source-map-loader/index.js!/Users/alfred/Desktop/dvp/antdx/dist/antdx.js","dependencies":[{"path":"/Users/alfred/Desktop/dvp/antdx/dist/antdx.js","mtime":1546758634456},{"path":"/Users/alfred/Desktop/dvp/plutarch/node_modules/_cache-loader@3.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/alfred/Desktop/dvp/plutarch/node_modules/_thread-loader@2.1.2@thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/alfred/Desktop/dvp/plutarch/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/alfred/Desktop/dvp/plutarch/node_modules/_source-map-loader@0.2.4@source-map-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fc2lnbmF0dXJlX18gPSB0eXBlb2YgcmVhY3RIb3RMb2FkZXJHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gcmVhY3RIb3RMb2FkZXJHbG9iYWxbImRlZmF1bHQiXS5zaWduYXR1cmUgOiBmdW5jdGlvbiAoYSkgewogIHJldHVybiBhOwp9OwoKKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHsKICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgiUmVhY3QiKSwgcmVxdWlyZSgiYW50ZCIpKTtlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIGRlZmluZShbIlJlYWN0IiwgImFudGQiXSwgZmFjdG9yeSk7ZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSBleHBvcnRzWyJhbnRkeCJdID0gZmFjdG9yeShyZXF1aXJlKCJSZWFjdCIpLCByZXF1aXJlKCJhbnRkIikpO2Vsc2Ugcm9vdFsiYW50ZHgiXSA9IGZhY3Rvcnkocm9vdFsiUmVhY3QiXSwgcm9vdFsiYW50ZCJdKTsKfSkod2luZG93LCBmdW5jdGlvbiAoX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMjlfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNTBfXykgewogIHJldHVybiAoCiAgICAvKioqKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZXMpIHsKICAgICAgLy8gd2VicGFja0Jvb3RzdHJhcAoKICAgICAgLyoqKioqKi8KICAgICAgLy8gVGhlIG1vZHVsZSBjYWNoZQoKICAgICAgLyoqKioqKi8KICAgICAgdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCgogICAgICAvKioqKioqLwoKICAgICAgZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgICAgIC8qKioqKiovCgogICAgICAgIC8qKioqKiovCiAgICAgICAgLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCgogICAgICAgIC8qKioqKiovCiAgICAgICAgaWYgKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CiAgICAgICAgICAvKioqKioqLwogICAgICAgICAgcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7CiAgICAgICAgICAvKioqKioqLwogICAgICAgIH0KICAgICAgICAvKioqKioqLwogICAgICAgIC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCgogICAgICAgIC8qKioqKiovCgoKICAgICAgICB2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CiAgICAgICAgICAvKioqKioqLwogICAgICAgICAgaTogbW9kdWxlSWQsCgogICAgICAgICAgLyoqKioqKi8KICAgICAgICAgIGw6IGZhbHNlLAoKICAgICAgICAgIC8qKioqKiovCiAgICAgICAgICBleHBvcnRzOiB7fQogICAgICAgICAgLyoqKioqKi8KCiAgICAgICAgfTsKICAgICAgICAvKioqKioqLwoKICAgICAgICAvKioqKioqLwogICAgICAgIC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgoKICAgICAgICAvKioqKioqLwoKICAgICAgICBtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKICAgICAgICAvKioqKioqLwoKICAgICAgICAvKioqKioqLwogICAgICAgIC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQKCiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgbW9kdWxlLmwgPSB0cnVlOwogICAgICAgIC8qKioqKiovCgogICAgICAgIC8qKioqKiovCiAgICAgICAgLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKCiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgIC8qKioqKiovCiAgICAgIH0KICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCgogICAgICAvKioqKioqLwogICAgICAvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQoKICAgICAgLyoqKioqKi8KCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGUKCiAgICAgIC8qKioqKiovCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzCgogICAgICAvKioqKioqLwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24gKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewogICAgICAgIC8qKioqKiovCiAgICAgICAgaWYgKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsKICAgICAgICAgIC8qKioqKiovCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgewogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBnZXQ6IGdldHRlcgogICAgICAgICAgfSk7CiAgICAgICAgICAvKioqKioqLwogICAgICAgIH0KICAgICAgICAvKioqKioqLwoKICAgICAgfTsKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHMKCiAgICAgIC8qKioqKiovCgoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAgICAgICAvKioqKioqLwogICAgICAgIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHsKICAgICAgICAgIC8qKioqKiovCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7CiAgICAgICAgICAgIHZhbHVlOiAnTW9kdWxlJwogICAgICAgICAgfSk7CiAgICAgICAgICAvKioqKioqLwogICAgICAgIH0KICAgICAgICAvKioqKioqLwoKCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgICAgICAgdmFsdWU6IHRydWUKICAgICAgICB9KTsKICAgICAgICAvKioqKioqLwogICAgICB9OwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0CgogICAgICAvKioqKioqLwogICAgICAvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXQKCiAgICAgIC8qKioqKiovCiAgICAgIC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBucwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0CgogICAgICAvKioqKioqLwogICAgICAvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlCgogICAgICAvKioqKioqLwoKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uICh2YWx1ZSwgbW9kZSkgewogICAgICAgIC8qKioqKiovCiAgICAgICAgaWYgKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpOwogICAgICAgIC8qKioqKiovCgogICAgICAgIGlmIChtb2RlICYgOCkgcmV0dXJuIHZhbHVlOwogICAgICAgIC8qKioqKiovCgogICAgICAgIGlmIChtb2RlICYgNCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTsKICAgICAgICAvKioqKioqLwoKICAgICAgICB2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIC8qKioqKiovCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18ucihucyk7CiAgICAgICAgLyoqKioqKi8KCgogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7CiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgfSk7CiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgaWYgKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWVba2V5XTsKICAgICAgICAgIH0uYmluZChudWxsLCBrZXkpKTsKICAgICAgICB9CiAgICAgICAgLyoqKioqKi8KCiAgICAgICAgcmV0dXJuIG5zOwogICAgICAgIC8qKioqKiovCiAgICAgIH07CiAgICAgIC8qKioqKiovCgogICAgICAvKioqKioqLwogICAgICAvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcwoKICAgICAgLyoqKioqKi8KCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbiAobW9kdWxlKSB7CiAgICAgICAgLyoqKioqKi8KICAgICAgICB2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8KICAgICAgICAvKioqKioqLwogICAgICAgIGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7CiAgICAgICAgICByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107CiAgICAgICAgfSA6CiAgICAgICAgLyoqKioqKi8KICAgICAgICBmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgewogICAgICAgICAgcmV0dXJuIG1vZHVsZTsKICAgICAgICB9OwogICAgICAgIC8qKioqKiovCgogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsKICAgICAgICAvKioqKioqLwoKCiAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgICAgICAvKioqKioqLwogICAgICB9OwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KICAgICAgLy8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsCgogICAgICAvKioqKioqLwoKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uIChvYmplY3QsIHByb3BlcnR5KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsKICAgICAgfTsKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fCgogICAgICAvKioqKioqLwoKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18ucCA9ICIiOwogICAgICAvKioqKioqLwoKICAgICAgLyoqKioqKi8KCiAgICAgIC8qKioqKiovCiAgICAgIC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwoKICAgICAgLyoqKioqKi8KCiAgICAgIHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDUxKTsKICAgICAgLyoqKioqKi8KICAgIH0oCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIC8qKioqKiovCiAgICBbCiAgICAvKiAwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgdmFyIGNvcmUgPSBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICB2ZXJzaW9uOiAnMi42LjEnCiAgICAgIH07CiAgICAgIGlmICh0eXBlb2YgX19lID09ICdudW1iZXInKSBfX2UgPSBjb3JlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmCgogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvODYjaXNzdWVjb21tZW50LTExNTc1OTAyOAogICAgICB2YXIgZ2xvYmFsID0gbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGggPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGYgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jCiAgICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKICAgICAgaWYgKHR5cGVvZiBfX2cgPT0gJ251bWJlcicpIF9fZyA9IGdsb2JhbDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZgoKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHN0b3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNykoJ3drcycpOwoKICAgICAgdmFyIHVpZCA9IF9fd2VicGFja19yZXF1aXJlX18oMzgpOwoKICAgICAgdmFyIFN5bWJvbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSkuU3ltYm9sOwoKICAgICAgdmFyIFVTRV9TWU1CT0wgPSB0eXBlb2YgU3ltYm9sID09ICdmdW5jdGlvbic7CgogICAgICB2YXIgJGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlW25hbWVdIHx8IChzdG9yZVtuYW1lXSA9IFVTRV9TWU1CT0wgJiYgU3ltYm9sW25hbWVdIHx8IChVU0VfU1lNQk9MID8gU3ltYm9sIDogdWlkKSgnU3ltYm9sLicgKyBuYW1lKSk7CiAgICAgIH07CgogICAgICAkZXhwb3J0cy5zdG9yZSA9IHN0b3JlOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgICAgIHZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsKCiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKCiAgICAgIHZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgICAgIHZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCiAgICAgIHZhciAkZXhwb3J0ID0gZnVuY3Rpb24gJGV4cG9ydCh0eXBlLCBuYW1lLCBzb3VyY2UpIHsKICAgICAgICB2YXIgSVNfRk9SQ0VEID0gdHlwZSAmICRleHBvcnQuRjsKICAgICAgICB2YXIgSVNfR0xPQkFMID0gdHlwZSAmICRleHBvcnQuRzsKICAgICAgICB2YXIgSVNfU1RBVElDID0gdHlwZSAmICRleHBvcnQuUzsKICAgICAgICB2YXIgSVNfUFJPVE8gPSB0eXBlICYgJGV4cG9ydC5QOwogICAgICAgIHZhciBJU19CSU5EID0gdHlwZSAmICRleHBvcnQuQjsKICAgICAgICB2YXIgSVNfV1JBUCA9IHR5cGUgJiAkZXhwb3J0Llc7CiAgICAgICAgdmFyIGV4cG9ydHMgPSBJU19HTE9CQUwgPyBjb3JlIDogY29yZVtuYW1lXSB8fCAoY29yZVtuYW1lXSA9IHt9KTsKICAgICAgICB2YXIgZXhwUHJvdG8gPSBleHBvcnRzW1BST1RPVFlQRV07CiAgICAgICAgdmFyIHRhcmdldCA9IElTX0dMT0JBTCA/IGdsb2JhbCA6IElTX1NUQVRJQyA/IGdsb2JhbFtuYW1lXSA6IChnbG9iYWxbbmFtZV0gfHwge30pW1BST1RPVFlQRV07CiAgICAgICAgdmFyIGtleSwgb3duLCBvdXQ7CiAgICAgICAgaWYgKElTX0dMT0JBTCkgc291cmNlID0gbmFtZTsKCiAgICAgICAgZm9yIChrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAvLyBjb250YWlucyBpbiBuYXRpdmUKICAgICAgICAgIG93biA9ICFJU19GT1JDRUQgJiYgdGFyZ2V0ICYmIHRhcmdldFtrZXldICE9PSB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAob3duICYmIGhhcyhleHBvcnRzLCBrZXkpKSBjb250aW51ZTsgLy8gZXhwb3J0IG5hdGl2ZSBvciBwYXNzZWQKCiAgICAgICAgICBvdXQgPSBvd24gPyB0YXJnZXRba2V5XSA6IHNvdXJjZVtrZXldOyAvLyBwcmV2ZW50IGdsb2JhbCBwb2xsdXRpb24gZm9yIG5hbWVzcGFjZXMKCiAgICAgICAgICBleHBvcnRzW2tleV0gPSBJU19HTE9CQUwgJiYgdHlwZW9mIHRhcmdldFtrZXldICE9ICdmdW5jdGlvbicgPyBzb3VyY2Vba2V5XSAvLyBiaW5kIHRpbWVycyB0byBnbG9iYWwgZm9yIGNhbGwgZnJvbSBleHBvcnQgY29udGV4dAogICAgICAgICAgOiBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbCkgLy8gd3JhcCBnbG9iYWwgY29uc3RydWN0b3JzIGZvciBwcmV2ZW50IGNoYW5nZSB0aGVtIGluIGxpYnJhcnkKICAgICAgICAgIDogSVNfV1JBUCAmJiB0YXJnZXRba2V5XSA9PSBvdXQgPyBmdW5jdGlvbiAoQykgewogICAgICAgICAgICB2YXIgRiA9IGZ1bmN0aW9uIEYoYSwgYiwgYykgewogICAgICAgICAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgQykgewogICAgICAgICAgICAgICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEMoKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEMoYSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDKGEsIGIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQyhhLCBiLCBjKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBDLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBGW1BST1RPVFlQRV0gPSBDW1BST1RPVFlQRV07CiAgICAgICAgICAgIHJldHVybiBGOyAvLyBtYWtlIHN0YXRpYyB2ZXJzaW9ucyBmb3IgcHJvdG90eXBlIG1ldGhvZHMKICAgICAgICAgIH0ob3V0KSA6IElTX1BST1RPICYmIHR5cGVvZiBvdXQgPT0gJ2Z1bmN0aW9uJyA/IGN0eChGdW5jdGlvbi5jYWxsLCBvdXQpIDogb3V0OyAvLyBleHBvcnQgcHJvdG8gbWV0aG9kcyB0byBjb3JlLiVDT05TVFJVQ1RPUiUubWV0aG9kcy4lTkFNRSUKCiAgICAgICAgICBpZiAoSVNfUFJPVE8pIHsKICAgICAgICAgICAgKGV4cG9ydHMudmlydHVhbCB8fCAoZXhwb3J0cy52aXJ0dWFsID0ge30pKVtrZXldID0gb3V0OyAvLyBleHBvcnQgcHJvdG8gbWV0aG9kcyB0byBjb3JlLiVDT05TVFJVQ1RPUiUucHJvdG90eXBlLiVOQU1FJQoKICAgICAgICAgICAgaWYgKHR5cGUgJiAkZXhwb3J0LlIgJiYgZXhwUHJvdG8gJiYgIWV4cFByb3RvW2tleV0pIGhpZGUoZXhwUHJvdG8sIGtleSwgb3V0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07IC8vIHR5cGUgYml0bWFwCgoKICAgICAgJGV4cG9ydC5GID0gMTsgLy8gZm9yY2VkCgogICAgICAkZXhwb3J0LkcgPSAyOyAvLyBnbG9iYWwKCiAgICAgICRleHBvcnQuUyA9IDQ7IC8vIHN0YXRpYwoKICAgICAgJGV4cG9ydC5QID0gODsgLy8gcHJvdG8KCiAgICAgICRleHBvcnQuQiA9IDE2OyAvLyBiaW5kCgogICAgICAkZXhwb3J0LlcgPSAzMjsgLy8gd3JhcAoKICAgICAgJGV4cG9ydC5VID0gNjQ7IC8vIHNhZmUKCiAgICAgICRleHBvcnQuUiA9IDEyODsgLy8gcmVhbCBwcm90byBtZXRob2QgZm9yIGBsaWJyYXJ5YAoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAkZXhwb3J0OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIV9fd2VicGFja19yZXF1aXJlX18oMTQpKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAnYScsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0KICAgICAgICB9KS5hICE9IDc7CiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICBpZiAoIWlzT2JqZWN0KGl0KSkgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYW4gb2JqZWN0IScpOwogICAgICAgIHJldHVybiBpdDsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBkUCA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOwoKICAgICAgdmFyIGNyZWF0ZURlc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KSA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gZFAuZihvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpOwogICAgICB9IDogZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQ7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIHRvIGluZGV4ZWQgb2JqZWN0LCB0b09iamVjdCB3aXRoIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgc3RyaW5ncwogICAgICB2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMzApOwoKICAgICAgdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIElPYmplY3QoZGVmaW5lZChpdCkpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGl0ID09PSAnb2JqZWN0JyA/IGl0ICE9PSBudWxsIDogdHlwZW9mIGl0ID09PSAnZnVuY3Rpb24nOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIHZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIGtleSkgewogICAgICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgSUU4X0RPTV9ERUZJTkUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzKTsKCiAgICAgIHZhciB0b1ByaW1pdGl2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzIpOwoKICAgICAgdmFyIGRQID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogICAgICBleHBvcnRzLmYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpID8gT2JqZWN0LmRlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewogICAgICAgIGFuT2JqZWN0KE8pOwogICAgICAgIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsKICAgICAgICBhbk9iamVjdChBdHRyaWJ1dGVzKTsKICAgICAgICBpZiAoSUU4X0RPTV9ERUZJTkUpIHRyeSB7CiAgICAgICAgICByZXR1cm4gZFAoTywgUCwgQXR0cmlidXRlcyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgLyogZW1wdHkgKi8KICAgICAgICB9CiAgICAgICAgaWYgKCdnZXQnIGluIEF0dHJpYnV0ZXMgfHwgJ3NldCcgaW4gQXR0cmlidXRlcykgdGhyb3cgVHlwZUVycm9yKCdBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCEnKTsKICAgICAgICBpZiAoJ3ZhbHVlJyBpbiBBdHRyaWJ1dGVzKSBPW1BdID0gQXR0cmlidXRlcy52YWx1ZTsKICAgICAgICByZXR1cm4gTzsKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0ge307CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICB2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoaXQpLnNsaWNlKDgsIC0xKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiAhIWV4ZWMoKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gb3B0aW9uYWwgLyBzaW1wbGUgY29udGV4dCBiaW5kaW5nCiAgICAgIHZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZuLCB0aGF0LCBsZW5ndGgpIHsKICAgICAgICBhRnVuY3Rpb24oZm4pOwogICAgICAgIGlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjsKCiAgICAgICAgc3dpdGNoIChsZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIsIGMpOwogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpCiAgICAgICAgLyogLi4uYXJncyAqLwogICAgICAgIHsKICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDE2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICBpZiAodHlwZW9mIGl0ICE9ICdmdW5jdGlvbicpIHRocm93IFR5cGVFcnJvcihpdCArICcgaXMgbm90IGEgZnVuY3Rpb24hJyk7CiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxNyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBfT2JqZWN0JGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9fd2VicGFja19yZXF1aXJlX18oNTQpOwoKICAgICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU4KTsKCiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogICAgICAgIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICAgICAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICAgICAgICB2YXIgZGVzYyA9IF9PYmplY3QkZGVmaW5lUHJvcGVydHkgJiYgX09iamVjdCRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBfT2JqZWN0JGdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgICAgICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIG5ld09ialsiZGVmYXVsdCJdID0gb2JqOwogICAgICAgICAgcmV0dXJuIG5ld09iajsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQ7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvLyA3LjIuMSBSZXF1aXJlT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KQogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogICAgICAgIGlmIChpdCA9PSB1bmRlZmluZWQpIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gICIgKyBpdCk7CiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxOSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGJpdG1hcCwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZW51bWVyYWJsZTogIShiaXRtYXAgJiAxKSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogIShiaXRtYXAgJiAyKSwKICAgICAgICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLAogICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMjAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOwoKICAgICAgdmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKS5kb2N1bWVudDsgLy8gdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgJ29iamVjdCcgaW4gb2xkIElFCgoKICAgICAgdmFyIGlzID0gaXNPYmplY3QoZG9jdW1lbnQpICYmIGlzT2JqZWN0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gaXMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGl0KSA6IHt9OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAyMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi4xNCAvIDE1LjIuMy4xNCBPYmplY3Qua2V5cyhPKQogICAgICB2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1KTsKCiAgICAgIHZhciBlbnVtQnVnS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMzkpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbiBrZXlzKE8pIHsKICAgICAgICByZXR1cm4gJGtleXMoTywgZW51bUJ1Z0tleXMpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAyMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIC8vIDcuMS40IFRvSW50ZWdlcgogICAgICB2YXIgY2VpbCA9IE1hdGguY2VpbDsKICAgICAgdmFyIGZsb29yID0gTWF0aC5mbG9vcjsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKGl0ID0gK2l0KSA/IDAgOiAoaXQgPiAwID8gZmxvb3IgOiBjZWlsKShpdCk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDIzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIHNoYXJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oMzcpKCdrZXlzJyk7CgogICAgICB2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gc2hhcmVkW2tleV0gfHwgKHNoYXJlZFtrZXldID0gdWlkKGtleSkpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAyNCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gdHJ1ZTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAyNSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDcuMS4xMyBUb09iamVjdChhcmd1bWVudCkKICAgICAgdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDI2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGRlZiA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpLmY7CgogICAgICB2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CgogICAgICB2YXIgVEFHID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgndG9TdHJpbmdUYWcnKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCB0YWcsIHN0YXQpIHsKICAgICAgICBpZiAoaXQgJiYgIWhhcyhpdCA9IHN0YXQgPyBpdCA6IGl0LnByb3RvdHlwZSwgVEFHKSkgZGVmKGl0LCBUQUcsIHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIHZhbHVlOiB0YWcKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMjcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7IC8vIDI1LjQuMS41IE5ld1Byb21pc2VDYXBhYmlsaXR5KEMpCgogICAgICB2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CgogICAgICBmdW5jdGlvbiBQcm9taXNlQ2FwYWJpbGl0eShDKSB7CiAgICAgICAgdmFyIHJlc29sdmUsIHJlamVjdDsKICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgQyhmdW5jdGlvbiAoJCRyZXNvbHZlLCAkJHJlamVjdCkgewogICAgICAgICAgaWYgKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKCdCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvcicpOwogICAgICAgICAgcmVzb2x2ZSA9ICQkcmVzb2x2ZTsKICAgICAgICAgIHJlamVjdCA9ICQkcmVqZWN0OwogICAgICAgIH0pOwogICAgICAgIHRoaXMucmVzb2x2ZSA9IGFGdW5jdGlvbihyZXNvbHZlKTsKICAgICAgICB0aGlzLnJlamVjdCA9IGFGdW5jdGlvbihyZWplY3QpOwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cy5mID0gZnVuY3Rpb24gKEMpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAyOCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBfT2JqZWN0JGNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTA0KTsKCiAgICAgIGZ1bmN0aW9uIF9pbmhlcml0c0xvb3NlKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgICAgICAgc3ViQ2xhc3MucHJvdG90eXBlID0gX09iamVjdCRjcmVhdGUoc3VwZXJDbGFzcy5wcm90b3R5cGUpOwogICAgICAgIHN1YkNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHN1YkNsYXNzOwogICAgICAgIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2luaGVyaXRzTG9vc2U7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMjkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzI5X187CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMzAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIGFuZCBub24tZW51bWVyYWJsZSBvbGQgVjggc3RyaW5ncwogICAgICB2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnMKCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdCgneicpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgcmV0dXJuIGNvZihpdCkgPT0gJ1N0cmluZycgPyBpdC5zcGxpdCgnJykgOiBPYmplY3QoaXQpOwogICAgICB9OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDMxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgZXhwb3J0cy5mID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMzIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyA3LjEuMSBUb1ByaW1pdGl2ZShpbnB1dCBbLCBQcmVmZXJyZWRUeXBlXSkKICAgICAgdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsgLy8gaW5zdGVhZCBvZiB0aGUgRVM2IHNwZWMgdmVyc2lvbiwgd2UgZGlkbid0IGltcGxlbWVudCBAQHRvUHJpbWl0aXZlIGNhc2UKICAgICAgLy8gYW5kIHRoZSBzZWNvbmQgYXJndW1lbnQgLSBmbGFnIC0gcHJlZmVycmVkIHR5cGUgaXMgYSBzdHJpbmcKCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgUykgewogICAgICAgIGlmICghaXNPYmplY3QoaXQpKSByZXR1cm4gaXQ7CiAgICAgICAgdmFyIGZuLCB2YWw7CiAgICAgICAgaWYgKFMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7CiAgICAgICAgaWYgKHR5cGVvZiAoZm4gPSBpdC52YWx1ZU9mKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7CiAgICAgICAgaWYgKCFTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOwogICAgICAgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDMzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAhX193ZWJwYWNrX3JlcXVpcmVfXyg0KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXygxNCkoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoX193ZWJwYWNrX3JlcXVpcmVfXygyMCkoJ2RpdicpLCAnYScsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0KICAgICAgICB9KS5hICE9IDc7CiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDM0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gbW9zdCBPYmplY3QgbWV0aG9kcyBieSBFUzYgc2hvdWxkIGFjY2VwdCBwcmltaXRpdmVzCiAgICAgIHZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCiAgICAgIHZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsKCiAgICAgIHZhciBmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTQpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoS0VZLCBleGVjKSB7CiAgICAgICAgdmFyIGZuID0gKGNvcmUuT2JqZWN0IHx8IHt9KVtLRVldIHx8IE9iamVjdFtLRVldOwogICAgICAgIHZhciBleHAgPSB7fTsKICAgICAgICBleHBbS0VZXSA9IGV4ZWMoZm4pOwogICAgICAgICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogZmFpbHMoZnVuY3Rpb24gKCkgewogICAgICAgICAgZm4oMSk7CiAgICAgICAgfSksICdPYmplY3QnLCBleHApOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAzNSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Mik7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMzYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyA3LjEuMTUgVG9MZW5ndGgKICAgICAgdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMjIpOwoKICAgICAgdmFyIG1pbiA9IE1hdGgubWluOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MQogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAzNyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsKCiAgICAgIHZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAgICAgdmFyIFNIQVJFRCA9ICdfX2NvcmUtanNfc2hhcmVkX18nOwogICAgICB2YXIgc3RvcmUgPSBnbG9iYWxbU0hBUkVEXSB8fCAoZ2xvYmFsW1NIQVJFRF0gPSB7fSk7CiAgICAgIChtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlW2tleV0gfHwgKHN0b3JlW2tleV0gPSB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiB7fSk7CiAgICAgIH0pKCd2ZXJzaW9ucycsIFtdKS5wdXNoKHsKICAgICAgICB2ZXJzaW9uOiBjb3JlLnZlcnNpb24sCiAgICAgICAgbW9kZTogX193ZWJwYWNrX3JlcXVpcmVfXygyNCkgPyAncHVyZScgOiAnZ2xvYmFsJywKICAgICAgICBjb3B5cmlnaHQ6ICfCqSAyMDE4IERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpJwogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAzOCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIHZhciBpZCA9IDA7CiAgICAgIHZhciBweCA9IE1hdGgucmFuZG9tKCk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gJ1N5bWJvbCgnLmNvbmNhdChrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5LCAnKV8nLCAoKytpZCArIHB4KS50b1N0cmluZygzNikpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAzOSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIC8vIElFIDgtIGRvbid0IGVudW0gYnVnIGtleXMKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAnY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mJy5zcGxpdCgnLCcpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDQwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcwKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA0MSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBMSUJSQVJZID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNCk7CgogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgyKTsKCiAgICAgIHZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIHZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgICAgIHZhciAkaXRlckNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oODMpOwoKICAgICAgdmFyIHNldFRvU3RyaW5nVGFnID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNik7CgogICAgICB2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1KTsKCiAgICAgIHZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ2l0ZXJhdG9yJyk7CgogICAgICB2YXIgQlVHR1kgPSAhKFtdLmtleXMgJiYgJ25leHQnIGluIFtdLmtleXMoKSk7IC8vIFNhZmFyaSBoYXMgYnVnZ3kgaXRlcmF0b3JzIHcvbyBgbmV4dGAKCiAgICAgIHZhciBGRl9JVEVSQVRPUiA9ICdAQGl0ZXJhdG9yJzsKICAgICAgdmFyIEtFWVMgPSAna2V5cyc7CiAgICAgIHZhciBWQUxVRVMgPSAndmFsdWVzJzsKCiAgICAgIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEJhc2UsIE5BTUUsIENvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCkgewogICAgICAgICRpdGVyQ3JlYXRlKENvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KTsKCiAgICAgICAgdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uIGdldE1ldGhvZChraW5kKSB7CiAgICAgICAgICBpZiAoIUJVR0dZICYmIGtpbmQgaW4gcHJvdG8pIHJldHVybiBwcm90b1traW5kXTsKCiAgICAgICAgICBzd2l0Y2ggKGtpbmQpIHsKICAgICAgICAgICAgY2FzZSBLRVlTOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBrZXlzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgY2FzZSBWQUxVRVM6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgdmFyIFRBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJzsKICAgICAgICB2YXIgREVGX1ZBTFVFUyA9IERFRkFVTFQgPT0gVkFMVUVTOwogICAgICAgIHZhciBWQUxVRVNfQlVHID0gZmFsc2U7CiAgICAgICAgdmFyIHByb3RvID0gQmFzZS5wcm90b3R5cGU7CiAgICAgICAgdmFyICRuYXRpdmUgPSBwcm90b1tJVEVSQVRPUl0gfHwgcHJvdG9bRkZfSVRFUkFUT1JdIHx8IERFRkFVTFQgJiYgcHJvdG9bREVGQVVMVF07CiAgICAgICAgdmFyICRkZWZhdWx0ID0gJG5hdGl2ZSB8fCBnZXRNZXRob2QoREVGQVVMVCk7CiAgICAgICAgdmFyICRlbnRyaWVzID0gREVGQVVMVCA/ICFERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoJ2VudHJpZXMnKSA6IHVuZGVmaW5lZDsKICAgICAgICB2YXIgJGFueU5hdGl2ZSA9IE5BTUUgPT0gJ0FycmF5JyA/IHByb3RvLmVudHJpZXMgfHwgJG5hdGl2ZSA6ICRuYXRpdmU7CiAgICAgICAgdmFyIG1ldGhvZHMsIGtleSwgSXRlcmF0b3JQcm90b3R5cGU7IC8vIEZpeCBuYXRpdmUKCiAgICAgICAgaWYgKCRhbnlOYXRpdmUpIHsKICAgICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoJGFueU5hdGl2ZS5jYWxsKG5ldyBCYXNlKCkpKTsKCiAgICAgICAgICBpZiAoSXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgSXRlcmF0b3JQcm90b3R5cGUubmV4dCkgewogICAgICAgICAgICAvLyBTZXQgQEB0b1N0cmluZ1RhZyB0byBuYXRpdmUgaXRlcmF0b3JzCiAgICAgICAgICAgIHNldFRvU3RyaW5nVGFnKEl0ZXJhdG9yUHJvdG90eXBlLCBUQUcsIHRydWUpOyAvLyBmaXggZm9yIHNvbWUgb2xkIGVuZ2luZXMKCiAgICAgICAgICAgIGlmICghTElCUkFSWSAmJiB0eXBlb2YgSXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdICE9ICdmdW5jdGlvbicpIGhpZGUoSXRlcmF0b3JQcm90b3R5cGUsIElURVJBVE9SLCByZXR1cm5UaGlzKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGZpeCBBcnJheSN7dmFsdWVzLCBAQGl0ZXJhdG9yfS5uYW1lIGluIFY4IC8gRkYKCgogICAgICAgIGlmIChERUZfVkFMVUVTICYmICRuYXRpdmUgJiYgJG5hdGl2ZS5uYW1lICE9PSBWQUxVRVMpIHsKICAgICAgICAgIFZBTFVFU19CVUcgPSB0cnVlOwoKICAgICAgICAgICRkZWZhdWx0ID0gZnVuY3Rpb24gdmFsdWVzKCkgewogICAgICAgICAgICByZXR1cm4gJG5hdGl2ZS5jYWxsKHRoaXMpOwogICAgICAgICAgfTsKICAgICAgICB9IC8vIERlZmluZSBpdGVyYXRvcgoKCiAgICAgICAgaWYgKCghTElCUkFSWSB8fCBGT1JDRUQpICYmIChCVUdHWSB8fCBWQUxVRVNfQlVHIHx8ICFwcm90b1tJVEVSQVRPUl0pKSB7CiAgICAgICAgICBoaWRlKHByb3RvLCBJVEVSQVRPUiwgJGRlZmF1bHQpOwogICAgICAgIH0gLy8gUGx1ZyBmb3IgbGlicmFyeQoKCiAgICAgICAgSXRlcmF0b3JzW05BTUVdID0gJGRlZmF1bHQ7CiAgICAgICAgSXRlcmF0b3JzW1RBR10gPSByZXR1cm5UaGlzOwoKICAgICAgICBpZiAoREVGQVVMVCkgewogICAgICAgICAgbWV0aG9kcyA9IHsKICAgICAgICAgICAgdmFsdWVzOiBERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoVkFMVUVTKSwKICAgICAgICAgICAga2V5czogSVNfU0VUID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoS0VZUyksCiAgICAgICAgICAgIGVudHJpZXM6ICRlbnRyaWVzCiAgICAgICAgICB9OwogICAgICAgICAgaWYgKEZPUkNFRCkgZm9yIChrZXkgaW4gbWV0aG9kcykgewogICAgICAgICAgICBpZiAoIShrZXkgaW4gcHJvdG8pKSByZWRlZmluZShwcm90bywga2V5LCBtZXRob2RzW2tleV0pOwogICAgICAgICAgfSBlbHNlICRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKEJVR0dZIHx8IFZBTFVFU19CVUcpLCBOQU1FLCBtZXRob2RzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtZXRob2RzOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA0MiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQogICAgICB2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKICAgICAgdmFyIGRQcyA9IF9fd2VicGFja19yZXF1aXJlX18oODQpOwoKICAgICAgdmFyIGVudW1CdWdLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOSk7CgogICAgICB2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKSgnSUVfUFJPVE8nKTsKCiAgICAgIHZhciBFbXB0eSA9IGZ1bmN0aW9uIEVtcHR5KCkgewogICAgICAgIC8qIGVtcHR5ICovCiAgICAgIH07CgogICAgICB2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7IC8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBpZnJhbWUgT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUKCiAgICAgIHZhciBfY3JlYXRlRGljdCA9IGZ1bmN0aW9uIGNyZWF0ZURpY3QoKSB7CiAgICAgICAgLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWcKICAgICAgICB2YXIgaWZyYW1lID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCkoJ2lmcmFtZScpOwoKICAgICAgICB2YXIgaSA9IGVudW1CdWdLZXlzLmxlbmd0aDsKICAgICAgICB2YXIgbHQgPSAnPCc7CiAgICAgICAgdmFyIGd0ID0gJz4nOwogICAgICAgIHZhciBpZnJhbWVEb2N1bWVudDsKICAgICAgICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg0MykuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKCiAgICAgICAgaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0Oic7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2NyaXB0LXVybAogICAgICAgIC8vIGNyZWF0ZURpY3QgPSBpZnJhbWUuY29udGVudFdpbmRvdy5PYmplY3Q7CiAgICAgICAgLy8gaHRtbC5yZW1vdmVDaGlsZChpZnJhbWUpOwoKICAgICAgICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICAgIGlmcmFtZURvY3VtZW50Lm9wZW4oKTsKICAgICAgICBpZnJhbWVEb2N1bWVudC53cml0ZShsdCArICdzY3JpcHQnICsgZ3QgKyAnZG9jdW1lbnQuRj1PYmplY3QnICsgbHQgKyAnL3NjcmlwdCcgKyBndCk7CiAgICAgICAgaWZyYW1lRG9jdW1lbnQuY2xvc2UoKTsKICAgICAgICBfY3JlYXRlRGljdCA9IGlmcmFtZURvY3VtZW50LkY7CgogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgIGRlbGV0ZSBfY3JlYXRlRGljdFtQUk9UT1RZUEVdW2VudW1CdWdLZXlzW2ldXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfY3JlYXRlRGljdCgpOwogICAgICB9OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIHJlc3VsdDsKCiAgICAgICAgaWYgKE8gIT09IG51bGwpIHsKICAgICAgICAgIEVtcHR5W1BST1RPVFlQRV0gPSBhbk9iamVjdChPKTsKICAgICAgICAgIHJlc3VsdCA9IG5ldyBFbXB0eSgpOwogICAgICAgICAgRW1wdHlbUFJPVE9UWVBFXSA9IG51bGw7IC8vIGFkZCAiX19wcm90b19fIiBmb3IgT2JqZWN0LmdldFByb3RvdHlwZU9mIHBvbHlmaWxsCgogICAgICAgICAgcmVzdWx0W0lFX1BST1RPXSA9IE87CiAgICAgICAgfSBlbHNlIHJlc3VsdCA9IF9jcmVhdGVEaWN0KCk7CgogICAgICAgIHJldHVybiBQcm9wZXJ0aWVzID09PSB1bmRlZmluZWQgPyByZXN1bHQgOiBkUHMocmVzdWx0LCBQcm9wZXJ0aWVzKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNDMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpLmRvY3VtZW50OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBkb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNDQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBnZXR0aW5nIHRhZyBmcm9tIDE5LjEuMy42IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcoKQogICAgICB2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7CgogICAgICB2YXIgVEFHID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgndG9TdHJpbmdUYWcnKTsgLy8gRVMzIHdyb25nIGhlcmUKCgogICAgICB2YXIgQVJHID0gY29mKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgICB9KCkpID09ICdBcmd1bWVudHMnOyAvLyBmYWxsYmFjayBmb3IgSUUxMSBTY3JpcHQgQWNjZXNzIERlbmllZCBlcnJvcgoKICAgICAgdmFyIHRyeUdldCA9IGZ1bmN0aW9uIHRyeUdldChpdCwga2V5KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBpdFtrZXldOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIC8qIGVtcHR5ICovCiAgICAgICAgfQogICAgICB9OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICB2YXIgTywgVCwgQjsKICAgICAgICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCcgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCiAgICAgICAgOiB0eXBlb2YgKFQgPSB0cnlHZXQoTyA9IE9iamVjdChpdCksIFRBRykpID09ICdzdHJpbmcnID8gVCAvLyBidWlsdGluVGFnIGNhc2UKICAgICAgICA6IEFSRyA/IGNvZihPKSAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCiAgICAgICAgOiAoQiA9IGNvZihPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IEI7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDQ1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gNy4zLjIwIFNwZWNpZXNDb25zdHJ1Y3RvcihPLCBkZWZhdWx0Q29uc3RydWN0b3IpCiAgICAgIHZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CgogICAgICB2YXIgU1BFQ0lFUyA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ3NwZWNpZXMnKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE8sIEQpIHsKICAgICAgICB2YXIgQyA9IGFuT2JqZWN0KE8pLmNvbnN0cnVjdG9yOwogICAgICAgIHZhciBTOwogICAgICAgIHJldHVybiBDID09PSB1bmRlZmluZWQgfHwgKFMgPSBhbk9iamVjdChDKVtTUEVDSUVTXSkgPT0gdW5kZWZpbmVkID8gRCA6IGFGdW5jdGlvbihTKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNDYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CgogICAgICB2YXIgaW52b2tlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5Nik7CgogICAgICB2YXIgaHRtbCA9IF9fd2VicGFja19yZXF1aXJlX18oNDMpOwoKICAgICAgdmFyIGNlbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjApOwoKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwogICAgICB2YXIgc2V0VGFzayA9IGdsb2JhbC5zZXRJbW1lZGlhdGU7CiAgICAgIHZhciBjbGVhclRhc2sgPSBnbG9iYWwuY2xlYXJJbW1lZGlhdGU7CiAgICAgIHZhciBNZXNzYWdlQ2hhbm5lbCA9IGdsb2JhbC5NZXNzYWdlQ2hhbm5lbDsKICAgICAgdmFyIERpc3BhdGNoID0gZ2xvYmFsLkRpc3BhdGNoOwogICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgIHZhciBxdWV1ZSA9IHt9OwogICAgICB2YXIgT05SRUFEWVNUQVRFQ0hBTkdFID0gJ29ucmVhZHlzdGF0ZWNoYW5nZSc7CiAgICAgIHZhciBkZWZlciwgY2hhbm5lbCwgcG9ydDsKCiAgICAgIHZhciBydW4gPSBmdW5jdGlvbiBydW4oKSB7CiAgICAgICAgdmFyIGlkID0gK3RoaXM7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnMKCiAgICAgICAgaWYgKHF1ZXVlLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgdmFyIGZuID0gcXVldWVbaWRdOwogICAgICAgICAgZGVsZXRlIHF1ZXVlW2lkXTsKICAgICAgICAgIGZuKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gbGlzdGVuZXIoZXZlbnQpIHsKICAgICAgICBydW4uY2FsbChldmVudC5kYXRhKTsKICAgICAgfTsgLy8gTm9kZS5qcyAwLjkrICYgSUUxMCsgaGFzIHNldEltbWVkaWF0ZSwgb3RoZXJ3aXNlOgoKCiAgICAgIGlmICghc2V0VGFzayB8fCAhY2xlYXJUYXNrKSB7CiAgICAgICAgc2V0VGFzayA9IGZ1bmN0aW9uIHNldEltbWVkaWF0ZShmbikgewogICAgICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgICAgIHZhciBpID0gMTsKCiAgICAgICAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpIHsKICAgICAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBxdWV1ZVsrK2NvdW50ZXJdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKICAgICAgICAgICAgaW52b2tlKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbiksIGFyZ3MpOwogICAgICAgICAgfTsKCiAgICAgICAgICBkZWZlcihjb3VudGVyKTsKICAgICAgICAgIHJldHVybiBjb3VudGVyOwogICAgICAgIH07CgogICAgICAgIGNsZWFyVGFzayA9IGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGlkKSB7CiAgICAgICAgICBkZWxldGUgcXVldWVbaWRdOwogICAgICAgIH07IC8vIE5vZGUuanMgMC44LQoKCiAgICAgICAgaWYgKF9fd2VicGFja19yZXF1aXJlX18oMTMpKHByb2Nlc3MpID09ICdwcm9jZXNzJykgewogICAgICAgICAgZGVmZXIgPSBmdW5jdGlvbiBkZWZlcihpZCkgewogICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGN0eChydW4sIGlkLCAxKSk7CiAgICAgICAgICB9OyAvLyBTcGhlcmUgKEpTIGdhbWUgZW5naW5lKSBEaXNwYXRjaCBBUEkKCiAgICAgICAgfSBlbHNlIGlmIChEaXNwYXRjaCAmJiBEaXNwYXRjaC5ub3cpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgRGlzcGF0Y2gubm93KGN0eChydW4sIGlkLCAxKSk7CiAgICAgICAgICB9OyAvLyBCcm93c2VycyB3aXRoIE1lc3NhZ2VDaGFubmVsLCBpbmNsdWRlcyBXZWJXb3JrZXJzCgogICAgICAgIH0gZWxzZSBpZiAoTWVzc2FnZUNoYW5uZWwpIHsKICAgICAgICAgIGNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTsKICAgICAgICAgIHBvcnQgPSBjaGFubmVsLnBvcnQyOwogICAgICAgICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBsaXN0ZW5lcjsKICAgICAgICAgIGRlZmVyID0gY3R4KHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOyAvLyBCcm93c2VycyB3aXRoIHBvc3RNZXNzYWdlLCBza2lwIFdlYldvcmtlcnMKICAgICAgICAgIC8vIElFOCBoYXMgcG9zdE1lc3NhZ2UsIGJ1dCBpdCdzIHN5bmMgJiB0eXBlb2YgaXRzIHBvc3RNZXNzYWdlIGlzICdvYmplY3QnCiAgICAgICAgfSBlbHNlIGlmIChnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lciAmJiB0eXBlb2YgcG9zdE1lc3NhZ2UgPT0gJ2Z1bmN0aW9uJyAmJiAhZ2xvYmFsLmltcG9ydFNjcmlwdHMpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgZ2xvYmFsLnBvc3RNZXNzYWdlKGlkICsgJycsICcqJyk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdGVuZXIsIGZhbHNlKTsgLy8gSUU4LQogICAgICAgIH0gZWxzZSBpZiAoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNlbCgnc2NyaXB0JykpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgaHRtbC5hcHBlbmRDaGlsZChjZWwoJ3NjcmlwdCcpKVtPTlJFQURZU1RBVEVDSEFOR0VdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGh0bWwucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgICAgcnVuLmNhbGwoaWQpOwogICAgICAgICAgICB9OwogICAgICAgICAgfTsgLy8gUmVzdCBvbGQgYnJvd3NlcnMKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKICAgICAgICAgICAgc2V0VGltZW91dChjdHgocnVuLCBpZCwgMSksIDApOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgIHNldDogc2V0VGFzaywKICAgICAgICBjbGVhcjogY2xlYXJUYXNrCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNDcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGU6IGZhbHNlLAogICAgICAgICAgICB2OiBleGVjKCkKICAgICAgICAgIH07CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZTogdHJ1ZSwKICAgICAgICAgICAgdjogZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDQ4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsKCiAgICAgIHZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7CgogICAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEMsIHgpIHsKICAgICAgICBhbk9iamVjdChDKTsKICAgICAgICBpZiAoaXNPYmplY3QoeCkgJiYgeC5jb25zdHJ1Y3RvciA9PT0gQykgcmV0dXJuIHg7CiAgICAgICAgdmFyIHByb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkuZihDKTsKICAgICAgICB2YXIgcmVzb2x2ZSA9IHByb21pc2VDYXBhYmlsaXR5LnJlc29sdmU7CiAgICAgICAgcmVzb2x2ZSh4KTsKICAgICAgICByZXR1cm4gcHJvbWlzZUNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNDkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvKioKICAgICAgICogQ29weXJpZ2h0IChjKSAyMDEzLXByZXNlbnQsIEZhY2Vib29rLCBJbmMuCiAgICAgICAqCiAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAqLwogICAgICBpZiAoZmFsc2UpIHsKICAgICAgICB2YXIgdGhyb3dPbkRpcmVjdEFjY2VzcywgaXNWYWxpZEVsZW1lbnQsIFJFQUNUX0VMRU1FTlRfVFlQRTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBCeSBleHBsaWNpdGx5IHVzaW5nIGBwcm9wLXR5cGVzYCB5b3UgYXJlIG9wdGluZyBpbnRvIG5ldyBwcm9kdWN0aW9uIGJlaGF2aW9yLgogICAgICAgIC8vIGh0dHA6Ly9mYi5tZS9wcm9wLXR5cGVzLWluLXByb2QKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMTA3KSgpOwogICAgICB9CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDUwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX181MF9fOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDUxICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwoKICAgICAgZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gdm9pZCAwOwoKICAgICAgdmFyIF9TZWFyY2hhYmxlVGFibGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oNTIpKTsKCiAgICAgIHZhciBfZGVmYXVsdCA9IHsKICAgICAgICBTZWFyY2hhYmxlVGFibGU6IF9TZWFyY2hhYmxlVGFibGVbImRlZmF1bHQiXQogICAgICB9OwogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSBfZGVmYXVsdDsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNTIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CgogICAgICBleHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSB2b2lkIDA7CgogICAgICB2YXIgX1RhYmxlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKDUzKSk7CgogICAgICB2YXIgX0NvbHVtbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygxMTIpKTsKCiAgICAgIHZhciBfRm9ybSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygxMTMpKTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTE0KTsKCiAgICAgIF9UYWJsZVsiZGVmYXVsdCJdLkNvbHVtbiA9IF9Db2x1bW5bImRlZmF1bHQiXTsKICAgICAgX1RhYmxlWyJkZWZhdWx0Il0uU2VhcmNoRm9ybSA9IF9Gb3JtWyJkZWZhdWx0Il07CiAgICAgIHZhciBfZGVmYXVsdCA9IF9UYWJsZVsiZGVmYXVsdCJdOwogICAgICBleHBvcnRzWyJkZWZhdWx0Il0gPSBfZGVmYXVsdDsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNTMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsKCiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsKCiAgICAgIGV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IHZvaWQgMDsKCiAgICAgIHZhciBfZXh0ZW5kczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oNjEpKTsKCiAgICAgIHZhciBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oNjkpKTsKCiAgICAgIHZhciBfYXNzaWduID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KSk7CgogICAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKDcyKSk7CgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDc1KTsKCiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oNzYpKTsKCiAgICAgIHZhciBfa2V5cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXyg0MCkpOwoKICAgICAgdmFyIF9pbmhlcml0c0xvb3NlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygyOCkpOwoKICAgICAgdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9fd2VicGFja19yZXF1aXJlX18oMjkpKTsKCiAgICAgIHZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5KSk7CgogICAgICB2YXIgX2FudGQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUwKTsKCiAgICAgIHZhciBfY2xhc3NuYW1lczMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oMTA5KSk7CgogICAgICB2YXIgX29taXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oMTEwKSk7CgogICAgICB2YXIgX3dhcm5pbmcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oMTExKSk7CgogICAgICB2YXIgcGFnaW5hdGlvblR5cGVzID0gX3Byb3BUeXBlc1siZGVmYXVsdCJdLnNoYXBlKHsKICAgICAgICBjdXJyZW50OiBfcHJvcFR5cGVzWyJkZWZhdWx0Il0ubnVtYmVyLmlzUmVxdWlyZWQsCiAgICAgICAgcGFnZVNpemU6IF9wcm9wVHlwZXNbImRlZmF1bHQiXS5udW1iZXIuaXNSZXF1aXJlZCwKICAgICAgICB0b3RhbDogX3Byb3BUeXBlc1siZGVmYXVsdCJdLm51bWJlci5pc1JlcXVpcmVkCiAgICAgIH0pOwoKICAgICAgdmFyIGRlZmF1bHRQYWdpbmF0aW9uID0gewogICAgICAgIGN1cnJlbnQ6IDEsCiAgICAgICAgcGFnZVNpemU6IDEwLAogICAgICAgIHRvdGFsOiAwCiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiDluKbmkJzntKLooajljZXnmoTooajmoLwKICAgICAgICovCgogICAgICB2YXIgU2VhcmNoYWJsZVRhYmxlID0KICAgICAgLyojX19QVVJFX18qLwogICAgICBmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogICAgICAgICgwLCBfaW5oZXJpdHNMb29zZTJbImRlZmF1bHQiXSkoU2VhcmNoYWJsZVRhYmxlLCBfQ29tcG9uZW50KTsKCiAgICAgICAgU2VhcmNoYWJsZVRhYmxlLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyA9IGZ1bmN0aW9uIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHsKICAgICAgICAgIHZhciBfc3RhdGUkcGFnaW5hdGlvbiA9IHN0YXRlLnBhZ2luYXRpb24sCiAgICAgICAgICAgICAgcGFnaW5hdGlvblN0YXRlID0gX3N0YXRlJHBhZ2luYXRpb24gPT09IHZvaWQgMCA/IHt9IDogX3N0YXRlJHBhZ2luYXRpb247CiAgICAgICAgICB2YXIgcGFnaW5hdGlvbiA9IHByb3BzLnBhZ2luYXRpb24sCiAgICAgICAgICAgICAgc2VhcmNoSW5mbyA9IHByb3BzLnNlYXJjaEluZm8sCiAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IHByb3BzLmRhdGFTb3VyY2U7CiAgICAgICAgICB2YXIgbmV3U3RhdGUgPSB7fTsKCiAgICAgICAgICBpZiAoJ3BhZ2luYXRpb24nIGluIHByb3BzICYmIHR5cGVvZiBwYWdpbmF0aW9uID09PSAnb2JqZWN0JyAmJiBwYWdpbmF0aW9uKSB7CiAgICAgICAgICAgIGlmIChwYWdpbmF0aW9uLmN1cnJlbnQgPT09IHBhZ2luYXRpb25TdGF0ZS5jdXJyZW50ICYmIHBhZ2luYXRpb24ucGFnZVNpemUgPT09IHBhZ2luYXRpb25TdGF0ZS5wYWdlU2l6ZSAmJiBwYWdpbmF0aW9uLnRvdGFsID09PSBwYWdpbmF0aW9uU3RhdGUudG90YWwpIHJldHVybjsKICAgICAgICAgICAgbmV3U3RhdGUucGFnaW5hdGlvbiA9IHsKICAgICAgICAgICAgICBjdXJyZW50OiBwYWdpbmF0aW9uLmN1cnJlbnQsCiAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2luYXRpb24ucGFnZVNpemUsCiAgICAgICAgICAgICAgdG90YWw6IHBhZ2luYXRpb24udG90YWwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICA7CgogICAgICAgICAgaWYgKCdzZWFyY2hJbmZvJyBpbiBwcm9wcyAmJiBzZWFyY2hJbmZvICE9PSBzdGF0ZS5zZWFyY2hJbmZvKSB7CiAgICAgICAgICAgIG5ld1N0YXRlLnNlYXJjaEluZm8gPSBzZWFyY2hJbmZvOwogICAgICAgICAgfQoKICAgICAgICAgIDsKCiAgICAgICAgICBpZiAoJ2RhdGFTb3VyY2UnIGluIHByb3BzICYmIGRhdGFTb3VyY2UgIT09IHN0YXRlLmRhdGFTb3VyY2UpIHsKICAgICAgICAgICAgbmV3U3RhdGUuZGF0YVNvdXJjZSA9IGRhdGFTb3VyY2U7CiAgICAgICAgICB9CgogICAgICAgICAgOwogICAgICAgICAgaWYgKCgwLCBfa2V5c1siZGVmYXVsdCJdKShuZXdTdGF0ZSkubGVuZ3RoKSByZXR1cm4gbmV3U3RhdGU7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBTZWFyY2hhYmxlVGFibGUocHJvcHMpIHsKICAgICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgICBfdGhpcyA9IF9Db21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpczsKCiAgICAgICAgICBfdGhpcy5yZWxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IF90aGlzLnN0YXRlLAogICAgICAgICAgICAgICAgc2VhcmNoSW5mbyA9IF90aGlzJHN0YXRlLnNlYXJjaEluZm8sCiAgICAgICAgICAgICAgICBfdGhpcyRzdGF0ZSRwYWdpbmF0aW8gPSBfdGhpcyRzdGF0ZS5wYWdpbmF0aW9uLAogICAgICAgICAgICAgICAgY3VycmVudCA9IF90aGlzJHN0YXRlJHBhZ2luYXRpby5jdXJyZW50LAogICAgICAgICAgICAgICAgcGFnZVNpemUgPSBfdGhpcyRzdGF0ZSRwYWdpbmF0aW8ucGFnZVNpemU7CgogICAgICAgICAgICBfdGhpcy5mZXRjaCh7CiAgICAgICAgICAgICAgc2VhcmNoSW5mbzogc2VhcmNoSW5mbywKICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7CiAgICAgICAgICAgICAgICBjdXJyZW50OiBjdXJyZW50LAogICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgX3RoaXMuZmV0Y2ggPQogICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX3JlZjIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyWyJkZWZhdWx0Il0pKAogICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIF9yZWdlbmVyYXRvclsiZGVmYXVsdCJdLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShfcmVmKSB7CiAgICAgICAgICAgICAgdmFyIHBhZ2luYXRpb25QYXJhbSwgc2VhcmNoSW5mbywgZmV0Y2gsIHJlcywgZGF0YVNvdXJjZSwgcGFnaW5hdGlvbjsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yWyJkZWZhdWx0Il0ud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25QYXJhbSA9IF9yZWYucGFnaW5hdGlvbiwgc2VhcmNoSW5mbyA9IF9yZWYuc2VhcmNoSW5mbzsKICAgICAgICAgICAgICAgICAgICAgIGZldGNoID0gX3RoaXMucHJvcHMuZmV0Y2g7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHBhZ2luYXRpb25QYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoSW5mbzogc2VhcmNoSW5mbwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgKDAsIF93YXJuaW5nWyJkZWZhdWx0Il0pKHJlcy5kYXRhU291cmNlIHx8IHJlcy5wYWdpbmF0aW9uLCAnUmV0dXJuIG9mIGZldGNoIHByb3AgbXVzdCBjb250YWluIGF0dHJpYnV0ZXMgd2l0aCBkYXRhU291cmNlIGFuZCBwYWdpbmF0aW9uIScpOwogICAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IHJlcy5kYXRhU291cmNlLCBwYWdpbmF0aW9uID0gcmVzLnBhZ2luYXRpb247CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBkYXRhU291cmNlLAogICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiBwYWdpbmF0aW9uIHx8IGRlZmF1bHRQYWdpbmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hJbmZvOiBzZWFyY2hJbmZvLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSgpOwoKICAgICAgICAgIF90aGlzLmRvU2VhcmNoID0gZnVuY3Rpb24gKHNlYXJjaEluZm8pIHsKICAgICAgICAgICAgaWYgKHNlYXJjaEluZm8gPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHNlYXJjaEluZm8gPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF90aGlzJHN0YXRlJHBhZ2luYXRpbzIgPSBfdGhpcy5zdGF0ZS5wYWdpbmF0aW9uLAogICAgICAgICAgICAgICAgY3VycmVudCA9IF90aGlzJHN0YXRlJHBhZ2luYXRpbzIuY3VycmVudCwKICAgICAgICAgICAgICAgIHBhZ2VTaXplID0gX3RoaXMkc3RhdGUkcGFnaW5hdGlvMi5wYWdlU2l6ZTsKICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAgICAgICBzZWFyY2hJbmZvOiBzZWFyY2hJbmZvLAogICAgICAgICAgICAgIHBhZ2luYXRpb246IHsKICAgICAgICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnQsCiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBfdGhpcy5mZXRjaChwYXJhbXMpOwogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpcy5vblRhYmxlQ2hhbmdlID0gZnVuY3Rpb24gKHBhZ2luYXRpb24sIGZpbHRlcnMsIHNvcnRlcikgewogICAgICAgICAgICB2YXIgY3VycmVudCA9IHBhZ2luYXRpb24uY3VycmVudCwKICAgICAgICAgICAgICAgIHBhZ2VTaXplID0gcGFnaW5hdGlvbi5wYWdlU2l6ZTsKICAgICAgICAgICAgdmFyIHNlYXJjaEluZm8gPSBfdGhpcy5zdGF0ZS5zZWFyY2hJbmZvOwogICAgICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgICAgIHNlYXJjaEluZm86IHNlYXJjaEluZm8sCiAgICAgICAgICAgICAgcGFnaW5hdGlvbjogewogICAgICAgICAgICAgICAgY3VycmVudDogY3VycmVudCwKICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIF90aGlzLmZldGNoKHBhcmFtcyk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBzdGF0ZSA9IHt9OwoKICAgICAgICAgIHZhciBfcGFnaW5hdGlvbjsKCiAgICAgICAgICBpZiAoJ3BhZ2luYXRpb24nIGluIHByb3BzICYmIHR5cGVvZiBwcm9wcy5wYWdpbmF0aW9uID09PSAnb2JqZWN0JyAmJiBfcGFnaW5hdGlvbikgewogICAgICAgICAgICBfcGFnaW5hdGlvbiA9IHsKICAgICAgICAgICAgICBjdXJyZW50OiBwcm9wLnBhZ2luYXRpb24uY3VycmVudCwKICAgICAgICAgICAgICBwYWdlU2l6ZTogcHJvcC5wYWdpbmF0aW9uLnBhZ2VTaXplLAogICAgICAgICAgICAgIHRvdGFsOiBwcm9wLnBhZ2luYXRpb24udG90YWwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc3RhdGUucGFnaW5hdGlvbiA9IF9wYWdpbmF0aW9uOwogICAgICAgICAgfSBlbHNlIGlmICgnZGVmYXVsdFBhZ2luYXRpb24nIGluIHByb3BzKSB7CiAgICAgICAgICAgIF9wYWdpbmF0aW9uID0gcHJvcHMuZGVmYXVsdFBhZ2luYXRpb247CiAgICAgICAgICAgIHN0YXRlLnBhZ2luYXRpb24gPSBfcGFnaW5hdGlvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLnBhZ2luYXRpb24gPSBkZWZhdWx0UGFnaW5hdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICA7CgogICAgICAgICAgdmFyIF9kYXRhU291cmNlOwoKICAgICAgICAgIGlmICgnZGF0YVNvdXJjZScgaW4gcHJvcHMpIHsKICAgICAgICAgICAgX2RhdGFTb3VyY2UgPSBwcm9wcy5kYXRhU291cmNlOwogICAgICAgICAgICBzdGF0ZS5kYXRhU291cmNlID0gX2RhdGFTb3VyY2U7CiAgICAgICAgICB9IGVsc2UgaWYgKCdkZWZhdWx0RGF0YVNvdXJjZScgaW4gcHJvcHMpIHsKICAgICAgICAgICAgX2RhdGFTb3VyY2UgPSBwcm9wcy5kZWZhdWx0RGF0YVNvdXJjZTsKICAgICAgICAgICAgc3RhdGUuZGF0YVNvdXJjZSA9IF9kYXRhU291cmNlOwogICAgICAgICAgfQoKICAgICAgICAgIDsKCiAgICAgICAgICB2YXIgX3NlYXJjaEluZm87CgogICAgICAgICAgaWYgKCdzZWFyY2hJbmZvJyBpbiBwcm9wcykgewogICAgICAgICAgICBfc2VhcmNoSW5mbyA9IHByb3BzLnNlYXJjaEluZm87CiAgICAgICAgICAgIHN0YXRlLnNlYXJjaEluZm8gPSBfc2VhcmNoSW5mbzsKICAgICAgICAgIH0gZWxzZSBpZiAoJ2RlZmF1bHRTZWFyY2hJbmZvJyBpbiBwcm9wcykgewogICAgICAgICAgICBfc2VhcmNoSW5mbyA9IHByb3BzLmRlZmF1bHRTZWFyY2hJbmZvOwogICAgICAgICAgICBzdGF0ZS5zZWFyY2hJbmZvID0gX3NlYXJjaEluZm87CiAgICAgICAgICB9CgogICAgICAgICAgOwogICAgICAgICAgX3RoaXMuc3RhdGUgPSAoMCwgX2Fzc2lnblsiZGVmYXVsdCJdKSh7fSwgc3RhdGUsIHsKICAgICAgICAgICAgbG9hZGluZzogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KCiAgICAgICAgdmFyIF9wcm90byA9IFNlYXJjaGFibGVUYWJsZS5wcm90b3R5cGU7CgogICAgICAgIF9wcm90by5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICAgICAgdGhpcy5yZWxvYWQoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICog5qC55o2uIHN0YXRlIOeKtuaAgeWKoOi9vei/nOeoi+aVsOaNrgogICAgICAgICAqLwogICAgICAgIDsKICAgICAgICAvKioKICAgICAgICAgKiDmuLLmn5PmkJzntKLooajljZXjgILmi4bliIbvvIzkvr/kuo7nu6fmib8KICAgICAgICAgKi8KCgogICAgICAgIF9wcm90by5yZW5kZXJGb3JtID0gZnVuY3Rpb24gcmVuZGVyRm9ybSgpIHsKICAgICAgICAgIHZhciBmb3JtID0gdGhpcy5wcm9wcy5mb3JtOwogICAgICAgICAgcmV0dXJuIGZvcm0gPyBfcmVhY3RbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogInNlYXJjaGFibGUtdGFibGUtZm9ybSIKICAgICAgICAgIH0sIGZvcm0odGhpcy5kb1NlYXJjaCkpIDogJyc7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIOa4suafk+ihqOagvOOAguaLhuWIhu+8jOS+v+S6jue7p+aJvwogICAgICAgICAqLwogICAgICAgIDsKCiAgICAgICAgX3Byb3RvLnJlbmRlclRhYmxlID0gZnVuY3Rpb24gcmVuZGVyVGFibGUoKSB7CiAgICAgICAgICB2YXIgX2NsYXNzbmFtZXM7CgogICAgICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IHRoaXMuc3RhdGUsCiAgICAgICAgICAgICAgcGFnaW5hdGlvblN0YXRlID0gX3RoaXMkc3RhdGUyLnBhZ2luYXRpb24sCiAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IF90aGlzJHN0YXRlMi5kYXRhU291cmNlOwogICAgICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgICAgICB0YWJsZUNsYXNzTmFtZSA9IF90aGlzJHByb3BzLnRhYmxlQ2xhc3NOYW1lLAogICAgICAgICAgICAgIHRhYmxlU3R5bGUgPSBfdGhpcyRwcm9wcy50YWJsZVN0eWxlLAogICAgICAgICAgICAgIHBhZ2luYXRpb25Qcm9wID0gX3RoaXMkcHJvcHMucGFnaW5hdGlvbiwKICAgICAgICAgICAgICBjb2x1bW5zUHJvcCA9IF90aGlzJHByb3BzLmNvbHVtbnMsCiAgICAgICAgICAgICAgY2hpbGRyZW4gPSBfdGhpcyRwcm9wcy5jaGlsZHJlbiwKICAgICAgICAgICAgICByZXN0ID0gKDAsIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlMlsiZGVmYXVsdCJdKShfdGhpcyRwcm9wcywgWyJ0YWJsZUNsYXNzTmFtZSIsICJ0YWJsZVN0eWxlIiwgInBhZ2luYXRpb24iLCAiY29sdW1ucyIsICJjaGlsZHJlbiJdKTsKICAgICAgICAgIHZhciB0YWJsZUNsYXNzTmFtZXMgPSAoMCwgX2NsYXNzbmFtZXMzWyJkZWZhdWx0Il0pKChfY2xhc3NuYW1lcyA9IHsKICAgICAgICAgICAgJ3NlYXJjaGFibGUtdGFibGUnOiB0cnVlCiAgICAgICAgICB9LCBfY2xhc3NuYW1lc1t0YWJsZUNsYXNzTmFtZV0gPSAhIXRhYmxlQ2xhc3NOYW1lLCBfY2xhc3NuYW1lcykpOwogICAgICAgICAgdmFyIHRhYmxlUHJvcHMgPSAoMCwgX29taXRbImRlZmF1bHQiXSkoWydjbGFzc05hbWUnLCAnc3R5bGUnLCAnZGVmYXVsdFBhZ2luYXRpb24nLCAnZGVmYXVsdFNlYXJjaEluZm8nLCAnc2VhcmNoSW5mbycsICdkZWZhdWx0RGF0YVNvdXJjZScsICdkYXRhU291cmNlJywgJ2ZldGNoJywgJ2Zvcm0nXSkocmVzdCk7CiAgICAgICAgICB2YXIgcGFnaW5hdGlvbiA9IHR5cGVvZiBwYWdpbmF0aW9uUHJvcCA9PT0gJ2Jvb2xlYW4nID8gcGFnaW5hdGlvblByb3AgOiAoMCwgX2Fzc2lnblsiZGVmYXVsdCJdKSh7fSwgcGFnaW5hdGlvblByb3AsIHBhZ2luYXRpb25TdGF0ZSk7CiAgICAgICAgICB2YXIgY29sdW1ucyA9IGNoaWxkcmVuID8gX3JlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgIHZhciBfY2hpbGQkcHJvcHMgPSBjaGlsZC5wcm9wcywKICAgICAgICAgICAgICAgIGNlbGwgPSBfY2hpbGQkcHJvcHMuY2VsbCwKICAgICAgICAgICAgICAgIHJlc3QgPSAoMCwgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyWyJkZWZhdWx0Il0pKF9jaGlsZCRwcm9wcywgWyJjZWxsIl0pOwogICAgICAgICAgICByZXR1cm4gKDAsIF9hc3NpZ25bImRlZmF1bHQiXSkoe30sIHJlc3QsIHsKICAgICAgICAgICAgICBrZXk6IHJlc3QuZGF0YUluZGV4LAogICAgICAgICAgICAgIHJlbmRlcjogY2VsbAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pIDogY29sdW1uc1Byb3A7CiAgICAgICAgICByZXR1cm4gX3JlYWN0WyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfYW50ZC5UYWJsZSwgKDAsIF9leHRlbmRzMlsiZGVmYXVsdCJdKSh7fSwgdGFibGVQcm9wcywgewogICAgICAgICAgICBkYXRhU291cmNlOiBkYXRhU291cmNlLAogICAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zLAogICAgICAgICAgICBwYWdpbmF0aW9uOiBwYWdpbmF0aW9uLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vblRhYmxlQ2hhbmdlLAogICAgICAgICAgICBjbGFzc05hbWU6IHRhYmxlQ2xhc3NOYW1lcywKICAgICAgICAgICAgc3R5bGU6IHRhYmxlU3R5bGUKICAgICAgICAgIH0pKTsKICAgICAgICB9OwoKICAgICAgICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgdmFyIF9jbGFzc25hbWVzMjsKCiAgICAgICAgICB2YXIgbG9hZGluZyA9IHRoaXMuc3RhdGUubG9hZGluZzsKICAgICAgICAgIHZhciBfdGhpcyRwcm9wczIgPSB0aGlzLnByb3BzLAogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IF90aGlzJHByb3BzMi5jbGFzc05hbWUsCiAgICAgICAgICAgICAgc3R5bGUgPSBfdGhpcyRwcm9wczIuc3R5bGU7CiAgICAgICAgICB2YXIgY2xhc3NOYW1lcyA9ICgwLCBfY2xhc3NuYW1lczNbImRlZmF1bHQiXSkoKF9jbGFzc25hbWVzMiA9IHsKICAgICAgICAgICAgJ3NlYXJjaGFibGUtdGFibGUtY29udGFpbmVyJzogdHJ1ZQogICAgICAgICAgfSwgX2NsYXNzbmFtZXMyW2NsYXNzTmFtZV0gPSAhIWNsYXNzTmFtZSwgX2NsYXNzbmFtZXMyKSk7CiAgICAgICAgICByZXR1cm4gX3JlYWN0WyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMsCiAgICAgICAgICAgIHN0eWxlOiBzdHlsZQogICAgICAgICAgfSwgX3JlYWN0WyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChfYW50ZC5TcGluLCB7CiAgICAgICAgICAgIHNwaW5uaW5nOiBsb2FkaW5nLAogICAgICAgICAgICBjbGFzc05hbWU6ICJzZWFyY2hhYmxlLXRhYmxlLXNwaW4iCiAgICAgICAgICB9LCB0aGlzLnJlbmRlckZvcm0oKSwgdGhpcy5yZW5kZXJUYWJsZSgpKSk7CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIFNlYXJjaGFibGVUYWJsZTsKICAgICAgfShfcmVhY3QuQ29tcG9uZW50KTsKCiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IFNlYXJjaGFibGVUYWJsZTsKICAgICAgU2VhcmNoYWJsZVRhYmxlLnByb3BUeXBlcyA9IHsKICAgICAgICBkZWZhdWx0UGFnaW5hdGlvbjogcGFnaW5hdGlvblR5cGVzLAogICAgICAgIHBhZ2luYXRpb246IF9wcm9wVHlwZXNbImRlZmF1bHQiXS5vbmVPZlR5cGUoW3BhZ2luYXRpb25UeXBlcywgX3Byb3BUeXBlc1siZGVmYXVsdCJdLmJvb2xdKSwKICAgICAgICBkZWZhdWx0U2VhcmNoSW5mbzogX3Byb3BUeXBlc1siZGVmYXVsdCJdLm9iamVjdCwKICAgICAgICBzZWFyY2hJbmZvOiBfcHJvcFR5cGVzWyJkZWZhdWx0Il0ub2JqZWN0LAogICAgICAgIGRlZmF1bHREYXRhU291cmNlOiBfcHJvcFR5cGVzWyJkZWZhdWx0Il0uYXJyYXksCiAgICAgICAgZGF0YVNvdXJjZTogX3Byb3BUeXBlc1siZGVmYXVsdCJdLmFycmF5LAogICAgICAgIGZvcm06IF9wcm9wVHlwZXNbImRlZmF1bHQiXS5mdW5jLAogICAgICAgIGZldGNoOiBfcHJvcFR5cGVzWyJkZWZhdWx0Il0uZnVuYywKICAgICAgICBjbGFzc05hbWU6IF9wcm9wVHlwZXNbImRlZmF1bHQiXS5zdHJpbmcsCiAgICAgICAgc3R5bGU6IF9wcm9wVHlwZXNbImRlZmF1bHQiXS5vYmplY3QsCiAgICAgICAgdGFibGVDbGFzc05hbWU6IF9wcm9wVHlwZXNbImRlZmF1bHQiXS5zdHJpbmcsCiAgICAgICAgdGFibGVTdHlsZTogX3Byb3BUeXBlc1siZGVmYXVsdCJdLm9iamVjdAogICAgICB9OwogICAgICA7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDU0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU1KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA1NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oNTYpOwoKICAgICAgdmFyICRPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLk9iamVjdDsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpIHsKICAgICAgICByZXR1cm4gJE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDU2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gMTkuMS4yLjYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKQogICAgICB2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKCiAgICAgIHZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1NykuZjsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMzQpKCdnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3InLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KSB7CiAgICAgICAgICByZXR1cm4gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0b0lPYmplY3QoaXQpLCBrZXkpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA1NyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBwSUUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMxKTsKCiAgICAgIHZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7CgogICAgICB2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKCiAgICAgIHZhciB0b1ByaW1pdGl2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzIpOwoKICAgICAgdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOwoKICAgICAgdmFyIElFOF9ET01fREVGSU5FID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMyk7CgogICAgICB2YXIgZ09QRCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICAgIGV4cG9ydHMuZiA9IF9fd2VicGFja19yZXF1aXJlX18oNCkgPyBnT1BEIDogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApIHsKICAgICAgICBPID0gdG9JT2JqZWN0KE8pOwogICAgICAgIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsKICAgICAgICBpZiAoSUU4X0RPTV9ERUZJTkUpIHRyeSB7CiAgICAgICAgICByZXR1cm4gZ09QRChPLCBQKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAvKiBlbXB0eSAqLwogICAgICAgIH0KICAgICAgICBpZiAoaGFzKE8sIFApKSByZXR1cm4gY3JlYXRlRGVzYyghcElFLmYuY2FsbChPLCBQKSwgT1tQXSk7CiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNTggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTkpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDU5ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg2MCk7CgogICAgICB2YXIgJE9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuT2JqZWN0OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShpdCwga2V5LCBkZXNjKSB7CiAgICAgICAgcmV0dXJuICRPYmplY3QuZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgZGVzYyk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDYwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOyAvLyAxOS4xLjIuNCAvIDE1LjIuMy42IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKQoKCiAgICAgICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIV9fd2VicGFja19yZXF1aXJlX18oNCksICdPYmplY3QnLCB7CiAgICAgICAgZGVmaW5lUHJvcGVydHk6IF9fd2VicGFja19yZXF1aXJlX18oMTEpLmYKICAgICAgfSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNjEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgX09iamVjdCRhc3NpZ24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KTsKCiAgICAgIGZ1bmN0aW9uIF9leHRlbmRzKCkgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gX2V4dGVuZHMgPSBfT2JqZWN0JGFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2V4dGVuZHM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNjIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKS5PYmplY3QuYXNzaWduOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDYzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gMTkuMS4zLjEgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSkKICAgICAgdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwoKICAgICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYsICdPYmplY3QnLCB7CiAgICAgICAgYXNzaWduOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0KQogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA2NCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsgLy8gMTkuMS4yLjEgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSwgLi4uKQoKICAgICAgdmFyIGdldEtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKTsKCiAgICAgIHZhciBnT1BTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2OCk7CgogICAgICB2YXIgcElFID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7CgogICAgICB2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTsKCiAgICAgIHZhciBJT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMCk7CgogICAgICB2YXIgJGFzc2lnbiA9IE9iamVjdC5hc3NpZ247IC8vIHNob3VsZCB3b3JrIHdpdGggc3ltYm9scyBhbmQgc2hvdWxkIGhhdmUgZGV0ZXJtaW5pc3RpYyBwcm9wZXJ0eSBvcmRlciAoVjggYnVnKQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAhJGFzc2lnbiB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0KShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIEEgPSB7fTsKICAgICAgICB2YXIgQiA9IHt9OyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYKCiAgICAgICAgdmFyIFMgPSBTeW1ib2woKTsKICAgICAgICB2YXIgSyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdCc7CiAgICAgICAgQVtTXSA9IDc7CiAgICAgICAgSy5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbiAoaykgewogICAgICAgICAgQltrXSA9IGs7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRhc3NpZ24oe30sIEEpW1NdICE9IDcgfHwgT2JqZWN0LmtleXMoJGFzc2lnbih7fSwgQikpLmpvaW4oJycpICE9IEs7CiAgICAgIH0pID8gZnVuY3Rpb24gYXNzaWduKHRhcmdldCwgc291cmNlKSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFycwogICAgICAgIHZhciBUID0gdG9PYmplY3QodGFyZ2V0KTsKICAgICAgICB2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgdmFyIGluZGV4ID0gMTsKICAgICAgICB2YXIgZ2V0U3ltYm9scyA9IGdPUFMuZjsKICAgICAgICB2YXIgaXNFbnVtID0gcElFLmY7CgogICAgICAgIHdoaWxlIChhTGVuID4gaW5kZXgpIHsKICAgICAgICAgIHZhciBTID0gSU9iamVjdChhcmd1bWVudHNbaW5kZXgrK10pOwogICAgICAgICAgdmFyIGtleXMgPSBnZXRTeW1ib2xzID8gZ2V0S2V5cyhTKS5jb25jYXQoZ2V0U3ltYm9scyhTKSkgOiBnZXRLZXlzKFMpOwogICAgICAgICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgICAgICAgdmFyIGogPSAwOwogICAgICAgICAgdmFyIGtleTsKCiAgICAgICAgICB3aGlsZSAobGVuZ3RoID4gaikgewogICAgICAgICAgICBpZiAoaXNFbnVtLmNhbGwoUywga2V5ID0ga2V5c1tqKytdKSkgVFtrZXldID0gU1trZXldOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFQ7CiAgICAgIH0gOiAkYXNzaWduOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDY1ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTApOwoKICAgICAgdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CgogICAgICB2YXIgYXJyYXlJbmRleE9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NikoZmFsc2UpOwoKICAgICAgdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMykoJ0lFX1BST1RPJyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmplY3QsIG5hbWVzKSB7CiAgICAgICAgdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTsKICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIGZvciAoa2V5IGluIE8pIHsKICAgICAgICAgIGlmIChrZXkgIT0gSUVfUFJPVE8pIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgICAgfSAvLyBEb24ndCBlbnVtIGJ1ZyAmIGhpZGRlbiBrZXlzCgoKICAgICAgICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgewogICAgICAgICAgaWYgKGhhcyhPLCBrZXkgPSBuYW1lc1tpKytdKSkgewogICAgICAgICAgICB+YXJyYXlJbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNjYgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBmYWxzZSAtPiBBcnJheSNpbmRleE9mCiAgICAgIC8vIHRydWUgIC0+IEFycmF5I2luY2x1ZGVzCiAgICAgIHZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOwoKICAgICAgdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNik7CgogICAgICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Nyk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChJU19JTkNMVURFUykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsKICAgICAgICAgIHZhciBPID0gdG9JT2JqZWN0KCR0aGlzKTsKICAgICAgICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CiAgICAgICAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpOwogICAgICAgICAgdmFyIHZhbHVlOyAvLyBBcnJheSNpbmNsdWRlcyB1c2VzIFNhbWVWYWx1ZVplcm8gZXF1YWxpdHkgYWxnb3JpdGhtCiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgogICAgICAgICAgaWYgKElTX0lOQ0xVREVTICYmIGVsICE9IGVsKSB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHsKICAgICAgICAgICAgdmFsdWUgPSBPW2luZGV4KytdOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgogICAgICAgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlOyAvLyBBcnJheSNpbmRleE9mIGlnbm9yZXMgaG9sZXMsIEFycmF5I2luY2x1ZGVzIC0gbm90CiAgICAgICAgICB9IGVsc2UgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSB7CiAgICAgICAgICAgICAgaWYgKE9baW5kZXhdID09PSBlbCkgcmV0dXJuIElTX0lOQ0xVREVTIHx8IGluZGV4IHx8IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNjcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMik7CgogICAgICB2YXIgbWF4ID0gTWF0aC5tYXg7CiAgICAgIHZhciBtaW4gPSBNYXRoLm1pbjsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGluZGV4LCBsZW5ndGgpIHsKICAgICAgICBpbmRleCA9IHRvSW50ZWdlcihpbmRleCk7CiAgICAgICAgcmV0dXJuIGluZGV4IDwgMCA/IG1heChpbmRleCArIGxlbmd0aCwgMCkgOiBtaW4oaW5kZXgsIGxlbmd0aCk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDY4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA2OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBfT2JqZWN0JGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwKTsKCiAgICAgIGZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKICAgICAgICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICAgICAgICB2YXIgdGFyZ2V0ID0ge307CgogICAgICAgIHZhciBzb3VyY2VLZXlzID0gX09iamVjdCRrZXlzKHNvdXJjZSk7CgogICAgICAgIHZhciBrZXksIGk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwogICAgICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDcwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg3MSk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuT2JqZWN0LmtleXM7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNzEgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyAxOS4xLjIuMTQgT2JqZWN0LmtleXMoTykKICAgICAgdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNSk7CgogICAgICB2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMzQpKCdrZXlzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiBrZXlzKGl0KSB7CiAgICAgICAgICByZXR1cm4gJGtleXModG9PYmplY3QoaXQpKTsKICAgICAgICB9OwogICAgICB9KTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogNzIgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNzMpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDczICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLyoqCiAgICAgICAqIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLgogICAgICAgKgogICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgKi8KICAgICAgLy8gVGhpcyBtZXRob2Qgb2Ygb2J0YWluaW5nIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0IG5lZWRzIHRvIGJlCiAgICAgIC8vIGtlcHQgaWRlbnRpY2FsIHRvIHRoZSB3YXkgaXQgaXMgb2J0YWluZWQgaW4gcnVudGltZS5qcwogICAgICB2YXIgZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcyB8fCB0eXBlb2Ygc2VsZiA9PT0gIm9iamVjdCIgJiYgc2VsZjsKICAgICAgfSgpIHx8IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7IC8vIFVzZSBgZ2V0T3duUHJvcGVydHlOYW1lc2AgYmVjYXVzZSBub3QgYWxsIGJyb3dzZXJzIHN1cHBvcnQgY2FsbGluZwogICAgICAvLyBgaGFzT3duUHJvcGVydHlgIG9uIHRoZSBnbG9iYWwgYHNlbGZgIG9iamVjdCBpbiBhIHdvcmtlci4gU2VlICMxODMuCgoKICAgICAgdmFyIGhhZFJ1bnRpbWUgPSBnLnJlZ2VuZXJhdG9yUnVudGltZSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhnKS5pbmRleE9mKCJyZWdlbmVyYXRvclJ1bnRpbWUiKSA+PSAwOyAvLyBTYXZlIHRoZSBvbGQgcmVnZW5lcmF0b3JSdW50aW1lIGluIGNhc2UgaXQgbmVlZHMgdG8gYmUgcmVzdG9yZWQgbGF0ZXIuCgogICAgICB2YXIgb2xkUnVudGltZSA9IGhhZFJ1bnRpbWUgJiYgZy5yZWdlbmVyYXRvclJ1bnRpbWU7IC8vIEZvcmNlIHJlZXZhbHV0YXRpb24gb2YgcnVudGltZS5qcy4KCiAgICAgIGcucmVnZW5lcmF0b3JSdW50aW1lID0gdW5kZWZpbmVkOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNzQpOwoKICAgICAgaWYgKGhhZFJ1bnRpbWUpIHsKICAgICAgICAvLyBSZXN0b3JlIHRoZSBvcmlnaW5hbCBydW50aW1lLgogICAgICAgIGcucmVnZW5lcmF0b3JSdW50aW1lID0gb2xkUnVudGltZTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBSZW1vdmUgdGhlIGdsb2JhbCBwcm9wZXJ0eSBhZGRlZCBieSBydW50aW1lLmpzLgogICAgICAgIHRyeSB7CiAgICAgICAgICBkZWxldGUgZy5yZWdlbmVyYXRvclJ1bnRpbWU7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgZy5yZWdlbmVyYXRvclJ1bnRpbWUgPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDc0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgLyoqCiAgICAgICAqIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLgogICAgICAgKgogICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgKi8KICAgICAgIWZ1bmN0aW9uIChnbG9iYWwpIHsKICAgICAgICAidXNlIHN0cmljdCI7CgogICAgICAgIHZhciBPcCA9IE9iamVjdC5wcm90b3R5cGU7CiAgICAgICAgdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5OwogICAgICAgIHZhciB1bmRlZmluZWQ7IC8vIE1vcmUgY29tcHJlc3NpYmxlIHRoYW4gdm9pZCAwLgoKICAgICAgICB2YXIgJFN5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgPyBTeW1ib2wgOiB7fTsKICAgICAgICB2YXIgaXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIjsKICAgICAgICB2YXIgYXN5bmNJdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIjsKICAgICAgICB2YXIgdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjsKICAgICAgICB2YXIgaW5Nb2R1bGUgPSB0eXBlb2YgbW9kdWxlID09PSAib2JqZWN0IjsKICAgICAgICB2YXIgcnVudGltZSA9IGdsb2JhbC5yZWdlbmVyYXRvclJ1bnRpbWU7CgogICAgICAgIGlmIChydW50aW1lKSB7CiAgICAgICAgICBpZiAoaW5Nb2R1bGUpIHsKICAgICAgICAgICAgLy8gSWYgcmVnZW5lcmF0b3JSdW50aW1lIGlzIGRlZmluZWQgZ2xvYmFsbHkgYW5kIHdlJ3JlIGluIGEgbW9kdWxlLAogICAgICAgICAgICAvLyBtYWtlIHRoZSBleHBvcnRzIG9iamVjdCBpZGVudGljYWwgdG8gcmVnZW5lcmF0b3JSdW50aW1lLgogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHJ1bnRpbWU7CiAgICAgICAgICB9IC8vIERvbid0IGJvdGhlciBldmFsdWF0aW5nIHRoZSByZXN0IG9mIHRoaXMgZmlsZSBpZiB0aGUgcnVudGltZSB3YXMKICAgICAgICAgIC8vIGFscmVhZHkgZGVmaW5lZCBnbG9iYWxseS4KCgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gRGVmaW5lIHRoZSBydW50aW1lIGdsb2JhbGx5IChhcyBleHBlY3RlZCBieSBnZW5lcmF0ZWQgY29kZSkgYXMgZWl0aGVyCiAgICAgICAgLy8gbW9kdWxlLmV4cG9ydHMgKGlmIHdlJ3JlIGluIGEgbW9kdWxlKSBvciBhIG5ldywgZW1wdHkgb2JqZWN0LgoKCiAgICAgICAgcnVudGltZSA9IGdsb2JhbC5yZWdlbmVyYXRvclJ1bnRpbWUgPSBpbk1vZHVsZSA/IG1vZHVsZS5leHBvcnRzIDoge307CgogICAgICAgIGZ1bmN0aW9uIHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpIHsKICAgICAgICAgIC8vIElmIG91dGVyRm4gcHJvdmlkZWQgYW5kIG91dGVyRm4ucHJvdG90eXBlIGlzIGEgR2VuZXJhdG9yLCB0aGVuIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yLgogICAgICAgICAgdmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3I7CiAgICAgICAgICB2YXIgZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpOwogICAgICAgICAgdmFyIGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7IC8vIFRoZSAuX2ludm9rZSBtZXRob2QgdW5pZmllcyB0aGUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSAubmV4dCwKICAgICAgICAgIC8vIC50aHJvdywgYW5kIC5yZXR1cm4gbWV0aG9kcy4KCiAgICAgICAgICBnZW5lcmF0b3IuX2ludm9rZSA9IG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7CiAgICAgICAgICByZXR1cm4gZ2VuZXJhdG9yOwogICAgICAgIH0KCiAgICAgICAgcnVudGltZS53cmFwID0gd3JhcDsgLy8gVHJ5L2NhdGNoIGhlbHBlciB0byBtaW5pbWl6ZSBkZW9wdGltaXphdGlvbnMuIFJldHVybnMgYSBjb21wbGV0aW9uCiAgICAgICAgLy8gcmVjb3JkIGxpa2UgY29udGV4dC50cnlFbnRyaWVzW2ldLmNvbXBsZXRpb24uIFRoaXMgaW50ZXJmYWNlIGNvdWxkCiAgICAgICAgLy8gaGF2ZSBiZWVuIChhbmQgd2FzIHByZXZpb3VzbHkpIGRlc2lnbmVkIHRvIHRha2UgYSBjbG9zdXJlIHRvIGJlCiAgICAgICAgLy8gaW52b2tlZCB3aXRob3V0IGFyZ3VtZW50cywgYnV0IGluIGFsbCB0aGUgY2FzZXMgd2UgY2FyZSBhYm91dCB3ZQogICAgICAgIC8vIGFscmVhZHkgaGF2ZSBhbiBleGlzdGluZyBtZXRob2Qgd2Ugd2FudCB0byBjYWxsLCBzbyB0aGVyZSdzIG5vIG5lZWQKICAgICAgICAvLyB0byBjcmVhdGUgYSBuZXcgZnVuY3Rpb24gb2JqZWN0LiBXZSBjYW4gZXZlbiBnZXQgYXdheSB3aXRoIGFzc3VtaW5nCiAgICAgICAgLy8gdGhlIG1ldGhvZCB0YWtlcyBleGFjdGx5IG9uZSBhcmd1bWVudCwgc2luY2UgdGhhdCBoYXBwZW5zIHRvIGJlIHRydWUKICAgICAgICAvLyBpbiBldmVyeSBjYXNlLCBzbyB3ZSBkb24ndCBoYXZlIHRvIHRvdWNoIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBUaGUKICAgICAgICAvLyBvbmx5IGFkZGl0aW9uYWwgYWxsb2NhdGlvbiByZXF1aXJlZCBpcyB0aGUgY29tcGxldGlvbiByZWNvcmQsIHdoaWNoCiAgICAgICAgLy8gaGFzIGEgc3RhYmxlIHNoYXBlIGFuZCBzbyBob3BlZnVsbHkgc2hvdWxkIGJlIGNoZWFwIHRvIGFsbG9jYXRlLgoKICAgICAgICBmdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgICAgICAgICAgICAgYXJnOiBmbi5jYWxsKG9iaiwgYXJnKQogICAgICAgICAgICB9OwogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdHlwZTogInRocm93IiwKICAgICAgICAgICAgICBhcmc6IGVycgogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkU3RhcnQgPSAic3VzcGVuZGVkU3RhcnQiOwogICAgICAgIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkID0gInN1c3BlbmRlZFlpZWxkIjsKICAgICAgICB2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAiZXhlY3V0aW5nIjsKICAgICAgICB2YXIgR2VuU3RhdGVDb21wbGV0ZWQgPSAiY29tcGxldGVkIjsgLy8gUmV0dXJuaW5nIHRoaXMgb2JqZWN0IGZyb20gdGhlIGlubmVyRm4gaGFzIHRoZSBzYW1lIGVmZmVjdCBhcwogICAgICAgIC8vIGJyZWFraW5nIG91dCBvZiB0aGUgZGlzcGF0Y2ggc3dpdGNoIHN0YXRlbWVudC4KCiAgICAgICAgdmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTsgLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kCiAgICAgICAgLy8gLmNvbnN0cnVjdG9yLnByb3RvdHlwZSBwcm9wZXJ0aWVzIGZvciBmdW5jdGlvbnMgdGhhdCByZXR1cm4gR2VuZXJhdG9yCiAgICAgICAgLy8gb2JqZWN0cy4gRm9yIGZ1bGwgc3BlYyBjb21wbGlhbmNlLCB5b3UgbWF5IHdpc2ggdG8gY29uZmlndXJlIHlvdXIKICAgICAgICAvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLgoKICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fQoKICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9CgogICAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30gLy8gVGhpcyBpcyBhIHBvbHlmaWxsIGZvciAlSXRlcmF0b3JQcm90b3R5cGUlIGZvciBlbnZpcm9ubWVudHMgdGhhdAogICAgICAgIC8vIGRvbid0IG5hdGl2ZWx5IHN1cHBvcnQgaXQuCgoKICAgICAgICB2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKCiAgICAgICAgSXRlcmF0b3JQcm90b3R5cGVbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwogICAgICAgIHZhciBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTsKCiAgICAgICAgaWYgKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpKSB7CiAgICAgICAgICAvLyBUaGlzIGVudmlyb25tZW50IGhhcyBhIG5hdGl2ZSAlSXRlcmF0b3JQcm90b3R5cGUlOyB1c2UgaXQgaW5zdGVhZAogICAgICAgICAgLy8gb2YgdGhlIHBvbHlmaWxsLgogICAgICAgICAgSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTsKICAgICAgICB9CgogICAgICAgIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTsKICAgICAgICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwogICAgICAgIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gR2VuZXJhdG9yRnVuY3Rpb247CiAgICAgICAgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGVbdG9TdHJpbmdUYWdTeW1ib2xdID0gR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSAiR2VuZXJhdG9yRnVuY3Rpb24iOyAvLyBIZWxwZXIgZm9yIGRlZmluaW5nIHRoZSAubmV4dCwgLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzIG9mIHRoZQogICAgICAgIC8vIEl0ZXJhdG9yIGludGVyZmFjZSBpbiB0ZXJtcyBvZiBhIHNpbmdsZSAuX2ludm9rZSBtZXRob2QuCgogICAgICAgIGZ1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHsKICAgICAgICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHsKICAgICAgICAgICAgcHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbiAoYXJnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJ1bnRpbWUuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHsKICAgICAgICAgIHZhciBjdG9yID0gdHlwZW9mIGdlbkZ1biA9PT0gImZ1bmN0aW9uIiAmJiBnZW5GdW4uY29uc3RydWN0b3I7CiAgICAgICAgICByZXR1cm4gY3RvciA/IGN0b3IgPT09IEdlbmVyYXRvckZ1bmN0aW9uIHx8IC8vIEZvciB0aGUgbmF0aXZlIEdlbmVyYXRvckZ1bmN0aW9uIGNvbnN0cnVjdG9yLCB0aGUgYmVzdCB3ZSBjYW4KICAgICAgICAgIC8vIGRvIGlzIHRvIGNoZWNrIGl0cyAubmFtZSBwcm9wZXJ0eS4KICAgICAgICAgIChjdG9yLmRpc3BsYXlOYW1lIHx8IGN0b3IubmFtZSkgPT09ICJHZW5lcmF0b3JGdW5jdGlvbiIgOiBmYWxzZTsKICAgICAgICB9OwoKICAgICAgICBydW50aW1lLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnNldFByb3RvdHlwZU9mKSB7CiAgICAgICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdlbkZ1bi5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKCiAgICAgICAgICAgIGlmICghKHRvU3RyaW5nVGFnU3ltYm9sIGluIGdlbkZ1bikpIHsKICAgICAgICAgICAgICBnZW5GdW5bdG9TdHJpbmdUYWdTeW1ib2xdID0gIkdlbmVyYXRvckZ1bmN0aW9uIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKTsKICAgICAgICAgIHJldHVybiBnZW5GdW47CiAgICAgICAgfTsgLy8gV2l0aGluIHRoZSBib2R5IG9mIGFueSBhc3luYyBmdW5jdGlvbiwgYGF3YWl0IHhgIGlzIHRyYW5zZm9ybWVkIHRvCiAgICAgICAgLy8gYHlpZWxkIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh4KWAsIHNvIHRoYXQgdGhlIHJ1bnRpbWUgY2FuIHRlc3QKICAgICAgICAvLyBgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IilgIHRvIGRldGVybWluZSBpZiB0aGUgeWllbGRlZCB2YWx1ZSBpcwogICAgICAgIC8vIG1lYW50IHRvIGJlIGF3YWl0ZWQuCgoKICAgICAgICBydW50aW1lLmF3cmFwID0gZnVuY3Rpb24gKGFyZykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgX19hd2FpdDogYXJnCiAgICAgICAgICB9OwogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yKSB7CiAgICAgICAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTsKCiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CgogICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIGludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICBpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uICh1bndyYXBwZWQpIHsKICAgICAgICAgICAgICAgIC8vIFdoZW4gYSB5aWVsZGVkIFByb21pc2UgaXMgcmVzb2x2ZWQsIGl0cyBmaW5hbCB2YWx1ZSBiZWNvbWVzCiAgICAgICAgICAgICAgICAvLyB0aGUgLnZhbHVlIG9mIHRoZSBQcm9taXNlPHt2YWx1ZSxkb25lfT4gcmVzdWx0IGZvciB0aGUKICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgaXRlcmF0aW9uLgogICAgICAgICAgICAgICAgcmVzdWx0LnZhbHVlID0gdW53cmFwcGVkOwogICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgICAgLy8gSWYgYSByZWplY3RlZCBQcm9taXNlIHdhcyB5aWVsZGVkLCB0aHJvdyB0aGUgcmVqZWN0aW9uIGJhY2sKICAgICAgICAgICAgICAgIC8vIGludG8gdGhlIGFzeW5jIGdlbmVyYXRvciBmdW5jdGlvbiBzbyBpdCBjYW4gYmUgaGFuZGxlZCB0aGVyZS4KICAgICAgICAgICAgICAgIHJldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcHJldmlvdXNQcm9taXNlOwoKICAgICAgICAgIGZ1bmN0aW9uIGVucXVldWUobWV0aG9kLCBhcmcpIHsKICAgICAgICAgICAgZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHByZXZpb3VzUHJvbWlzZSA9IC8vIElmIGVucXVldWUgaGFzIGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiB3ZSB3YW50IHRvIHdhaXQgdW50aWwKICAgICAgICAgICAgLy8gYWxsIHByZXZpb3VzIFByb21pc2VzIGhhdmUgYmVlbiByZXNvbHZlZCBiZWZvcmUgY2FsbGluZyBpbnZva2UsCiAgICAgICAgICAgIC8vIHNvIHRoYXQgcmVzdWx0cyBhcmUgYWx3YXlzIGRlbGl2ZXJlZCBpbiB0aGUgY29ycmVjdCBvcmRlci4gSWYKICAgICAgICAgICAgLy8gZW5xdWV1ZSBoYXMgbm90IGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiBpdCBpcyBpbXBvcnRhbnQgdG8KICAgICAgICAgICAgLy8gY2FsbCBpbnZva2UgaW1tZWRpYXRlbHksIHdpdGhvdXQgd2FpdGluZyBvbiBhIGNhbGxiYWNrIHRvIGZpcmUsCiAgICAgICAgICAgIC8vIHNvIHRoYXQgdGhlIGFzeW5jIGdlbmVyYXRvciBmdW5jdGlvbiBoYXMgdGhlIG9wcG9ydHVuaXR5IHRvIGRvCiAgICAgICAgICAgIC8vIGFueSBuZWNlc3Nhcnkgc2V0dXAgaW4gYSBwcmVkaWN0YWJsZSB3YXkuIFRoaXMgcHJlZGljdGFiaWxpdHkKICAgICAgICAgICAgLy8gaXMgd2h5IHRoZSBQcm9taXNlIGNvbnN0cnVjdG9yIHN5bmNocm9ub3VzbHkgaW52b2tlcyBpdHMKICAgICAgICAgICAgLy8gZXhlY3V0b3IgY2FsbGJhY2ssIGFuZCB3aHkgYXN5bmMgZnVuY3Rpb25zIHN5bmNocm9ub3VzbHkKICAgICAgICAgICAgLy8gZXhlY3V0ZSBjb2RlIGJlZm9yZSB0aGUgZmlyc3QgYXdhaXQuIFNpbmNlIHdlIGltcGxlbWVudCBzaW1wbGUKICAgICAgICAgICAgLy8gYXN5bmMgZnVuY3Rpb25zIGluIHRlcm1zIG9mIGFzeW5jIGdlbmVyYXRvcnMsIGl0IGlzIGVzcGVjaWFsbHkKICAgICAgICAgICAgLy8gaW1wb3J0YW50IHRvIGdldCB0aGlzIHJpZ2h0LCBldmVuIHRob3VnaCBpdCByZXF1aXJlcyBjYXJlLgogICAgICAgICAgICBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgLy8gQXZvaWQgcHJvcGFnYXRpbmcgZmFpbHVyZXMgdG8gUHJvbWlzZXMgcmV0dXJuZWQgYnkgbGF0ZXIKICAgICAgICAgICAgLy8gaW52b2NhdGlvbnMgb2YgdGhlIGl0ZXJhdG9yLgogICAgICAgICAgICBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogICAgICAgICAgfSAvLyBEZWZpbmUgdGhlIHVuaWZpZWQgaGVscGVyIG1ldGhvZCB0aGF0IGlzIHVzZWQgdG8gaW1wbGVtZW50IC5uZXh0LAogICAgICAgICAgLy8gLnRocm93LCBhbmQgLnJldHVybiAoc2VlIGRlZmluZUl0ZXJhdG9yTWV0aG9kcykuCgoKICAgICAgICAgIHRoaXMuX2ludm9rZSA9IGVucXVldWU7CiAgICAgICAgfQoKICAgICAgICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpOwoKICAgICAgICBBc3luY0l0ZXJhdG9yLnByb3RvdHlwZVthc3luY0l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgICAgIHJ1bnRpbWUuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3I7IC8vIE5vdGUgdGhhdCBzaW1wbGUgYXN5bmMgZnVuY3Rpb25zIGFyZSBpbXBsZW1lbnRlZCBvbiB0b3Agb2YKICAgICAgICAvLyBBc3luY0l0ZXJhdG9yIG9iamVjdHM7IHRoZXkganVzdCByZXR1cm4gYSBQcm9taXNlIGZvciB0aGUgdmFsdWUgb2YKICAgICAgICAvLyB0aGUgZmluYWwgcmVzdWx0IHByb2R1Y2VkIGJ5IHRoZSBpdGVyYXRvci4KCiAgICAgICAgcnVudGltZS5hc3luYyA9IGZ1bmN0aW9uIChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkgewogICAgICAgICAgdmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSk7CiAgICAgICAgICByZXR1cm4gcnVudGltZS5pc0dlbmVyYXRvckZ1bmN0aW9uKG91dGVyRm4pID8gaXRlciAvLyBJZiBvdXRlckZuIGlzIGEgZ2VuZXJhdG9yLCByZXR1cm4gdGhlIGZ1bGwgaXRlcmF0b3IuCiAgICAgICAgICA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkgewogICAgICAgICAgdmFyIHN0YXRlID0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydDsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZUV4ZWN1dGluZykgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlQ29tcGxldGVkKSB7CiAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgdGhyb3cgYXJnOwogICAgICAgICAgICAgIH0gLy8gQmUgZm9yZ2l2aW5nLCBwZXIgMjUuMy4zLjMuMyBvZiB0aGUgc3BlYzoKICAgICAgICAgICAgICAvLyBodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtZ2VuZXJhdG9ycmVzdW1lCgoKICAgICAgICAgICAgICByZXR1cm4gZG9uZVJlc3VsdCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDsKICAgICAgICAgICAgY29udGV4dC5hcmcgPSBhcmc7CgogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgIHZhciBkZWxlZ2F0ZSA9IGNvbnRleHQuZGVsZWdhdGU7CgogICAgICAgICAgICAgIGlmIChkZWxlZ2F0ZSkgewogICAgICAgICAgICAgICAgdmFyIGRlbGVnYXRlUmVzdWx0ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7CgogICAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlUmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxlZ2F0ZVJlc3VsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gIm5leHQiKSB7CiAgICAgICAgICAgICAgICAvLyBTZXR0aW5nIGNvbnRleHQuX3NlbnQgZm9yIGxlZ2FjeSBzdXBwb3J0IG9mIEJhYmVsJ3MKICAgICAgICAgICAgICAgIC8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uCiAgICAgICAgICAgICAgICBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gY29udGV4dC5hcmc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVDb21wbGV0ZWQ7CiAgICAgICAgICAgICAgICAgIHRocm93IGNvbnRleHQuYXJnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09ICJyZXR1cm4iKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUV4ZWN1dGluZzsKICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7CgogICAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gIm5vcm1hbCIpIHsKICAgICAgICAgICAgICAgIC8vIElmIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24gZnJvbSBpbm5lckZuLCB3ZSBsZWF2ZSBzdGF0ZSA9PT0KICAgICAgICAgICAgICAgIC8vIEdlblN0YXRlRXhlY3V0aW5nIGFuZCBsb29wIGJhY2sgZm9yIGFub3RoZXIgaW52b2NhdGlvbi4KICAgICAgICAgICAgICAgIHN0YXRlID0gY29udGV4dC5kb25lID8gR2VuU3RhdGVDb21wbGV0ZWQgOiBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkOwoKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiByZWNvcmQuYXJnLAogICAgICAgICAgICAgICAgICBkb25lOiBjb250ZXh0LmRvbmUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDsgLy8gRGlzcGF0Y2ggdGhlIGV4Y2VwdGlvbiBieSBsb29waW5nIGJhY2sgYXJvdW5kIHRvIHRoZQogICAgICAgICAgICAgICAgLy8gY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZykgY2FsbCBhYm92ZS4KCiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0gLy8gQ2FsbCBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF0oY29udGV4dC5hcmcpIGFuZCBoYW5kbGUgdGhlCiAgICAgICAgLy8gcmVzdWx0LCBlaXRoZXIgYnkgcmV0dXJuaW5nIGEgeyB2YWx1ZSwgZG9uZSB9IHJlc3VsdCBmcm9tIHRoZQogICAgICAgIC8vIGRlbGVnYXRlIGl0ZXJhdG9yLCBvciBieSBtb2RpZnlpbmcgY29udGV4dC5tZXRob2QgYW5kIGNvbnRleHQuYXJnLAogICAgICAgIC8vIHNldHRpbmcgY29udGV4dC5kZWxlZ2F0ZSB0byBudWxsLCBhbmQgcmV0dXJuaW5nIHRoZSBDb250aW51ZVNlbnRpbmVsLgoKCiAgICAgICAgZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkgewogICAgICAgICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTsKCiAgICAgICAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gQSAudGhyb3cgb3IgLnJldHVybiB3aGVuIHRoZSBkZWxlZ2F0ZSBpdGVyYXRvciBoYXMgbm8gLnRocm93CiAgICAgICAgICAgIC8vIG1ldGhvZCBhbHdheXMgdGVybWluYXRlcyB0aGUgeWllbGQqIGxvb3AuCiAgICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwoKICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlLml0ZXJhdG9yWyJyZXR1cm4iXSkgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBhIHJldHVybiBtZXRob2QsIGdpdmUgaXQgYQogICAgICAgICAgICAgICAgLy8gY2hhbmNlIHRvIGNsZWFuIHVwLgogICAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAicmV0dXJuIjsKICAgICAgICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7CgogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICAgIC8vIElmIG1heWJlSW52b2tlRGVsZWdhdGUoY29udGV4dCkgY2hhbmdlZCBjb250ZXh0Lm1ldGhvZCBmcm9tCiAgICAgICAgICAgICAgICAgIC8vICJyZXR1cm4iIHRvICJ0aHJvdyIsIGxldCB0aGF0IG92ZXJyaWRlIHRoZSBUeXBlRXJyb3IgYmVsb3cuCiAgICAgICAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAidGhyb3ciOwogICAgICAgICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAndGhyb3cnIG1ldGhvZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpOwoKICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbmZvID0gcmVjb3JkLmFyZzsKCiAgICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAidGhyb3ciOwogICAgICAgICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0Iik7CiAgICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaW5mby5kb25lKSB7CiAgICAgICAgICAgIC8vIEFzc2lnbiB0aGUgcmVzdWx0IG9mIHRoZSBmaW5pc2hlZCBkZWxlZ2F0ZSB0byB0aGUgdGVtcG9yYXJ5CiAgICAgICAgICAgIC8vIHZhcmlhYmxlIHNwZWNpZmllZCBieSBkZWxlZ2F0ZS5yZXN1bHROYW1lIChzZWUgZGVsZWdhdGVZaWVsZCkuCiAgICAgICAgICAgIGNvbnRleHRbZGVsZWdhdGUucmVzdWx0TmFtZV0gPSBpbmZvLnZhbHVlOyAvLyBSZXN1bWUgZXhlY3V0aW9uIGF0IHRoZSBkZXNpcmVkIGxvY2F0aW9uIChzZWUgZGVsZWdhdGVZaWVsZCkuCgogICAgICAgICAgICBjb250ZXh0Lm5leHQgPSBkZWxlZ2F0ZS5uZXh0TG9jOyAvLyBJZiBjb250ZXh0Lm1ldGhvZCB3YXMgInRocm93IiBidXQgdGhlIGRlbGVnYXRlIGhhbmRsZWQgdGhlCiAgICAgICAgICAgIC8vIGV4Y2VwdGlvbiwgbGV0IHRoZSBvdXRlciBnZW5lcmF0b3IgcHJvY2VlZCBub3JtYWxseS4gSWYKICAgICAgICAgICAgLy8gY29udGV4dC5tZXRob2Qgd2FzICJuZXh0IiwgZm9yZ2V0IGNvbnRleHQuYXJnIHNpbmNlIGl0IGhhcyBiZWVuCiAgICAgICAgICAgIC8vICJjb25zdW1lZCIgYnkgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yLiBJZiBjb250ZXh0Lm1ldGhvZCB3YXMKICAgICAgICAgICAgLy8gInJldHVybiIsIGFsbG93IHRoZSBvcmlnaW5hbCAucmV0dXJuIGNhbGwgdG8gY29udGludWUgaW4gdGhlCiAgICAgICAgICAgIC8vIG91dGVyIGdlbmVyYXRvci4KCiAgICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCAhPT0gInJldHVybiIpIHsKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gUmUteWllbGQgdGhlIHJlc3VsdCByZXR1cm5lZCBieSB0aGUgZGVsZWdhdGUgbWV0aG9kLgogICAgICAgICAgICByZXR1cm4gaW5mbzsKICAgICAgICAgIH0gLy8gVGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGlzIGZpbmlzaGVkLCBzbyBmb3JnZXQgaXQgYW5kIGNvbnRpbnVlIHdpdGgKICAgICAgICAgIC8vIHRoZSBvdXRlciBnZW5lcmF0b3IuCgoKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgfSAvLyBEZWZpbmUgR2VuZXJhdG9yLnByb3RvdHlwZS57bmV4dCx0aHJvdyxyZXR1cm59IGluIHRlcm1zIG9mIHRoZQogICAgICAgIC8vIHVuaWZpZWQgLl9pbnZva2UgaGVscGVyIG1ldGhvZC4KCgogICAgICAgIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhHcCk7CiAgICAgICAgR3BbdG9TdHJpbmdUYWdTeW1ib2xdID0gIkdlbmVyYXRvciI7IC8vIEEgR2VuZXJhdG9yIHNob3VsZCBhbHdheXMgcmV0dXJuIGl0c2VsZiBhcyB0aGUgaXRlcmF0b3Igb2JqZWN0IHdoZW4gdGhlCiAgICAgICAgLy8gQEBpdGVyYXRvciBmdW5jdGlvbiBpcyBjYWxsZWQgb24gaXQuIFNvbWUgYnJvd3NlcnMnIGltcGxlbWVudGF0aW9ucyBvZiB0aGUKICAgICAgICAvLyBpdGVyYXRvciBwcm90b3R5cGUgY2hhaW4gaW5jb3JyZWN0bHkgaW1wbGVtZW50IHRoaXMsIGNhdXNpbmcgdGhlIEdlbmVyYXRvcgogICAgICAgIC8vIG9iamVjdCB0byBub3QgYmUgcmV0dXJuZWQgZnJvbSB0aGlzIGNhbGwuIFRoaXMgZW5zdXJlcyB0aGF0IGRvZXNuJ3QgaGFwcGVuLgogICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvaXNzdWVzLzI3NCBmb3IgbW9yZSBkZXRhaWxzLgoKICAgICAgICBHcFtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgICAgICBHcC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykgewogICAgICAgICAgdmFyIGVudHJ5ID0gewogICAgICAgICAgICB0cnlMb2M6IGxvY3NbMF0KICAgICAgICAgIH07CgogICAgICAgICAgaWYgKDEgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKDIgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXTsKICAgICAgICAgICAgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHsKICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9OwogICAgICAgICAgcmVjb3JkLnR5cGUgPSAibm9ybWFsIjsKICAgICAgICAgIGRlbGV0ZSByZWNvcmQuYXJnOwogICAgICAgICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHsKICAgICAgICAgIC8vIFRoZSByb290IGVudHJ5IG9iamVjdCAoZWZmZWN0aXZlbHkgYSB0cnkgc3RhdGVtZW50IHdpdGhvdXQgYSBjYXRjaAogICAgICAgICAgLy8gb3IgYSBmaW5hbGx5IGJsb2NrKSBnaXZlcyB1cyBhIHBsYWNlIHRvIHN0b3JlIHZhbHVlcyB0aHJvd24gZnJvbQogICAgICAgICAgLy8gbG9jYXRpb25zIHdoZXJlIHRoZXJlIGlzIG5vIGVuY2xvc2luZyB0cnkgc3RhdGVtZW50LgogICAgICAgICAgdGhpcy50cnlFbnRyaWVzID0gW3sKICAgICAgICAgICAgdHJ5TG9jOiAicm9vdCIKICAgICAgICAgIH1dOwogICAgICAgICAgdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpOwogICAgICAgICAgdGhpcy5yZXNldCh0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJ1bnRpbWUua2V5cyA9IGZ1bmN0aW9uIChvYmplY3QpIHsKICAgICAgICAgIHZhciBrZXlzID0gW107CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIG9iamVjdCkgewogICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICAgIH0KCiAgICAgICAgICBrZXlzLnJldmVyc2UoKTsgLy8gUmF0aGVyIHRoYW4gcmV0dXJuaW5nIGFuIG9iamVjdCB3aXRoIGEgbmV4dCBtZXRob2QsIHdlIGtlZXAKICAgICAgICAgIC8vIHRoaW5ncyBzaW1wbGUgYW5kIHJldHVybiB0aGUgbmV4dCBmdW5jdGlvbiBpdHNlbGYuCgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzLnBvcCgpOwoKICAgICAgICAgICAgICBpZiAoa2V5IGluIG9iamVjdCkgewogICAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGtleTsKICAgICAgICAgICAgICAgIG5leHQuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IC8vIFRvIGF2b2lkIGNyZWF0aW5nIGFuIGFkZGl0aW9uYWwgb2JqZWN0LCB3ZSBqdXN0IGhhbmcgdGhlIC52YWx1ZQogICAgICAgICAgICAvLyBhbmQgLmRvbmUgcHJvcGVydGllcyBvZmYgdGhlIG5leHQgZnVuY3Rpb24gb2JqZWN0IGl0c2VsZi4gVGhpcwogICAgICAgICAgICAvLyBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgbWluaWZpZXIgd2lsbCBub3QgYW5vbnltaXplIHRoZSBmdW5jdGlvbi4KCgogICAgICAgICAgICBuZXh0LmRvbmUgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7CiAgICAgICAgICBpZiAoaXRlcmFibGUpIHsKICAgICAgICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gaXRlcmFibGVbaXRlcmF0b3JTeW1ib2xdOwoKICAgICAgICAgICAgaWYgKGl0ZXJhdG9yTWV0aG9kKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIGl0ZXJhYmxlLm5leHQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlcmFibGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkgewogICAgICAgICAgICAgIHZhciBpID0gLTEsCiAgICAgICAgICAgICAgICAgIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICAgICAgICAgd2hpbGUgKCsraSA8IGl0ZXJhYmxlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldOwogICAgICAgICAgICAgICAgICAgIG5leHQuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICByZXR1cm4gbmV4dC5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSZXR1cm4gYW4gaXRlcmF0b3Igd2l0aCBubyB2YWx1ZXMuCgoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG5leHQ6IGRvbmVSZXN1bHQKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBydW50aW1lLnZhbHVlcyA9IHZhbHVlczsKCiAgICAgICAgZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAgICAgICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHNraXBUZW1wUmVzZXQpIHsKICAgICAgICAgICAgdGhpcy5wcmV2ID0gMDsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gMDsgLy8gUmVzZXR0aW5nIGNvbnRleHQuX3NlbnQgZm9yIGxlZ2FjeSBzdXBwb3J0IG9mIEJhYmVsJ3MKICAgICAgICAgICAgLy8gZnVuY3Rpb24uc2VudCBpbXBsZW1lbnRhdGlvbi4KCiAgICAgICAgICAgIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIHRoaXMuYXJnID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTsKCiAgICAgICAgICAgIGlmICghc2tpcFRlbXBSZXNldCkgewogICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykgewogICAgICAgICAgICAgICAgLy8gTm90IHN1cmUgYWJvdXQgdGhlIG9wdGltYWwgb3JkZXIgb2YgdGhlc2UgY29uZGl0aW9uczoKICAgICAgICAgICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gInQiICYmIGhhc093bi5jYWxsKHRoaXMsIG5hbWUpICYmICFpc05hTigrbmFtZS5zbGljZSgxKSkpIHsKICAgICAgICAgICAgICAgICAgdGhpc1tuYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICAgICAgICB0aGlzLmRvbmUgPSB0cnVlOwogICAgICAgICAgICB2YXIgcm9vdEVudHJ5ID0gdGhpcy50cnlFbnRyaWVzWzBdOwogICAgICAgICAgICB2YXIgcm9vdFJlY29yZCA9IHJvb3RFbnRyeS5jb21wbGV0aW9uOwoKICAgICAgICAgICAgaWYgKHJvb3RSZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgIHRocm93IHJvb3RSZWNvcmQuYXJnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpcy5ydmFsOwogICAgICAgICAgfSwKICAgICAgICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihleGNlcHRpb24pIHsKICAgICAgICAgICAgaWYgKHRoaXMuZG9uZSkgewogICAgICAgICAgICAgIHRocm93IGV4Y2VwdGlvbjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7CiAgICAgICAgICAgICAgcmVjb3JkLnR5cGUgPSAidGhyb3ciOwogICAgICAgICAgICAgIHJlY29yZC5hcmcgPSBleGNlcHRpb247CiAgICAgICAgICAgICAgY29udGV4dC5uZXh0ID0gbG9jOwoKICAgICAgICAgICAgICBpZiAoY2F1Z2h0KSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZGlzcGF0Y2hlZCBleGNlcHRpb24gd2FzIGNhdWdodCBieSBhIGNhdGNoIGJsb2NrLAogICAgICAgICAgICAgICAgLy8gdGhlbiBsZXQgdGhhdCBjYXRjaCBibG9jayBoYW5kbGUgdGhlIGV4Y2VwdGlvbiBub3JtYWxseS4KICAgICAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gISFjYXVnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09ICJyb290IikgewogICAgICAgICAgICAgICAgLy8gRXhjZXB0aW9uIHRocm93biBvdXRzaWRlIG9mIGFueSB0cnkgYmxvY2sgdGhhdCBjb3VsZCBoYW5kbGUKICAgICAgICAgICAgICAgIC8vIGl0LCBzbyBzZXQgdGhlIGNvbXBsZXRpb24gdmFsdWUgb2YgdGhlIGVudGlyZSBmdW5jdGlvbiB0bwogICAgICAgICAgICAgICAgLy8gdGhyb3cgdGhlIGV4Y2VwdGlvbi4KICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoImVuZCIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAgICAgICAgICAgICAgIHZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKTsKICAgICAgICAgICAgICAgIHZhciBoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7CgogICAgICAgICAgICAgICAgaWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2F0Y2gpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKCiAgICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgICAgdmFyIGZpbmFsbHlFbnRyeSA9IGVudHJ5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmluYWxseUVudHJ5ICYmICh0eXBlID09PSAiYnJlYWsiIHx8IHR5cGUgPT09ICJjb250aW51ZSIpICYmIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgIC8vIElnbm9yZSB0aGUgZmluYWxseSBlbnRyeSBpZiBjb250cm9sIGlzIG5vdCBqdW1waW5nIHRvIGEKICAgICAgICAgICAgICAvLyBsb2NhdGlvbiBvdXRzaWRlIHRoZSB0cnkvY2F0Y2ggYmxvY2suCiAgICAgICAgICAgICAgZmluYWxseUVudHJ5ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307CiAgICAgICAgICAgIHJlY29yZC50eXBlID0gdHlwZTsKICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGFyZzsKCiAgICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkpIHsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYzsKICAgICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGxldGUocmVjb3JkKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykgewogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICB0aHJvdyByZWNvcmQuYXJnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJicmVhayIgfHwgcmVjb3JkLnR5cGUgPT09ICJjb250aW51ZSIpIHsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSByZWNvcmQuYXJnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgIHRoaXMubmV4dCA9ICJlbmQiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIiAmJiBhZnRlckxvYykgewogICAgICAgICAgICAgIHRoaXMubmV4dCA9IGFmdGVyTG9jOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0sCiAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaChmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CgogICAgICAgICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKTsKICAgICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImNhdGNoIjogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHsKICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uOwoKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRocm93bjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gVGhlIGNvbnRleHQuY2F0Y2ggbWV0aG9kIG11c3Qgb25seSBiZSBjYWxsZWQgd2l0aCBhIGxvY2F0aW9uCiAgICAgICAgICAgIC8vIGFyZ3VtZW50IHRoYXQgY29ycmVzcG9uZHMgdG8gYSBrbm93biBjYXRjaCBibG9jay4KCgogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogICAgICAgICAgfSwKICAgICAgICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHsKICAgICAgICAgICAgdGhpcy5kZWxlZ2F0ZSA9IHsKICAgICAgICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwKICAgICAgICAgICAgICByZXN1bHROYW1lOiByZXN1bHROYW1lLAogICAgICAgICAgICAgIG5leHRMb2M6IG5leHRMb2MKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gIm5leHQiKSB7CiAgICAgICAgICAgICAgLy8gRGVsaWJlcmF0ZWx5IGZvcmdldCB0aGUgbGFzdCBzZW50IHZhbHVlIHNvIHRoYXQgd2UgZG9uJ3QKICAgICAgICAgICAgICAvLyBhY2NpZGVudGFsbHkgcGFzcyBpdCBvbiB0byB0aGUgZGVsZWdhdGUuCiAgICAgICAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0oIC8vIEluIHNsb3BweSBtb2RlLCB1bmJvdW5kIGB0aGlzYCByZWZlcnMgdG8gdGhlIGdsb2JhbCBvYmplY3QsIGZhbGxiYWNrIHRvCiAgICAgIC8vIEZ1bmN0aW9uIGNvbnN0cnVjdG9yIGlmIHdlJ3JlIGluIGdsb2JhbCBzdHJpY3QgbW9kZS4gVGhhdCBpcyBzYWRseSBhIGZvcm0KICAgICAgLy8gb2YgaW5kaXJlY3QgZXZhbCB3aGljaCB2aW9sYXRlcyBDb250ZW50IFNlY3VyaXR5IFBvbGljeS4KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzIHx8IHR5cGVvZiBzZWxmID09PSAib2JqZWN0IiAmJiBzZWxmOwogICAgICB9KCkgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKSk7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNzUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvKioKICAgICAgICogQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuCiAgICAgICAqCiAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAqLwogICAgICAhZnVuY3Rpb24gKGdsb2JhbCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgICAgdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTsKICAgICAgICB2YXIgaGFzT3duID0gT3AuaGFzT3duUHJvcGVydHk7CiAgICAgICAgdmFyIHVuZGVmaW5lZDsgLy8gTW9yZSBjb21wcmVzc2libGUgdGhhbiB2b2lkIDAuCgogICAgICAgIHZhciAkU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiA/IFN5bWJvbCA6IHt9OwogICAgICAgIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiOwogICAgICAgIHZhciBhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiOwogICAgICAgIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogICAgICAgIHZhciBpbk1vZHVsZSA9IHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiOwogICAgICAgIHZhciBydW50aW1lID0gZ2xvYmFsLnJlZ2VuZXJhdG9yUnVudGltZTsKCiAgICAgICAgaWYgKHJ1bnRpbWUpIHsKICAgICAgICAgIGlmIChpbk1vZHVsZSkgewogICAgICAgICAgICAvLyBJZiByZWdlbmVyYXRvclJ1bnRpbWUgaXMgZGVmaW5lZCBnbG9iYWxseSBhbmQgd2UncmUgaW4gYSBtb2R1bGUsCiAgICAgICAgICAgIC8vIG1ha2UgdGhlIGV4cG9ydHMgb2JqZWN0IGlkZW50aWNhbCB0byByZWdlbmVyYXRvclJ1bnRpbWUuCiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gcnVudGltZTsKICAgICAgICAgIH0gLy8gRG9uJ3QgYm90aGVyIGV2YWx1YXRpbmcgdGhlIHJlc3Qgb2YgdGhpcyBmaWxlIGlmIHRoZSBydW50aW1lIHdhcwogICAgICAgICAgLy8gYWxyZWFkeSBkZWZpbmVkIGdsb2JhbGx5LgoKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBEZWZpbmUgdGhlIHJ1bnRpbWUgZ2xvYmFsbHkgKGFzIGV4cGVjdGVkIGJ5IGdlbmVyYXRlZCBjb2RlKSBhcyBlaXRoZXIKICAgICAgICAvLyBtb2R1bGUuZXhwb3J0cyAoaWYgd2UncmUgaW4gYSBtb2R1bGUpIG9yIGEgbmV3LCBlbXB0eSBvYmplY3QuCgoKICAgICAgICBydW50aW1lID0gZ2xvYmFsLnJlZ2VuZXJhdG9yUnVudGltZSA9IGluTW9kdWxlID8gbW9kdWxlLmV4cG9ydHMgOiB7fTsKCiAgICAgICAgZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkgewogICAgICAgICAgLy8gSWYgb3V0ZXJGbiBwcm92aWRlZCBhbmQgb3V0ZXJGbi5wcm90b3R5cGUgaXMgYSBHZW5lcmF0b3IsIHRoZW4gb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IuCiAgICAgICAgICB2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcjsKICAgICAgICAgIHZhciBnZW5lcmF0b3IgPSBPYmplY3QuY3JlYXRlKHByb3RvR2VuZXJhdG9yLnByb3RvdHlwZSk7CiAgICAgICAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTsgLy8gVGhlIC5faW52b2tlIG1ldGhvZCB1bmlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlIC5uZXh0LAogICAgICAgICAgLy8gLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzLgoKICAgICAgICAgIGdlbmVyYXRvci5faW52b2tlID0gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTsKICAgICAgICAgIHJldHVybiBnZW5lcmF0b3I7CiAgICAgICAgfQoKICAgICAgICBydW50aW1lLndyYXAgPSB3cmFwOyAvLyBUcnkvY2F0Y2ggaGVscGVyIHRvIG1pbmltaXplIGRlb3B0aW1pemF0aW9ucy4gUmV0dXJucyBhIGNvbXBsZXRpb24KICAgICAgICAvLyByZWNvcmQgbGlrZSBjb250ZXh0LnRyeUVudHJpZXNbaV0uY29tcGxldGlvbi4gVGhpcyBpbnRlcmZhY2UgY291bGQKICAgICAgICAvLyBoYXZlIGJlZW4gKGFuZCB3YXMgcHJldmlvdXNseSkgZGVzaWduZWQgdG8gdGFrZSBhIGNsb3N1cmUgdG8gYmUKICAgICAgICAvLyBpbnZva2VkIHdpdGhvdXQgYXJndW1lbnRzLCBidXQgaW4gYWxsIHRoZSBjYXNlcyB3ZSBjYXJlIGFib3V0IHdlCiAgICAgICAgLy8gYWxyZWFkeSBoYXZlIGFuIGV4aXN0aW5nIG1ldGhvZCB3ZSB3YW50IHRvIGNhbGwsIHNvIHRoZXJlJ3Mgbm8gbmVlZAogICAgICAgIC8vIHRvIGNyZWF0ZSBhIG5ldyBmdW5jdGlvbiBvYmplY3QuIFdlIGNhbiBldmVuIGdldCBhd2F5IHdpdGggYXNzdW1pbmcKICAgICAgICAvLyB0aGUgbWV0aG9kIHRha2VzIGV4YWN0bHkgb25lIGFyZ3VtZW50LCBzaW5jZSB0aGF0IGhhcHBlbnMgdG8gYmUgdHJ1ZQogICAgICAgIC8vIGluIGV2ZXJ5IGNhc2UsIHNvIHdlIGRvbid0IGhhdmUgdG8gdG91Y2ggdGhlIGFyZ3VtZW50cyBvYmplY3QuIFRoZQogICAgICAgIC8vIG9ubHkgYWRkaXRpb25hbCBhbGxvY2F0aW9uIHJlcXVpcmVkIGlzIHRoZSBjb21wbGV0aW9uIHJlY29yZCwgd2hpY2gKICAgICAgICAvLyBoYXMgYSBzdGFibGUgc2hhcGUgYW5kIHNvIGhvcGVmdWxseSBzaG91bGQgYmUgY2hlYXAgdG8gYWxsb2NhdGUuCgogICAgICAgIGZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB0eXBlOiAibm9ybWFsIiwKICAgICAgICAgICAgICBhcmc6IGZuLmNhbGwob2JqLCBhcmcpCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB0eXBlOiAidGhyb3ciLAogICAgICAgICAgICAgIGFyZzogZXJyCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9ICJzdXNwZW5kZWRTdGFydCI7CiAgICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSAic3VzcGVuZGVkWWllbGQiOwogICAgICAgIHZhciBHZW5TdGF0ZUV4ZWN1dGluZyA9ICJleGVjdXRpbmciOwogICAgICAgIHZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9ICJjb21wbGV0ZWQiOyAvLyBSZXR1cm5pbmcgdGhpcyBvYmplY3QgZnJvbSB0aGUgaW5uZXJGbiBoYXMgdGhlIHNhbWUgZWZmZWN0IGFzCiAgICAgICAgLy8gYnJlYWtpbmcgb3V0IG9mIHRoZSBkaXNwYXRjaCBzd2l0Y2ggc3RhdGVtZW50LgoKICAgICAgICB2YXIgQ29udGludWVTZW50aW5lbCA9IHt9OyAvLyBEdW1teSBjb25zdHJ1Y3RvciBmdW5jdGlvbnMgdGhhdCB3ZSB1c2UgYXMgdGhlIC5jb25zdHJ1Y3RvciBhbmQKICAgICAgICAvLyAuY29uc3RydWN0b3IucHJvdG90eXBlIHByb3BlcnRpZXMgZm9yIGZ1bmN0aW9ucyB0aGF0IHJldHVybiBHZW5lcmF0b3IKICAgICAgICAvLyBvYmplY3RzLiBGb3IgZnVsbCBzcGVjIGNvbXBsaWFuY2UsIHlvdSBtYXkgd2lzaCB0byBjb25maWd1cmUgeW91cgogICAgICAgIC8vIG1pbmlmaWVyIG5vdCB0byBtYW5nbGUgdGhlIG5hbWVzIG9mIHRoZXNlIHR3byBmdW5jdGlvbnMuCgogICAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CgogICAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge30KCiAgICAgICAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUoKSB7fSAvLyBUaGlzIGlzIGEgcG9seWZpbGwgZm9yICVJdGVyYXRvclByb3RvdHlwZSUgZm9yIGVudmlyb25tZW50cyB0aGF0CiAgICAgICAgLy8gZG9uJ3QgbmF0aXZlbHkgc3VwcG9ydCBpdC4KCgogICAgICAgIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9OwoKICAgICAgICBJdGVyYXRvclByb3RvdHlwZVtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7CiAgICAgICAgdmFyIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpOwoKICAgICAgICBpZiAoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgJiYgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmIGhhc093bi5jYWxsKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCkpIHsKICAgICAgICAgIC8vIFRoaXMgZW52aXJvbm1lbnQgaGFzIGEgbmF0aXZlICVJdGVyYXRvclByb3RvdHlwZSU7IHVzZSBpdCBpbnN0ZWFkCiAgICAgICAgICAvLyBvZiB0aGUgcG9seWZpbGwuCiAgICAgICAgICBJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlOwogICAgICAgIH0KCiAgICAgICAgdmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICAgIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdwLmNvbnN0cnVjdG9yID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7CiAgICAgICAgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUuY29uc3RydWN0b3IgPSBHZW5lcmF0b3JGdW5jdGlvbjsKICAgICAgICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZVt0b1N0cmluZ1RhZ1N5bWJvbF0gPSBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9ICJHZW5lcmF0b3JGdW5jdGlvbiI7IC8vIEhlbHBlciBmb3IgZGVmaW5pbmcgdGhlIC5uZXh0LCAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMgb2YgdGhlCiAgICAgICAgLy8gSXRlcmF0b3IgaW50ZXJmYWNlIGluIHRlcm1zIG9mIGEgc2luZ2xlIC5faW52b2tlIG1ldGhvZC4KCiAgICAgICAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkgewogICAgICAgICAgWyJuZXh0IiwgInRocm93IiwgInJldHVybiJdLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkgewogICAgICAgICAgICBwcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uIChhcmcpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcnVudGltZS5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikgewogICAgICAgICAgdmFyIGN0b3IgPSB0eXBlb2YgZ2VuRnVuID09PSAiZnVuY3Rpb24iICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjsKICAgICAgICAgIHJldHVybiBjdG9yID8gY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgLy8gRm9yIHRoZSBuYXRpdmUgR2VuZXJhdG9yRnVuY3Rpb24gY29uc3RydWN0b3IsIHRoZSBiZXN0IHdlIGNhbgogICAgICAgICAgLy8gZG8gaXMgdG8gY2hlY2sgaXRzIC5uYW1lIHByb3BlcnR5LgogICAgICAgICAgKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSA9PT0gIkdlbmVyYXRvckZ1bmN0aW9uIiA6IGZhbHNlOwogICAgICAgIH07CgogICAgICAgIHJ1bnRpbWUubWFyayA9IGZ1bmN0aW9uIChnZW5GdW4pIHsKICAgICAgICAgIGlmIChPYmplY3Quc2V0UHJvdG90eXBlT2YpIHsKICAgICAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwoKICAgICAgICAgICAgaWYgKCEodG9TdHJpbmdUYWdTeW1ib2wgaW4gZ2VuRnVuKSkgewogICAgICAgICAgICAgIGdlbkZ1blt0b1N0cmluZ1RhZ1N5bWJvbF0gPSAiR2VuZXJhdG9yRnVuY3Rpb24iOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApOwogICAgICAgICAgcmV0dXJuIGdlbkZ1bjsKICAgICAgICB9OyAvLyBXaXRoaW4gdGhlIGJvZHkgb2YgYW55IGFzeW5jIGZ1bmN0aW9uLCBgYXdhaXQgeGAgaXMgdHJhbnNmb3JtZWQgdG8KICAgICAgICAvLyBgeWllbGQgcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHgpYCwgc28gdGhhdCB0aGUgcnVudGltZSBjYW4gdGVzdAogICAgICAgIC8vIGBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKWAgdG8gZGV0ZXJtaW5lIGlmIHRoZSB5aWVsZGVkIHZhbHVlIGlzCiAgICAgICAgLy8gbWVhbnQgdG8gYmUgYXdhaXRlZC4KCgogICAgICAgIHJ1bnRpbWUuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBfX2F3YWl0OiBhcmcKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IpIHsKICAgICAgICAgIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChnZW5lcmF0b3JbbWV0aG9kXSwgZ2VuZXJhdG9yLCBhcmcpOwoKICAgICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgcmVqZWN0KHJlY29yZC5hcmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciByZXN1bHQgPSByZWNvcmQuYXJnOwogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJlc3VsdC52YWx1ZTsKCiAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdmFsdWUsIHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIGludm9rZSgidGhyb3ciLCBlcnIsIHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHVud3JhcHBlZCkgewogICAgICAgICAgICAgICAgLy8gV2hlbiBhIHlpZWxkZWQgUHJvbWlzZSBpcyByZXNvbHZlZCwgaXRzIGZpbmFsIHZhbHVlIGJlY29tZXMKICAgICAgICAgICAgICAgIC8vIHRoZSAudmFsdWUgb2YgdGhlIFByb21pc2U8e3ZhbHVlLGRvbmV9PiByZXN1bHQgZm9yIHRoZQogICAgICAgICAgICAgICAgLy8gY3VycmVudCBpdGVyYXRpb24uCiAgICAgICAgICAgICAgICByZXN1bHQudmFsdWUgPSB1bndyYXBwZWQ7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBhIHJlamVjdGVkIFByb21pc2Ugd2FzIHlpZWxkZWQsIHRocm93IHRoZSByZWplY3Rpb24gYmFjawogICAgICAgICAgICAgICAgLy8gaW50byB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIHNvIGl0IGNhbiBiZSBoYW5kbGVkIHRoZXJlLgogICAgICAgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwcmV2aW91c1Byb21pc2U7CgogICAgICAgICAgZnVuY3Rpb24gZW5xdWV1ZShtZXRob2QsIGFyZykgewogICAgICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID0gLy8gSWYgZW5xdWV1ZSBoYXMgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIHdlIHdhbnQgdG8gd2FpdCB1bnRpbAogICAgICAgICAgICAvLyBhbGwgcHJldmlvdXMgUHJvbWlzZXMgaGF2ZSBiZWVuIHJlc29sdmVkIGJlZm9yZSBjYWxsaW5nIGludm9rZSwKICAgICAgICAgICAgLy8gc28gdGhhdCByZXN1bHRzIGFyZSBhbHdheXMgZGVsaXZlcmVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLiBJZgogICAgICAgICAgICAvLyBlbnF1ZXVlIGhhcyBub3QgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIGl0IGlzIGltcG9ydGFudCB0bwogICAgICAgICAgICAvLyBjYWxsIGludm9rZSBpbW1lZGlhdGVseSwgd2l0aG91dCB3YWl0aW5nIG9uIGEgY2FsbGJhY2sgdG8gZmlyZSwKICAgICAgICAgICAgLy8gc28gdGhhdCB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhcyB0aGUgb3Bwb3J0dW5pdHkgdG8gZG8KICAgICAgICAgICAgLy8gYW55IG5lY2Vzc2FyeSBzZXR1cCBpbiBhIHByZWRpY3RhYmxlIHdheS4gVGhpcyBwcmVkaWN0YWJpbGl0eQogICAgICAgICAgICAvLyBpcyB3aHkgdGhlIFByb21pc2UgY29uc3RydWN0b3Igc3luY2hyb25vdXNseSBpbnZva2VzIGl0cwogICAgICAgICAgICAvLyBleGVjdXRvciBjYWxsYmFjaywgYW5kIHdoeSBhc3luYyBmdW5jdGlvbnMgc3luY2hyb25vdXNseQogICAgICAgICAgICAvLyBleGVjdXRlIGNvZGUgYmVmb3JlIHRoZSBmaXJzdCBhd2FpdC4gU2luY2Ugd2UgaW1wbGVtZW50IHNpbXBsZQogICAgICAgICAgICAvLyBhc3luYyBmdW5jdGlvbnMgaW4gdGVybXMgb2YgYXN5bmMgZ2VuZXJhdG9ycywgaXQgaXMgZXNwZWNpYWxseQogICAgICAgICAgICAvLyBpbXBvcnRhbnQgdG8gZ2V0IHRoaXMgcmlnaHQsIGV2ZW4gdGhvdWdoIGl0IHJlcXVpcmVzIGNhcmUuCiAgICAgICAgICAgIHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCAvLyBBdm9pZCBwcm9wYWdhdGluZyBmYWlsdXJlcyB0byBQcm9taXNlcyByZXR1cm5lZCBieSBsYXRlcgogICAgICAgICAgICAvLyBpbnZvY2F0aW9ucyBvZiB0aGUgaXRlcmF0b3IuCiAgICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7CiAgICAgICAgICB9IC8vIERlZmluZSB0aGUgdW5pZmllZCBoZWxwZXIgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgLm5leHQsCiAgICAgICAgICAvLyAudGhyb3csIGFuZCAucmV0dXJuIChzZWUgZGVmaW5lSXRlcmF0b3JNZXRob2RzKS4KCgogICAgICAgICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTsKICAgICAgICB9CgogICAgICAgIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7CgogICAgICAgIEFzeW5jSXRlcmF0b3IucHJvdG90eXBlW2FzeW5jSXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICAgICAgcnVudGltZS5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvcjsgLy8gTm90ZSB0aGF0IHNpbXBsZSBhc3luYyBmdW5jdGlvbnMgYXJlIGltcGxlbWVudGVkIG9uIHRvcCBvZgogICAgICAgIC8vIEFzeW5jSXRlcmF0b3Igb2JqZWN0czsgdGhleSBqdXN0IHJldHVybiBhIFByb21pc2UgZm9yIHRoZSB2YWx1ZSBvZgogICAgICAgIC8vIHRoZSBmaW5hbCByZXN1bHQgcHJvZHVjZWQgYnkgdGhlIGl0ZXJhdG9yLgoKICAgICAgICBydW50aW1lLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7CiAgICAgICAgICB2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpKTsKICAgICAgICAgIHJldHVybiBydW50aW1lLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIC8vIElmIG91dGVyRm4gaXMgYSBnZW5lcmF0b3IsIHJldHVybiB0aGUgZnVsbCBpdGVyYXRvci4KICAgICAgICAgIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQuZG9uZSA/IHJlc3VsdC52YWx1ZSA6IGl0ZXIubmV4dCgpOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0OwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZykgewogICAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVDb21wbGV0ZWQpIHsKICAgICAgICAgICAgICBpZiAobWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBhcmc7CiAgICAgICAgICAgICAgfSAvLyBCZSBmb3JnaXZpbmcsIHBlciAyNS4zLjMuMy4zIG9mIHRoZSBzcGVjOgogICAgICAgICAgICAgIC8vIGh0dHBzOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy1nZW5lcmF0b3JyZXN1bWUKCgogICAgICAgICAgICAgIHJldHVybiBkb25lUmVzdWx0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gbWV0aG9kOwogICAgICAgICAgICBjb250ZXh0LmFyZyA9IGFyZzsKCiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTsKCiAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlKSB7CiAgICAgICAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlUmVzdWx0ID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlbGVnYXRlUmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAibmV4dCIpIHsKICAgICAgICAgICAgICAgIC8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwncwogICAgICAgICAgICAgICAgLy8gZnVuY3Rpb24uc2VudCBpbXBsZW1lbnRhdGlvbi4KICAgICAgICAgICAgICAgIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQpIHsKICAgICAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDsKICAgICAgICAgICAgICAgICAgdGhyb3cgY29udGV4dC5hcmc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInJldHVybiIpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjb250ZXh0LmFyZyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlRXhlY3V0aW5nOwogICAgICAgICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTsKCiAgICAgICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIikgewogICAgICAgICAgICAgICAgLy8gSWYgYW4gZXhjZXB0aW9uIGlzIHRocm93biBmcm9tIGlubmVyRm4sIHdlIGxlYXZlIHN0YXRlID09PQogICAgICAgICAgICAgICAgLy8gR2VuU3RhdGVFeGVjdXRpbmcgYW5kIGxvb3AgYmFjayBmb3IgYW5vdGhlciBpbnZvY2F0aW9uLgogICAgICAgICAgICAgICAgc3RhdGUgPSBjb250ZXh0LmRvbmUgPyBHZW5TdGF0ZUNvbXBsZXRlZCA6IEdlblN0YXRlU3VzcGVuZGVkWWllbGQ7CgogICAgICAgICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHJlY29yZC5hcmcsCiAgICAgICAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkOyAvLyBEaXNwYXRjaCB0aGUgZXhjZXB0aW9uIGJ5IGxvb3BpbmcgYmFjayBhcm91bmQgdG8gdGhlCiAgICAgICAgICAgICAgICAvLyBjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKSBjYWxsIGFib3ZlLgoKICAgICAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgICAgIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSAvLyBDYWxsIGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXShjb250ZXh0LmFyZykgYW5kIGhhbmRsZSB0aGUKICAgICAgICAvLyByZXN1bHQsIGVpdGhlciBieSByZXR1cm5pbmcgYSB7IHZhbHVlLCBkb25lIH0gcmVzdWx0IGZyb20gdGhlCiAgICAgICAgLy8gZGVsZWdhdGUgaXRlcmF0b3IsIG9yIGJ5IG1vZGlmeWluZyBjb250ZXh0Lm1ldGhvZCBhbmQgY29udGV4dC5hcmcsCiAgICAgICAgLy8gc2V0dGluZyBjb250ZXh0LmRlbGVnYXRlIHRvIG51bGwsIGFuZCByZXR1cm5pbmcgdGhlIENvbnRpbnVlU2VudGluZWwuCgoKICAgICAgICBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7CiAgICAgICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbY29udGV4dC5tZXRob2RdOwoKICAgICAgICAgIGlmIChtZXRob2QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyBBIC50aHJvdyBvciAucmV0dXJuIHdoZW4gdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBubyAudGhyb3cKICAgICAgICAgICAgLy8gbWV0aG9kIGFsd2F5cyB0ZXJtaW5hdGVzIHRoZSB5aWVsZCogbG9vcC4KICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CgogICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIGEgcmV0dXJuIG1ldGhvZCwgZ2l2ZSBpdCBhCiAgICAgICAgICAgICAgICAvLyBjaGFuY2UgdG8gY2xlYW4gdXAuCiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgICAgLy8gSWYgbWF5YmVJbnZva2VEZWxlZ2F0ZShjb250ZXh0KSBjaGFuZ2VkIGNvbnRleHQubWV0aG9kIGZyb20KICAgICAgICAgICAgICAgICAgLy8gInJldHVybiIgdG8gInRocm93IiwgbGV0IHRoYXQgb3ZlcnJpZGUgdGhlIFR5cGVFcnJvciBiZWxvdy4KICAgICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7CgogICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnOwogICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGluZm8gPSByZWNvcmQuYXJnOwoKICAgICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgICAgLy8gQXNzaWduIHRoZSByZXN1bHQgb2YgdGhlIGZpbmlzaGVkIGRlbGVnYXRlIHRvIHRoZSB0ZW1wb3JhcnkKICAgICAgICAgICAgLy8gdmFyaWFibGUgc3BlY2lmaWVkIGJ5IGRlbGVnYXRlLnJlc3VsdE5hbWUgKHNlZSBkZWxlZ2F0ZVlpZWxkKS4KICAgICAgICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7IC8vIFJlc3VtZSBleGVjdXRpb24gYXQgdGhlIGRlc2lyZWQgbG9jYXRpb24gKHNlZSBkZWxlZ2F0ZVlpZWxkKS4KCiAgICAgICAgICAgIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7IC8vIElmIGNvbnRleHQubWV0aG9kIHdhcyAidGhyb3ciIGJ1dCB0aGUgZGVsZWdhdGUgaGFuZGxlZCB0aGUKICAgICAgICAgICAgLy8gZXhjZXB0aW9uLCBsZXQgdGhlIG91dGVyIGdlbmVyYXRvciBwcm9jZWVkIG5vcm1hbGx5LiBJZgogICAgICAgICAgICAvLyBjb250ZXh0Lm1ldGhvZCB3YXMgIm5leHQiLCBmb3JnZXQgY29udGV4dC5hcmcgc2luY2UgaXQgaGFzIGJlZW4KICAgICAgICAgICAgLy8gImNvbnN1bWVkIiBieSB0aGUgZGVsZWdhdGUgaXRlcmF0b3IuIElmIGNvbnRleHQubWV0aG9kIHdhcwogICAgICAgICAgICAvLyAicmV0dXJuIiwgYWxsb3cgdGhlIG9yaWdpbmFsIC5yZXR1cm4gY2FsbCB0byBjb250aW51ZSBpbiB0aGUKICAgICAgICAgICAgLy8gb3V0ZXIgZ2VuZXJhdG9yLgoKICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kICE9PSAicmV0dXJuIikgewogICAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBSZS15aWVsZCB0aGUgcmVzdWx0IHJldHVybmVkIGJ5IHRoZSBkZWxlZ2F0ZSBtZXRob2QuCiAgICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgICAgfSAvLyBUaGUgZGVsZWdhdGUgaXRlcmF0b3IgaXMgZmluaXNoZWQsIHNvIGZvcmdldCBpdCBhbmQgY29udGludWUgd2l0aAogICAgICAgICAgLy8gdGhlIG91dGVyIGdlbmVyYXRvci4KCgogICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICB9IC8vIERlZmluZSBHZW5lcmF0b3IucHJvdG90eXBlLntuZXh0LHRocm93LHJldHVybn0gaW4gdGVybXMgb2YgdGhlCiAgICAgICAgLy8gdW5pZmllZCAuX2ludm9rZSBoZWxwZXIgbWV0aG9kLgoKCiAgICAgICAgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKTsKICAgICAgICBHcFt0b1N0cmluZ1RhZ1N5bWJvbF0gPSAiR2VuZXJhdG9yIjsgLy8gQSBHZW5lcmF0b3Igc2hvdWxkIGFsd2F5cyByZXR1cm4gaXRzZWxmIGFzIHRoZSBpdGVyYXRvciBvYmplY3Qgd2hlbiB0aGUKICAgICAgICAvLyBAQGl0ZXJhdG9yIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBpdC4gU29tZSBicm93c2VycycgaW1wbGVtZW50YXRpb25zIG9mIHRoZQogICAgICAgIC8vIGl0ZXJhdG9yIHByb3RvdHlwZSBjaGFpbiBpbmNvcnJlY3RseSBpbXBsZW1lbnQgdGhpcywgY2F1c2luZyB0aGUgR2VuZXJhdG9yCiAgICAgICAgLy8gb2JqZWN0IHRvIG5vdCBiZSByZXR1cm5lZCBmcm9tIHRoaXMgY2FsbC4gVGhpcyBlbnN1cmVzIHRoYXQgZG9lc24ndCBoYXBwZW4uCiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9pc3N1ZXMvMjc0IGZvciBtb3JlIGRldGFpbHMuCgogICAgICAgIEdwW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgICAgIEdwLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iOwogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7CiAgICAgICAgICB2YXIgZW50cnkgPSB7CiAgICAgICAgICAgIHRyeUxvYzogbG9jc1swXQogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAoMSBpbiBsb2NzKSB7CiAgICAgICAgICAgIGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoMiBpbiBsb2NzKSB7CiAgICAgICAgICAgIGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdOwogICAgICAgICAgICBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM107CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkgewogICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb24gfHwge307CiAgICAgICAgICByZWNvcmQudHlwZSA9ICJub3JtYWwiOwogICAgICAgICAgZGVsZXRlIHJlY29yZC5hcmc7CiAgICAgICAgICBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkgewogICAgICAgICAgLy8gVGhlIHJvb3QgZW50cnkgb2JqZWN0IChlZmZlY3RpdmVseSBhIHRyeSBzdGF0ZW1lbnQgd2l0aG91dCBhIGNhdGNoCiAgICAgICAgICAvLyBvciBhIGZpbmFsbHkgYmxvY2spIGdpdmVzIHVzIGEgcGxhY2UgdG8gc3RvcmUgdmFsdWVzIHRocm93biBmcm9tCiAgICAgICAgICAvLyBsb2NhdGlvbnMgd2hlcmUgdGhlcmUgaXMgbm8gZW5jbG9zaW5nIHRyeSBzdGF0ZW1lbnQuCiAgICAgICAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogICAgICAgICAgICB0cnlMb2M6ICJyb290IgogICAgICAgICAgfV07CiAgICAgICAgICB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyk7CiAgICAgICAgICB0aGlzLnJlc2V0KHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcnVudGltZS5rZXlzID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgICAgICAgdmFyIGtleXMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgICAgfQoKICAgICAgICAgIGtleXMucmV2ZXJzZSgpOyAvLyBSYXRoZXIgdGhhbiByZXR1cm5pbmcgYW4gb2JqZWN0IHdpdGggYSBuZXh0IG1ldGhvZCwgd2Uga2VlcAogICAgICAgICAgLy8gdGhpbmdzIHNpbXBsZSBhbmQgcmV0dXJuIHRoZSBuZXh0IGZ1bmN0aW9uIGl0c2VsZi4KCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgICAgd2hpbGUgKGtleXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdmFyIGtleSA9IGtleXMucG9wKCk7CgogICAgICAgICAgICAgIGlmIChrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgICBuZXh0LnZhbHVlID0ga2V5OwogICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gVG8gYXZvaWQgY3JlYXRpbmcgYW4gYWRkaXRpb25hbCBvYmplY3QsIHdlIGp1c3QgaGFuZyB0aGUgLnZhbHVlCiAgICAgICAgICAgIC8vIGFuZCAuZG9uZSBwcm9wZXJ0aWVzIG9mZiB0aGUgbmV4dCBmdW5jdGlvbiBvYmplY3QgaXRzZWxmLiBUaGlzCiAgICAgICAgICAgIC8vIGFsc28gZW5zdXJlcyB0aGF0IHRoZSBtaW5pZmllciB3aWxsIG5vdCBhbm9ueW1pemUgdGhlIGZ1bmN0aW9uLgoKCiAgICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHsKICAgICAgICAgIGlmIChpdGVyYWJsZSkgewogICAgICAgICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07CgogICAgICAgICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlcmFibGUubmV4dCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIHJldHVybiBpdGVyYWJsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgdmFyIGkgPSAtMSwKICAgICAgICAgICAgICAgICAgbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoKytpIDwgaXRlcmFibGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaSkpIHsKICAgICAgICAgICAgICAgICAgICBuZXh0LnZhbHVlID0gaXRlcmFibGVbaV07CiAgICAgICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuZXh0LnZhbHVlID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgbmV4dC5kb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXh0OwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHJldHVybiBuZXh0Lm5leHQgPSBuZXh0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJldHVybiBhbiBpdGVyYXRvciB3aXRoIG5vIHZhbHVlcy4KCgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbmV4dDogZG9uZVJlc3VsdAogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJ1bnRpbWUudmFsdWVzID0gdmFsdWVzOwoKICAgICAgICBmdW5jdGlvbiBkb25lUmVzdWx0KCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIENvbnRleHQucHJvdG90eXBlID0gewogICAgICAgICAgY29uc3RydWN0b3I6IENvbnRleHQsCiAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoc2tpcFRlbXBSZXNldCkgewogICAgICAgICAgICB0aGlzLnByZXYgPSAwOwogICAgICAgICAgICB0aGlzLm5leHQgPSAwOyAvLyBSZXNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwncwogICAgICAgICAgICAvLyBmdW5jdGlvbi5zZW50IGltcGxlbWVudGF0aW9uLgoKICAgICAgICAgICAgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdGhpcy5kb25lID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpOwoKICAgICAgICAgICAgaWYgKCFza2lwVGVtcFJlc2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7CiAgICAgICAgICAgICAgICAvLyBOb3Qgc3VyZSBhYm91dCB0aGUgb3B0aW1hbCBvcmRlciBvZiB0aGVzZSBjb25kaXRpb25zOgogICAgICAgICAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09PSAidCIgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkgewogICAgICAgICAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgICAgICAgIHRoaXMuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07CiAgICAgICAgICAgIHZhciByb290UmVjb3JkID0gcm9vdEVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICBpZiAocm9vdFJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgdGhyb3cgcm9vdFJlY29yZC5hcmc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLnJ2YWw7CiAgICAgICAgICB9LAogICAgICAgICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikgewogICAgICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXM7CgogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHsKICAgICAgICAgICAgICByZWNvcmQudHlwZSA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjsKICAgICAgICAgICAgICBjb250ZXh0Lm5leHQgPSBsb2M7CgogICAgICAgICAgICAgIGlmIChjYXVnaHQpIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBkaXNwYXRjaGVkIGV4Y2VwdGlvbiB3YXMgY2F1Z2h0IGJ5IGEgY2F0Y2ggYmxvY2ssCiAgICAgICAgICAgICAgICAvLyB0aGVuIGxldCB0aGF0IGNhdGNoIGJsb2NrIGhhbmRsZSB0aGUgZXhjZXB0aW9uIG5vcm1hbGx5LgogICAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiAhIWNhdWdodDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjsKCiAgICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA9PT0gInJvb3QiKSB7CiAgICAgICAgICAgICAgICAvLyBFeGNlcHRpb24gdGhyb3duIG91dHNpZGUgb2YgYW55IHRyeSBibG9jayB0aGF0IGNvdWxkIGhhbmRsZQogICAgICAgICAgICAgICAgLy8gaXQsIHNvIHNldCB0aGUgY29tcGxldGlvbiB2YWx1ZSBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uIHRvCiAgICAgICAgICAgICAgICAvLyB0aHJvdyB0aGUgZXhjZXB0aW9uLgogICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZSgiZW5kIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikgewogICAgICAgICAgICAgICAgdmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpOwogICAgICAgICAgICAgICAgdmFyIGhhc0ZpbmFsbHkgPSBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKTsKCiAgICAgICAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNDYXRjaCkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNGaW5hbGx5KSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHR5cGUsIGFyZykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoKICAgICAgICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkgJiYgKHR5cGUgPT09ICJicmVhayIgfHwgdHlwZSA9PT0gImNvbnRpbnVlIikgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgLy8gSWdub3JlIHRoZSBmaW5hbGx5IGVudHJ5IGlmIGNvbnRyb2wgaXMgbm90IGp1bXBpbmcgdG8gYQogICAgICAgICAgICAgIC8vIGxvY2F0aW9uIG91dHNpZGUgdGhlIHRyeS9jYXRjaCBibG9jay4KICAgICAgICAgICAgICBmaW5hbGx5RW50cnkgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTsKICAgICAgICAgICAgcmVjb3JkLnR5cGUgPSB0eXBlOwogICAgICAgICAgICByZWNvcmQuYXJnID0gYXJnOwoKICAgICAgICAgICAgaWYgKGZpbmFsbHlFbnRyeSkgewogICAgICAgICAgICAgIHRoaXMubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgICAgIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jOwogICAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZShyZWNvcmQpOwogICAgICAgICAgfSwKICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZShyZWNvcmQsIGFmdGVyTG9jKSB7CiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgIHRocm93IHJlY29yZC5hcmc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gImJyZWFrIiB8fCByZWNvcmQudHlwZSA9PT0gImNvbnRpbnVlIikgewogICAgICAgICAgICAgIHRoaXMubmV4dCA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJyZXR1cm4iKSB7CiAgICAgICAgICAgICAgdGhpcy5ydmFsID0gdGhpcy5hcmcgPSByZWNvcmQuYXJnOwogICAgICAgICAgICAgIHRoaXMubWV0aG9kID0gInJldHVybiI7CiAgICAgICAgICAgICAgdGhpcy5uZXh0ID0gImVuZCI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJub3JtYWwiICYmIGFmdGVyTG9jKSB7CiAgICAgICAgICAgICAgdGhpcy5uZXh0ID0gYWZ0ZXJMb2M7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfSwKICAgICAgICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKGZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKCiAgICAgICAgICAgICAgaWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoZW50cnkuY29tcGxldGlvbiwgZW50cnkuYWZ0ZXJMb2MpOwogICAgICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7CiAgICAgICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CgogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09IHRyeUxvYykgewogICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CgogICAgICAgICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0aHJvd24gPSByZWNvcmQuYXJnOwogICAgICAgICAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gdGhyb3duOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBUaGUgY29udGV4dC5jYXRjaCBtZXRob2QgbXVzdCBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgbG9jYXRpb24KICAgICAgICAgICAgLy8gYXJndW1lbnQgdGhhdCBjb3JyZXNwb25kcyB0byBhIGtub3duIGNhdGNoIGJsb2NrLgoKCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7CiAgICAgICAgICB9LAogICAgICAgICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykgewogICAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gewogICAgICAgICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLAogICAgICAgICAgICAgIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsCiAgICAgICAgICAgICAgbmV4dExvYzogbmV4dExvYwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHRoaXMubWV0aG9kID09PSAibmV4dCIpIHsKICAgICAgICAgICAgICAvLyBEZWxpYmVyYXRlbHkgZm9yZ2V0IHRoZSBsYXN0IHNlbnQgdmFsdWUgc28gdGhhdCB3ZSBkb24ndAogICAgICAgICAgICAgIC8vIGFjY2lkZW50YWxseSBwYXNzIGl0IG9uIHRvIHRoZSBkZWxlZ2F0ZS4KICAgICAgICAgICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSggLy8gSW4gc2xvcHB5IG1vZGUsIHVuYm91bmQgYHRoaXNgIHJlZmVycyB0byB0aGUgZ2xvYmFsIG9iamVjdCwgZmFsbGJhY2sgdG8KICAgICAgLy8gRnVuY3Rpb24gY29uc3RydWN0b3IgaWYgd2UncmUgaW4gZ2xvYmFsIHN0cmljdCBtb2RlLiBUaGF0IGlzIHNhZGx5IGEgZm9ybQogICAgICAvLyBvZiBpbmRpcmVjdCBldmFsIHdoaWNoIHZpb2xhdGVzIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5LgogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgfHwgdHlwZW9mIHNlbGYgPT09ICJvYmplY3QiICYmIHNlbGY7CiAgICAgIH0oKSB8fCBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpKTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA3NiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBfUHJvbWlzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzcpOwoKICAgICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICAgICAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGluZm8uZG9uZSkgewogICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9Qcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICAgICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9hc3luY1RvR2VuZXJhdG9yOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDc3ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc4KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA3OCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oNzkpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg4MCk7CgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oOTApOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMDIpOwoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXygxMDMpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLlByb21pc2U7CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogNzkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvKioqLwogICAgfSwKICAgIC8qIDgwICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyICRhdCA9IF9fd2VicGFja19yZXF1aXJlX18oODEpKHRydWUpOyAvLyAyMS4xLjMuMjcgU3RyaW5nLnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCgoKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXyg0MSkoU3RyaW5nLCAnU3RyaW5nJywgZnVuY3Rpb24gKGl0ZXJhdGVkKSB7CiAgICAgICAgdGhpcy5fdCA9IFN0cmluZyhpdGVyYXRlZCk7IC8vIHRhcmdldAoKICAgICAgICB0aGlzLl9pID0gMDsgLy8gbmV4dCBpbmRleAogICAgICAgIC8vIDIxLjEuNS4yLjEgJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KCkKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBPID0gdGhpcy5fdDsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9pOwogICAgICAgIHZhciBwb2ludDsKICAgICAgICBpZiAoaW5kZXggPj0gTy5sZW5ndGgpIHJldHVybiB7CiAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgIH07CiAgICAgICAgcG9pbnQgPSAkYXQoTywgaW5kZXgpOwogICAgICAgIHRoaXMuX2kgKz0gcG9pbnQubGVuZ3RoOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB2YWx1ZTogcG9pbnQsCiAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0pOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA4MSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKTsKCiAgICAgIHZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7IC8vIHRydWUgIC0+IFN0cmluZyNhdAogICAgICAvLyBmYWxzZSAtPiBTdHJpbmcjY29kZVBvaW50QXQKCgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChUT19TVFJJTkcpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRoYXQsIHBvcykgewogICAgICAgICAgdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSk7CiAgICAgICAgICB2YXIgaSA9IHRvSW50ZWdlcihwb3MpOwogICAgICAgICAgdmFyIGwgPSBzLmxlbmd0aDsKICAgICAgICAgIHZhciBhLCBiOwogICAgICAgICAgaWYgKGkgPCAwIHx8IGkgPj0gbCkgcmV0dXJuIFRPX1NUUklORyA/ICcnIDogdW5kZWZpbmVkOwogICAgICAgICAgYSA9IHMuY2hhckNvZGVBdChpKTsKICAgICAgICAgIHJldHVybiBhIDwgMHhkODAwIHx8IGEgPiAweGRiZmYgfHwgaSArIDEgPT09IGwgfHwgKGIgPSBzLmNoYXJDb2RlQXQoaSArIDEpKSA8IDB4ZGMwMCB8fCBiID4gMHhkZmZmID8gVE9fU1RSSU5HID8gcy5jaGFyQXQoaSkgOiBhIDogVE9fU1RSSU5HID8gcy5zbGljZShpLCBpICsgMikgOiAoYSAtIDB4ZDgwMCA8PCAxMCkgKyAoYiAtIDB4ZGMwMCkgKyAweDEwMDAwOwogICAgICAgIH07CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDgyICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDgzICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgdmFyIGNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDIpOwoKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsKCiAgICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd2VicGFja19yZXF1aXJlX18oMjYpOwoKICAgICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307IC8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpCgogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpKEl0ZXJhdG9yUHJvdG90eXBlLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpKCdpdGVyYXRvcicpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0pOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpIHsKICAgICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsKICAgICAgICAgIG5leHQ6IGRlc2NyaXB0b3IoMSwgbmV4dCkKICAgICAgICB9KTsKICAgICAgICBzZXRUb1N0cmluZ1RhZyhDb25zdHJ1Y3RvciwgTkFNRSArICcgSXRlcmF0b3InKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogODQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICB2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKCiAgICAgIHZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgZ2V0S2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsKICAgICAgICBhbk9iamVjdChPKTsKICAgICAgICB2YXIga2V5cyA9IGdldEtleXMoUHJvcGVydGllcyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgUDsKCiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGkpIHsKICAgICAgICAgIGRQLmYoTywgUCA9IGtleXNbaSsrXSwgUHJvcGVydGllc1tQXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gTzsKICAgICAgfTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA4NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIDE5LjEuMi45IC8gMTUuMi4zLjIgT2JqZWN0LmdldFByb3RvdHlwZU9mKE8pCiAgICAgIHZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgICAgIHZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpOwoKICAgICAgdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMykoJ0lFX1BST1RPJyk7CgogICAgICB2YXIgT2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKE8pIHsKICAgICAgICBPID0gdG9PYmplY3QoTyk7CiAgICAgICAgaWYgKGhhcyhPLCBJRV9QUk9UTykpIHJldHVybiBPW0lFX1BST1RPXTsKCiAgICAgICAgaWYgKHR5cGVvZiBPLmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgTyBpbnN0YW5jZW9mIE8uY29uc3RydWN0b3IpIHsKICAgICAgICAgIHJldHVybiBPLmNvbnN0cnVjdG9yLnByb3RvdHlwZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBPIGluc3RhbmNlb2YgT2JqZWN0ID8gT2JqZWN0UHJvdG8gOiBudWxsOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA4NiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oODcpOwoKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oNik7CgogICAgICB2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7CgogICAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ3RvU3RyaW5nVGFnJyk7CgogICAgICB2YXIgRE9NSXRlcmFibGVzID0gKCdDU1NSdWxlTGlzdCxDU1NTdHlsZURlY2xhcmF0aW9uLENTU1ZhbHVlTGlzdCxDbGllbnRSZWN0TGlzdCxET01SZWN0TGlzdCxET01TdHJpbmdMaXN0LCcgKyAnRE9NVG9rZW5MaXN0LERhdGFUcmFuc2Zlckl0ZW1MaXN0LEZpbGVMaXN0LEhUTUxBbGxDb2xsZWN0aW9uLEhUTUxDb2xsZWN0aW9uLEhUTUxGb3JtRWxlbWVudCxIVE1MU2VsZWN0RWxlbWVudCwnICsgJ01lZGlhTGlzdCxNaW1lVHlwZUFycmF5LE5hbWVkTm9kZU1hcCxOb2RlTGlzdCxQYWludFJlcXVlc3RMaXN0LFBsdWdpbixQbHVnaW5BcnJheSxTVkdMZW5ndGhMaXN0LFNWR051bWJlckxpc3QsJyArICdTVkdQYXRoU2VnTGlzdCxTVkdQb2ludExpc3QsU1ZHU3RyaW5nTGlzdCxTVkdUcmFuc2Zvcm1MaXN0LFNvdXJjZUJ1ZmZlckxpc3QsU3R5bGVTaGVldExpc3QsVGV4dFRyYWNrQ3VlTGlzdCwnICsgJ1RleHRUcmFja0xpc3QsVG91Y2hMaXN0Jykuc3BsaXQoJywnKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgRE9NSXRlcmFibGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIE5BTUUgPSBET01JdGVyYWJsZXNbaV07CiAgICAgICAgdmFyIENvbGxlY3Rpb24gPSBnbG9iYWxbTkFNRV07CiAgICAgICAgdmFyIHByb3RvID0gQ29sbGVjdGlvbiAmJiBDb2xsZWN0aW9uLnByb3RvdHlwZTsKICAgICAgICBpZiAocHJvdG8gJiYgIXByb3RvW1RPX1NUUklOR19UQUddKSBoaWRlKHByb3RvLCBUT19TVFJJTkdfVEFHLCBOQU1FKTsKICAgICAgICBJdGVyYXRvcnNbTkFNRV0gPSBJdGVyYXRvcnMuQXJyYXk7CiAgICAgIH0KICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogODcgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IF9fd2VicGFja19yZXF1aXJlX18oODgpOwoKICAgICAgdmFyIHN0ZXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5KTsKCiAgICAgIHZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCiAgICAgIHZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOyAvLyAyMi4xLjMuNCBBcnJheS5wcm90b3R5cGUuZW50cmllcygpCiAgICAgIC8vIDIyLjEuMy4xMyBBcnJheS5wcm90b3R5cGUua2V5cygpCiAgICAgIC8vIDIyLjEuMy4yOSBBcnJheS5wcm90b3R5cGUudmFsdWVzKCkKICAgICAgLy8gMjIuMS4zLjMwIEFycmF5LnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpCgoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKShBcnJheSwgJ0FycmF5JywgZnVuY3Rpb24gKGl0ZXJhdGVkLCBraW5kKSB7CiAgICAgICAgdGhpcy5fdCA9IHRvSU9iamVjdChpdGVyYXRlZCk7IC8vIHRhcmdldAoKICAgICAgICB0aGlzLl9pID0gMDsgLy8gbmV4dCBpbmRleAoKICAgICAgICB0aGlzLl9rID0ga2luZDsgLy8ga2luZAogICAgICAgIC8vIDIyLjEuNS4yLjEgJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKQogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIE8gPSB0aGlzLl90OwogICAgICAgIHZhciBraW5kID0gdGhpcy5fazsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9pKys7CgogICAgICAgIGlmICghTyB8fCBpbmRleCA+PSBPLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5fdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHJldHVybiBzdGVwKDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtpbmQgPT0gJ2tleXMnKSByZXR1cm4gc3RlcCgwLCBpbmRleCk7CiAgICAgICAgaWYgKGtpbmQgPT0gJ3ZhbHVlcycpIHJldHVybiBzdGVwKDAsIE9baW5kZXhdKTsKICAgICAgICByZXR1cm4gc3RlcCgwLCBbaW5kZXgsIE9baW5kZXhdXSk7CiAgICAgIH0sICd2YWx1ZXMnKTsgLy8gYXJndW1lbnRzTGlzdFtAQGl0ZXJhdG9yXSBpcyAlQXJyYXlQcm90b192YWx1ZXMlICg5LjQuNC42LCA5LjQuNC43KQoKICAgICAgSXRlcmF0b3JzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycy5BcnJheTsKICAgICAgYWRkVG9VbnNjb3BhYmxlcygna2V5cycpOwogICAgICBhZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKICAgICAgYWRkVG9VbnNjb3BhYmxlcygnZW50cmllcycpOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDg4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLyogZW1wdHkgKi8KICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogODkgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChkb25lLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICBkb25lOiAhIWRvbmUKICAgICAgICB9OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA5MCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBMSUJSQVJZID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNCk7CgogICAgICB2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKCiAgICAgIHZhciBjbGFzc29mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NCk7CgogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOwoKICAgICAgdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpOwoKICAgICAgdmFyIGFuSW5zdGFuY2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkxKTsKCiAgICAgIHZhciBmb3JPZiA9IF9fd2VicGFja19yZXF1aXJlX18oOTIpOwoKICAgICAgdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd2VicGFja19yZXF1aXJlX18oNDUpOwoKICAgICAgdmFyIHRhc2sgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2KS5zZXQ7CgogICAgICB2YXIgbWljcm90YXNrID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NykoKTsKCiAgICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjcpOwoKICAgICAgdmFyIHBlcmZvcm0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3KTsKCiAgICAgIHZhciB1c2VyQWdlbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk4KTsKCiAgICAgIHZhciBwcm9taXNlUmVzb2x2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDgpOwoKICAgICAgdmFyIFBST01JU0UgPSAnUHJvbWlzZSc7CiAgICAgIHZhciBUeXBlRXJyb3IgPSBnbG9iYWwuVHlwZUVycm9yOwogICAgICB2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwogICAgICB2YXIgdmVyc2lvbnMgPSBwcm9jZXNzICYmIHByb2Nlc3MudmVyc2lvbnM7CiAgICAgIHZhciB2OCA9IHZlcnNpb25zICYmIHZlcnNpb25zLnY4IHx8ICcnOwogICAgICB2YXIgJFByb21pc2UgPSBnbG9iYWxbUFJPTUlTRV07CiAgICAgIHZhciBpc05vZGUgPSBjbGFzc29mKHByb2Nlc3MpID09ICdwcm9jZXNzJzsKCiAgICAgIHZhciBlbXB0eSA9IGZ1bmN0aW9uIGVtcHR5KCkgewogICAgICAgIC8qIGVtcHR5ICovCiAgICAgIH07CgogICAgICB2YXIgSW50ZXJuYWwsIG5ld0dlbmVyaWNQcm9taXNlQ2FwYWJpbGl0eSwgT3duUHJvbWlzZUNhcGFiaWxpdHksIFdyYXBwZXI7CiAgICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IG5ld0dlbmVyaWNQcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmY7CiAgICAgIHZhciBVU0VfTkFUSVZFID0gISFmdW5jdGlvbiAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIGNvcnJlY3Qgc3ViY2xhc3Npbmcgd2l0aCBAQHNwZWNpZXMgc3VwcG9ydAogICAgICAgICAgdmFyIHByb21pc2UgPSAkUHJvbWlzZS5yZXNvbHZlKDEpOwoKICAgICAgICAgIHZhciBGYWtlUHJvbWlzZSA9IChwcm9taXNlLmNvbnN0cnVjdG9yID0ge30pW19fd2VicGFja19yZXF1aXJlX18oMikoJ3NwZWNpZXMnKV0gPSBmdW5jdGlvbiAoZXhlYykgewogICAgICAgICAgICBleGVjKGVtcHR5LCBlbXB0eSk7CiAgICAgICAgICB9OyAvLyB1bmhhbmRsZWQgcmVqZWN0aW9ucyB0cmFja2luZyBzdXBwb3J0LCBOb2RlSlMgUHJvbWlzZSB3aXRob3V0IGl0IGZhaWxzIEBAc3BlY2llcyB0ZXN0CgoKICAgICAgICAgIHJldHVybiAoaXNOb2RlIHx8IHR5cGVvZiBQcm9taXNlUmVqZWN0aW9uRXZlbnQgPT0gJ2Z1bmN0aW9uJykgJiYgcHJvbWlzZS50aGVuKGVtcHR5KSBpbnN0YW5jZW9mIEZha2VQcm9taXNlIC8vIHY4IDYuNiAoTm9kZSAxMCBhbmQgQ2hyb21lIDY2KSBoYXZlIGEgYnVnIHdpdGggcmVzb2x2aW5nIGN1c3RvbSB0aGVuYWJsZXMKICAgICAgICAgIC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTgzMDU2NQogICAgICAgICAgLy8gd2UgY2FuJ3QgZGV0ZWN0IGl0IHN5bmNocm9ub3VzbHksIHNvIGp1c3QgY2hlY2sgdmVyc2lvbnMKICAgICAgICAgICYmIHY4LmluZGV4T2YoJzYuNicpICE9PSAwICYmIHVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUvNjYnKSA9PT0gLTE7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgLyogZW1wdHkgKi8KICAgICAgICB9CiAgICAgIH0oKTsgLy8gaGVscGVycwoKICAgICAgdmFyIGlzVGhlbmFibGUgPSBmdW5jdGlvbiBpc1RoZW5hYmxlKGl0KSB7CiAgICAgICAgdmFyIHRoZW47CiAgICAgICAgcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiB0eXBlb2YgKHRoZW4gPSBpdC50aGVuKSA9PSAnZnVuY3Rpb24nID8gdGhlbiA6IGZhbHNlOwogICAgICB9OwoKICAgICAgdmFyIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeShwcm9taXNlLCBpc1JlamVjdCkgewogICAgICAgIGlmIChwcm9taXNlLl9uKSByZXR1cm47CiAgICAgICAgcHJvbWlzZS5fbiA9IHRydWU7CiAgICAgICAgdmFyIGNoYWluID0gcHJvbWlzZS5fYzsKICAgICAgICBtaWNyb3Rhc2soZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHZhbHVlID0gcHJvbWlzZS5fdjsKICAgICAgICAgIHZhciBvayA9IHByb21pc2UuX3MgPT0gMTsKICAgICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgICB2YXIgcnVuID0gZnVuY3Rpb24gcnVuKHJlYWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBoYW5kbGVyID0gb2sgPyByZWFjdGlvbi5vayA6IHJlYWN0aW9uLmZhaWw7CiAgICAgICAgICAgIHZhciByZXNvbHZlID0gcmVhY3Rpb24ucmVzb2x2ZTsKICAgICAgICAgICAgdmFyIHJlamVjdCA9IHJlYWN0aW9uLnJlamVjdDsKICAgICAgICAgICAgdmFyIGRvbWFpbiA9IHJlYWN0aW9uLmRvbWFpbjsKICAgICAgICAgICAgdmFyIHJlc3VsdCwgdGhlbiwgZXhpdGVkOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoaGFuZGxlcikgewogICAgICAgICAgICAgICAgaWYgKCFvaykgewogICAgICAgICAgICAgICAgICBpZiAocHJvbWlzZS5faCA9PSAyKSBvbkhhbmRsZVVuaGFuZGxlZChwcm9taXNlKTsKICAgICAgICAgICAgICAgICAgcHJvbWlzZS5faCA9IDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIgPT09IHRydWUpIHJlc3VsdCA9IHZhbHVlO2Vsc2UgewogICAgICAgICAgICAgICAgICBpZiAoZG9tYWluKSBkb21haW4uZW50ZXIoKTsKICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gaGFuZGxlcih2YWx1ZSk7IC8vIG1heSB0aHJvdwoKICAgICAgICAgICAgICAgICAgaWYgKGRvbWFpbikgewogICAgICAgICAgICAgICAgICAgIGRvbWFpbi5leGl0KCk7CiAgICAgICAgICAgICAgICAgICAgZXhpdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHJlYWN0aW9uLnByb21pc2UpIHsKICAgICAgICAgICAgICAgICAgcmVqZWN0KFR5cGVFcnJvcignUHJvbWlzZS1jaGFpbiBjeWNsZScpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhlbiA9IGlzVGhlbmFibGUocmVzdWx0KSkgewogICAgICAgICAgICAgICAgICB0aGVuLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgICB9IGVsc2UgcmVqZWN0KHZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIGlmIChkb21haW4gJiYgIWV4aXRlZCkgZG9tYWluLmV4aXQoKTsKICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgd2hpbGUgKGNoYWluLmxlbmd0aCA+IGkpIHsKICAgICAgICAgICAgcnVuKGNoYWluW2krK10pOwogICAgICAgICAgfSAvLyB2YXJpYWJsZSBsZW5ndGggLSBjYW4ndCB1c2UgZm9yRWFjaAoKCiAgICAgICAgICBwcm9taXNlLl9jID0gW107CiAgICAgICAgICBwcm9taXNlLl9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoaXNSZWplY3QgJiYgIXByb21pc2UuX2gpIG9uVW5oYW5kbGVkKHByb21pc2UpOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgdmFyIG9uVW5oYW5kbGVkID0gZnVuY3Rpb24gb25VbmhhbmRsZWQocHJvbWlzZSkgewogICAgICAgIHRhc2suY2FsbChnbG9iYWwsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHByb21pc2UuX3Y7CiAgICAgICAgICB2YXIgdW5oYW5kbGVkID0gaXNVbmhhbmRsZWQocHJvbWlzZSk7CiAgICAgICAgICB2YXIgcmVzdWx0LCBoYW5kbGVyLCBjb25zb2xlOwoKICAgICAgICAgIGlmICh1bmhhbmRsZWQpIHsKICAgICAgICAgICAgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaWYgKGlzTm9kZSkgewogICAgICAgICAgICAgICAgcHJvY2Vzcy5lbWl0KCd1bmhhbmRsZWRSZWplY3Rpb24nLCB2YWx1ZSwgcHJvbWlzZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYW5kbGVyID0gZ2xvYmFsLm9udW5oYW5kbGVkcmVqZWN0aW9uKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVyKHsKICAgICAgICAgICAgICAgICAgcHJvbWlzZTogcHJvbWlzZSwKICAgICAgICAgICAgICAgICAgcmVhc29uOiB2YWx1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICgoY29uc29sZSA9IGdsb2JhbC5jb25zb2xlKSAmJiBjb25zb2xlLmVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24nLCB2YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsgLy8gQnJvd3NlcnMgc2hvdWxkIG5vdCB0cmlnZ2VyIGByZWplY3Rpb25IYW5kbGVkYCBldmVudCBpZiBpdCB3YXMgaGFuZGxlZCBoZXJlLCBOb2RlSlMgLSBzaG91bGQKCiAgICAgICAgICAgIHByb21pc2UuX2ggPSBpc05vZGUgfHwgaXNVbmhhbmRsZWQocHJvbWlzZSkgPyAyIDogMTsKICAgICAgICAgIH0KCiAgICAgICAgICBwcm9taXNlLl9hID0gdW5kZWZpbmVkOwogICAgICAgICAgaWYgKHVuaGFuZGxlZCAmJiByZXN1bHQuZSkgdGhyb3cgcmVzdWx0LnY7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB2YXIgaXNVbmhhbmRsZWQgPSBmdW5jdGlvbiBpc1VuaGFuZGxlZChwcm9taXNlKSB7CiAgICAgICAgcmV0dXJuIHByb21pc2UuX2ggIT09IDEgJiYgKHByb21pc2UuX2EgfHwgcHJvbWlzZS5fYykubGVuZ3RoID09PSAwOwogICAgICB9OwoKICAgICAgdmFyIG9uSGFuZGxlVW5oYW5kbGVkID0gZnVuY3Rpb24gb25IYW5kbGVVbmhhbmRsZWQocHJvbWlzZSkgewogICAgICAgIHRhc2suY2FsbChnbG9iYWwsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBoYW5kbGVyOwoKICAgICAgICAgIGlmIChpc05vZGUpIHsKICAgICAgICAgICAgcHJvY2Vzcy5lbWl0KCdyZWplY3Rpb25IYW5kbGVkJywgcHJvbWlzZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGhhbmRsZXIgPSBnbG9iYWwub25yZWplY3Rpb25oYW5kbGVkKSB7CiAgICAgICAgICAgIGhhbmRsZXIoewogICAgICAgICAgICAgIHByb21pc2U6IHByb21pc2UsCiAgICAgICAgICAgICAgcmVhc29uOiBwcm9taXNlLl92CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgdmFyICRyZWplY3QgPSBmdW5jdGlvbiAkcmVqZWN0KHZhbHVlKSB7CiAgICAgICAgdmFyIHByb21pc2UgPSB0aGlzOwogICAgICAgIGlmIChwcm9taXNlLl9kKSByZXR1cm47CiAgICAgICAgcHJvbWlzZS5fZCA9IHRydWU7CiAgICAgICAgcHJvbWlzZSA9IHByb21pc2UuX3cgfHwgcHJvbWlzZTsgLy8gdW53cmFwCgogICAgICAgIHByb21pc2UuX3YgPSB2YWx1ZTsKICAgICAgICBwcm9taXNlLl9zID0gMjsKICAgICAgICBpZiAoIXByb21pc2UuX2EpIHByb21pc2UuX2EgPSBwcm9taXNlLl9jLnNsaWNlKCk7CiAgICAgICAgbm90aWZ5KHByb21pc2UsIHRydWUpOwogICAgICB9OwoKICAgICAgdmFyICRyZXNvbHZlID0gZnVuY3Rpb24gJHJlc29sdmUodmFsdWUpIHsKICAgICAgICB2YXIgcHJvbWlzZSA9IHRoaXM7CiAgICAgICAgdmFyIHRoZW47CiAgICAgICAgaWYgKHByb21pc2UuX2QpIHJldHVybjsKICAgICAgICBwcm9taXNlLl9kID0gdHJ1ZTsKICAgICAgICBwcm9taXNlID0gcHJvbWlzZS5fdyB8fCBwcm9taXNlOyAvLyB1bndyYXAKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChwcm9taXNlID09PSB2YWx1ZSkgdGhyb3cgVHlwZUVycm9yKCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpOwoKICAgICAgICAgIGlmICh0aGVuID0gaXNUaGVuYWJsZSh2YWx1ZSkpIHsKICAgICAgICAgICAgbWljcm90YXNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgd3JhcHBlciA9IHsKICAgICAgICAgICAgICAgIF93OiBwcm9taXNlLAogICAgICAgICAgICAgICAgX2Q6IGZhbHNlCiAgICAgICAgICAgICAgfTsgLy8gd3JhcAoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhlbi5jYWxsKHZhbHVlLCBjdHgoJHJlc29sdmUsIHdyYXBwZXIsIDEpLCBjdHgoJHJlamVjdCwgd3JhcHBlciwgMSkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICRyZWplY3QuY2FsbCh3cmFwcGVyLCBlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJvbWlzZS5fdiA9IHZhbHVlOwogICAgICAgICAgICBwcm9taXNlLl9zID0gMTsKICAgICAgICAgICAgbm90aWZ5KHByb21pc2UsIGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAkcmVqZWN0LmNhbGwoewogICAgICAgICAgICBfdzogcHJvbWlzZSwKICAgICAgICAgICAgX2Q6IGZhbHNlCiAgICAgICAgICB9LCBlKTsgLy8gd3JhcAogICAgICAgIH0KICAgICAgfTsgLy8gY29uc3RydWN0b3IgcG9seWZpbGwKCgogICAgICBpZiAoIVVTRV9OQVRJVkUpIHsKICAgICAgICAvLyAyNS40LjMuMSBQcm9taXNlKGV4ZWN1dG9yKQogICAgICAgICRQcm9taXNlID0gZnVuY3Rpb24gUHJvbWlzZShleGVjdXRvcikgewogICAgICAgICAgYW5JbnN0YW5jZSh0aGlzLCAkUHJvbWlzZSwgUFJPTUlTRSwgJ19oJyk7CiAgICAgICAgICBhRnVuY3Rpb24oZXhlY3V0b3IpOwogICAgICAgICAgSW50ZXJuYWwuY2FsbCh0aGlzKTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBleGVjdXRvcihjdHgoJHJlc29sdmUsIHRoaXMsIDEpLCBjdHgoJHJlamVjdCwgdGhpcywgMSkpOwogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICRyZWplY3QuY2FsbCh0aGlzLCBlcnIpOwogICAgICAgICAgfQogICAgICAgIH07IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycwoKCiAgICAgICAgSW50ZXJuYWwgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKSB7CiAgICAgICAgICB0aGlzLl9jID0gW107IC8vIDwtIGF3YWl0aW5nIHJlYWN0aW9ucwoKICAgICAgICAgIHRoaXMuX2EgPSB1bmRlZmluZWQ7IC8vIDwtIGNoZWNrZWQgaW4gaXNVbmhhbmRsZWQgcmVhY3Rpb25zCgogICAgICAgICAgdGhpcy5fcyA9IDA7IC8vIDwtIHN0YXRlCgogICAgICAgICAgdGhpcy5fZCA9IGZhbHNlOyAvLyA8LSBkb25lCgogICAgICAgICAgdGhpcy5fdiA9IHVuZGVmaW5lZDsgLy8gPC0gdmFsdWUKCiAgICAgICAgICB0aGlzLl9oID0gMDsgLy8gPC0gcmVqZWN0aW9uIHN0YXRlLCAwIC0gZGVmYXVsdCwgMSAtIGhhbmRsZWQsIDIgLSB1bmhhbmRsZWQKCiAgICAgICAgICB0aGlzLl9uID0gZmFsc2U7IC8vIDwtIG5vdGlmeQogICAgICAgIH07CgogICAgICAgIEludGVybmFsLnByb3RvdHlwZSA9IF9fd2VicGFja19yZXF1aXJlX18oOTkpKCRQcm9taXNlLnByb3RvdHlwZSwgewogICAgICAgICAgLy8gMjUuNC41LjMgUHJvbWlzZS5wcm90b3R5cGUudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkKICAgICAgICAgIHRoZW46IGZ1bmN0aW9uIHRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHsKICAgICAgICAgICAgdmFyIHJlYWN0aW9uID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsICRQcm9taXNlKSk7CiAgICAgICAgICAgIHJlYWN0aW9uLm9rID0gdHlwZW9mIG9uRnVsZmlsbGVkID09ICdmdW5jdGlvbicgPyBvbkZ1bGZpbGxlZCA6IHRydWU7CiAgICAgICAgICAgIHJlYWN0aW9uLmZhaWwgPSB0eXBlb2Ygb25SZWplY3RlZCA9PSAnZnVuY3Rpb24nICYmIG9uUmVqZWN0ZWQ7CiAgICAgICAgICAgIHJlYWN0aW9uLmRvbWFpbiA9IGlzTm9kZSA/IHByb2Nlc3MuZG9tYWluIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgdGhpcy5fYy5wdXNoKHJlYWN0aW9uKTsKCiAgICAgICAgICAgIGlmICh0aGlzLl9hKSB0aGlzLl9hLnB1c2gocmVhY3Rpb24pOwogICAgICAgICAgICBpZiAodGhpcy5fcykgbm90aWZ5KHRoaXMsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0aW9uLnByb21pc2U7CiAgICAgICAgICB9LAogICAgICAgICAgLy8gMjUuNC41LjEgUHJvbWlzZS5wcm90b3R5cGUuY2F0Y2gob25SZWplY3RlZCkKICAgICAgICAgICdjYXRjaCc6IGZ1bmN0aW9uIF9jYXRjaChvblJlamVjdGVkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRoZW4odW5kZWZpbmVkLCBvblJlamVjdGVkKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgT3duUHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbiBPd25Qcm9taXNlQ2FwYWJpbGl0eSgpIHsKICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IEludGVybmFsKCk7CiAgICAgICAgICB0aGlzLnByb21pc2UgPSBwcm9taXNlOwogICAgICAgICAgdGhpcy5yZXNvbHZlID0gY3R4KCRyZXNvbHZlLCBwcm9taXNlLCAxKTsKICAgICAgICAgIHRoaXMucmVqZWN0ID0gY3R4KCRyZWplY3QsIHByb21pc2UsIDEpOwogICAgICAgIH07CgogICAgICAgIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmYgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uIG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpIHsKICAgICAgICAgIHJldHVybiBDID09PSAkUHJvbWlzZSB8fCBDID09PSBXcmFwcGVyID8gbmV3IE93blByb21pc2VDYXBhYmlsaXR5KEMpIDogbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgICRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsIHsKICAgICAgICBQcm9taXNlOiAkUHJvbWlzZQogICAgICB9KTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMjYpKCRQcm9taXNlLCBQUk9NSVNFKTsKCiAgICAgIF9fd2VicGFja19yZXF1aXJlX18oMTAwKShQUk9NSVNFKTsKCiAgICAgIFdyYXBwZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApW1BST01JU0VdOyAvLyBzdGF0aWNzCgogICAgICAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCBQUk9NSVNFLCB7CiAgICAgICAgLy8gMjUuNC40LjUgUHJvbWlzZS5yZWplY3QocikKICAgICAgICByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChyKSB7CiAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KHRoaXMpOwogICAgICAgICAgdmFyICQkcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgICAkJHJlamVjdChyKTsKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoTElCUkFSWSB8fCAhVVNFX05BVElWRSksIFBST01JU0UsIHsKICAgICAgICAvLyAyNS40LjQuNiBQcm9taXNlLnJlc29sdmUoeCkKICAgICAgICByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKHgpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShMSUJSQVJZICYmIHRoaXMgPT09IFdyYXBwZXIgPyAkUHJvbWlzZSA6IHRoaXMsIHgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIShVU0VfTkFUSVZFICYmIF9fd2VicGFja19yZXF1aXJlX18oMTAxKShmdW5jdGlvbiAoaXRlcikgewogICAgICAgICRQcm9taXNlLmFsbChpdGVyKVsnY2F0Y2gnXShlbXB0eSk7CiAgICAgIH0pKSwgUFJPTUlTRSwgewogICAgICAgIC8vIDI1LjQuNC4xIFByb21pc2UuYWxsKGl0ZXJhYmxlKQogICAgICAgIGFsbDogZnVuY3Rpb24gYWxsKGl0ZXJhYmxlKSB7CiAgICAgICAgICB2YXIgQyA9IHRoaXM7CiAgICAgICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICAgICAgdmFyIHJlc29sdmUgPSBjYXBhYmlsaXR5LnJlc29sdmU7CiAgICAgICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICAgICAgdmFyIHJlbWFpbmluZyA9IDE7CiAgICAgICAgICAgIGZvck9mKGl0ZXJhYmxlLCBmYWxzZSwgZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICAgICAgICB2YXIgJGluZGV4ID0gaW5kZXgrKzsKICAgICAgICAgICAgICB2YXIgYWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHVuZGVmaW5lZCk7CiAgICAgICAgICAgICAgcmVtYWluaW5nKys7CiAgICAgICAgICAgICAgQy5yZXNvbHZlKHByb21pc2UpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgYWxyZWFkeUNhbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB2YWx1ZXNbJGluZGV4XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgICAgICAgIH0sIHJlamVjdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXN1bHQuZSkgcmVqZWN0KHJlc3VsdC52KTsKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfSwKICAgICAgICAvLyAyNS40LjQuNCBQcm9taXNlLnJhY2UoaXRlcmFibGUpCiAgICAgICAgcmFjZTogZnVuY3Rpb24gcmFjZShpdGVyYWJsZSkgewogICAgICAgICAgdmFyIEMgPSB0aGlzOwogICAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShDKTsKICAgICAgICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZm9yT2YoaXRlcmFibGUsIGZhbHNlLCBmdW5jdGlvbiAocHJvbWlzZSkgewogICAgICAgICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGNhcGFiaWxpdHkucmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXN1bHQuZSkgcmVqZWN0KHJlc3VsdC52KTsKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA5MSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSwgZm9yYmlkZGVuRmllbGQpIHsKICAgICAgICBpZiAoIShpdCBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSB8fCBmb3JiaWRkZW5GaWVsZCAhPT0gdW5kZWZpbmVkICYmIGZvcmJpZGRlbkZpZWxkIGluIGl0KSB7CiAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IobmFtZSArICc6IGluY29ycmVjdCBpbnZvY2F0aW9uIScpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA5MiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKCiAgICAgIHZhciBjYWxsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5Myk7CgogICAgICB2YXIgaXNBcnJheUl0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk0KTsKCiAgICAgIHZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICB2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM2KTsKCiAgICAgIHZhciBnZXRJdGVyRm4gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1KTsKCiAgICAgIHZhciBCUkVBSyA9IHt9OwogICAgICB2YXIgUkVUVVJOID0ge307CgogICAgICB2YXIgZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZXJhYmxlLCBlbnRyaWVzLCBmbiwgdGhhdCwgSVRFUkFUT1IpIHsKICAgICAgICB2YXIgaXRlckZuID0gSVRFUkFUT1IgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gaXRlcmFibGU7CiAgICAgICAgfSA6IGdldEl0ZXJGbihpdGVyYWJsZSk7CiAgICAgICAgdmFyIGYgPSBjdHgoZm4sIHRoYXQsIGVudHJpZXMgPyAyIDogMSk7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICB2YXIgbGVuZ3RoLCBzdGVwLCBpdGVyYXRvciwgcmVzdWx0OwogICAgICAgIGlmICh0eXBlb2YgaXRlckZuICE9ICdmdW5jdGlvbicpIHRocm93IFR5cGVFcnJvcihpdGVyYWJsZSArICcgaXMgbm90IGl0ZXJhYmxlIScpOyAvLyBmYXN0IGNhc2UgZm9yIGFycmF5cyB3aXRoIGRlZmF1bHQgaXRlcmF0b3IKCiAgICAgICAgaWYgKGlzQXJyYXlJdGVyKGl0ZXJGbikpIGZvciAobGVuZ3RoID0gdG9MZW5ndGgoaXRlcmFibGUubGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKICAgICAgICAgIHJlc3VsdCA9IGVudHJpZXMgPyBmKGFuT2JqZWN0KHN0ZXAgPSBpdGVyYWJsZVtpbmRleF0pWzBdLCBzdGVwWzFdKSA6IGYoaXRlcmFibGVbaW5kZXhdKTsKICAgICAgICAgIGlmIChyZXN1bHQgPT09IEJSRUFLIHx8IHJlc3VsdCA9PT0gUkVUVVJOKSByZXR1cm4gcmVzdWx0OwogICAgICAgIH0gZWxzZSBmb3IgKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoaXRlcmFibGUpOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7KSB7CiAgICAgICAgICByZXN1bHQgPSBjYWxsKGl0ZXJhdG9yLCBmLCBzdGVwLnZhbHVlLCBlbnRyaWVzKTsKICAgICAgICAgIGlmIChyZXN1bHQgPT09IEJSRUFLIHx8IHJlc3VsdCA9PT0gUkVUVVJOKSByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGV4cG9ydHMuQlJFQUsgPSBCUkVBSzsKICAgICAgZXhwb3J0cy5SRVRVUk4gPSBSRVRVUk47CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogOTMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAvLyBjYWxsIHNvbWV0aGluZyBvbiBpdGVyYXRvciBzdGVwIHdpdGggc2FmZSBjbG9zaW5nIG9uIGVycm9yCiAgICAgIHZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYXRvciwgZm4sIHZhbHVlLCBlbnRyaWVzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBlbnRyaWVzID8gZm4oYW5PYmplY3QodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7IC8vIDcuNC42IEl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IsIGNvbXBsZXRpb24pCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdmFyIHJldCA9IGl0ZXJhdG9yWydyZXR1cm4nXTsKICAgICAgICAgIGlmIChyZXQgIT09IHVuZGVmaW5lZCkgYW5PYmplY3QocmV0LmNhbGwoaXRlcmF0b3IpKTsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA5NCAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIC8vIGNoZWNrIG9uIGRlZmF1bHQgQXJyYXkgaXRlcmF0b3IKICAgICAgdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOwoKICAgICAgdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnaXRlcmF0b3InKTsKCiAgICAgIHZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICAgICAgICByZXR1cm4gaXQgIT09IHVuZGVmaW5lZCAmJiAoSXRlcmF0b3JzLkFycmF5ID09PSBpdCB8fCBBcnJheVByb3RvW0lURVJBVE9SXSA9PT0gaXQpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA5NSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBjbGFzc29mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NCk7CgogICAgICB2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpKCdpdGVyYXRvcicpOwoKICAgICAgdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApLmdldEl0ZXJhdG9yTWV0aG9kID0gZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgaWYgKGl0ICE9IHVuZGVmaW5lZCkgcmV0dXJuIGl0W0lURVJBVE9SXSB8fCBpdFsnQEBpdGVyYXRvciddIHx8IEl0ZXJhdG9yc1tjbGFzc29mKGl0KV07CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDk2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgLy8gZmFzdCBhcHBseSwgaHR0cDovL2pzcGVyZi5sbmtpdC5jb20vZmFzdC1hcHBseS81CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZuLCBhcmdzLCB0aGF0KSB7CiAgICAgICAgdmFyIHVuID0gdGhhdCA9PT0gdW5kZWZpbmVkOwoKICAgICAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiB1biA/IGZuKCkgOiBmbi5jYWxsKHRoYXQpOwoKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIHVuID8gZm4oYXJnc1swXSkgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0pOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSkgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0pOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSkgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSkgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3MpOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiA5NyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAgICAgdmFyIG1hY3JvdGFzayA9IF9fd2VicGFja19yZXF1aXJlX18oNDYpLnNldDsKCiAgICAgIHZhciBPYnNlcnZlciA9IGdsb2JhbC5NdXRhdGlvbk9ic2VydmVyIHx8IGdsb2JhbC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwogICAgICB2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwogICAgICB2YXIgUHJvbWlzZSA9IGdsb2JhbC5Qcm9taXNlOwogICAgICB2YXIgaXNOb2RlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMykocHJvY2VzcykgPT0gJ3Byb2Nlc3MnOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGhlYWQsIGxhc3QsIG5vdGlmeTsKCiAgICAgICAgdmFyIGZsdXNoID0gZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgICAgICB2YXIgcGFyZW50LCBmbjsKICAgICAgICAgIGlmIChpc05vZGUgJiYgKHBhcmVudCA9IHByb2Nlc3MuZG9tYWluKSkgcGFyZW50LmV4aXQoKTsKCiAgICAgICAgICB3aGlsZSAoaGVhZCkgewogICAgICAgICAgICBmbiA9IGhlYWQuZm47CiAgICAgICAgICAgIGhlYWQgPSBoZWFkLm5leHQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZuKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBpZiAoaGVhZCkgbm90aWZ5KCk7ZWxzZSBsYXN0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBsYXN0ID0gdW5kZWZpbmVkOwogICAgICAgICAgaWYgKHBhcmVudCkgcGFyZW50LmVudGVyKCk7CiAgICAgICAgfTsgLy8gTm9kZS5qcwoKCiAgICAgICAgaWYgKGlzTm9kZSkgewogICAgICAgICAgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewogICAgICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTsKICAgICAgICAgIH07IC8vIGJyb3dzZXJzIHdpdGggTXV0YXRpb25PYnNlcnZlciwgZXhjZXB0IGlPUyBTYWZhcmkgLSBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMzM5CgogICAgICAgIH0gZWxzZSBpZiAoT2JzZXJ2ZXIgJiYgIShnbG9iYWwubmF2aWdhdG9yICYmIGdsb2JhbC5uYXZpZ2F0b3Iuc3RhbmRhbG9uZSkpIHsKICAgICAgICAgIHZhciB0b2dnbGUgPSB0cnVlOwogICAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7CiAgICAgICAgICBuZXcgT2JzZXJ2ZXIoZmx1c2gpLm9ic2VydmUobm9kZSwgewogICAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiB0cnVlCiAgICAgICAgICB9KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXcKCiAgICAgICAgICBub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7CiAgICAgICAgICAgIG5vZGUuZGF0YSA9IHRvZ2dsZSA9ICF0b2dnbGU7CiAgICAgICAgICB9OyAvLyBlbnZpcm9ubWVudHMgd2l0aCBtYXliZSBub24tY29tcGxldGVseSBjb3JyZWN0LCBidXQgZXhpc3RlbnQgUHJvbWlzZQoKICAgICAgICB9IGVsc2UgaWYgKFByb21pc2UgJiYgUHJvbWlzZS5yZXNvbHZlKSB7CiAgICAgICAgICAvLyBQcm9taXNlLnJlc29sdmUgd2l0aG91dCBhbiBhcmd1bWVudCB0aHJvd3MgYW4gZXJyb3IgaW4gTEcgV2ViT1MgMgogICAgICAgICAgdmFyIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTsKCiAgICAgICAgICBub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7CiAgICAgICAgICAgIHByb21pc2UudGhlbihmbHVzaCk7CiAgICAgICAgICB9OyAvLyBmb3Igb3RoZXIgZW52aXJvbm1lbnRzIC0gbWFjcm90YXNrIGJhc2VkIG9uOgogICAgICAgICAgLy8gLSBzZXRJbW1lZGlhdGUKICAgICAgICAgIC8vIC0gTWVzc2FnZUNoYW5uZWwKICAgICAgICAgIC8vIC0gd2luZG93LnBvc3RNZXNzYWcKICAgICAgICAgIC8vIC0gb25yZWFkeXN0YXRlY2hhbmdlCiAgICAgICAgICAvLyAtIHNldFRpbWVvdXQKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHsKICAgICAgICAgICAgLy8gc3RyYW5nZSBJRSArIHdlYnBhY2sgZGV2IHNlcnZlciBidWcgLSB1c2UgLmNhbGwoZ2xvYmFsKQogICAgICAgICAgICBtYWNyb3Rhc2suY2FsbChnbG9iYWwsIGZsdXNoKTsKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGZuKSB7CiAgICAgICAgICB2YXIgdGFzayA9IHsKICAgICAgICAgICAgZm46IGZuLAogICAgICAgICAgICBuZXh0OiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICBpZiAobGFzdCkgbGFzdC5uZXh0ID0gdGFzazsKCiAgICAgICAgICBpZiAoIWhlYWQpIHsKICAgICAgICAgICAgaGVhZCA9IHRhc2s7CiAgICAgICAgICAgIG5vdGlmeSgpOwogICAgICAgICAgfQoKICAgICAgICAgIGxhc3QgPSB0YXNrOwogICAgICAgIH07CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDk4ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogICAgICB2YXIgbmF2aWdhdG9yID0gZ2xvYmFsLm5hdmlnYXRvcjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCAnJzsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiA5OSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRhcmdldCwgc3JjLCBzYWZlKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIHNyYykgewogICAgICAgICAgaWYgKHNhZmUgJiYgdGFyZ2V0W2tleV0pIHRhcmdldFtrZXldID0gc3JjW2tleV07ZWxzZSBoaWRlKHRhcmdldCwga2V5LCBzcmNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMDAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgICAgIHZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsKCiAgICAgIHZhciBkUCA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOwoKICAgICAgdmFyIERFU0NSSVBUT1JTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsKCiAgICAgIHZhciBTUEVDSUVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKSgnc3BlY2llcycpOwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoS0VZKSB7CiAgICAgICAgdmFyIEMgPSB0eXBlb2YgY29yZVtLRVldID09ICdmdW5jdGlvbicgPyBjb3JlW0tFWV0gOiBnbG9iYWxbS0VZXTsKICAgICAgICBpZiAoREVTQ1JJUFRPUlMgJiYgQyAmJiAhQ1tTUEVDSUVTXSkgZFAuZihDLCBTUEVDSUVTLCB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDEwMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMikoJ2l0ZXJhdG9yJyk7CgogICAgICB2YXIgU0FGRV9DTE9TSU5HID0gZmFsc2U7CgogICAgICB0cnkgewogICAgICAgIHZhciByaXRlciA9IFs3XVtJVEVSQVRPUl0oKTsKCiAgICAgICAgcml0ZXJbJ3JldHVybiddID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgU0FGRV9DTE9TSU5HID0gdHJ1ZTsKICAgICAgICB9OyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhyb3ctbGl0ZXJhbAoKCiAgICAgICAgQXJyYXkuZnJvbShyaXRlciwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhyb3cgMjsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8qIGVtcHR5ICovCiAgICAgIH0KCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMsIHNraXBDbG9zaW5nKSB7CiAgICAgICAgaWYgKCFza2lwQ2xvc2luZyAmJiAhU0FGRV9DTE9TSU5HKSByZXR1cm4gZmFsc2U7CiAgICAgICAgdmFyIHNhZmUgPSBmYWxzZTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBhcnIgPSBbN107CiAgICAgICAgICB2YXIgaXRlciA9IGFycltJVEVSQVRPUl0oKTsKCiAgICAgICAgICBpdGVyLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgZG9uZTogc2FmZSA9IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgIH07CgogICAgICAgICAgYXJyW0lURVJBVE9SXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZXI7CiAgICAgICAgICB9OwoKICAgICAgICAgIGV4ZWMoYXJyKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAvKiBlbXB0eSAqLwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNhZmU7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDEwMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsgLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtcHJvbWlzZS1maW5hbGx5CgogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgY29yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7CgogICAgICB2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgICAgIHZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1KTsKCiAgICAgIHZhciBwcm9taXNlUmVzb2x2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDgpOwoKICAgICAgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LlIsICdQcm9taXNlJywgewogICAgICAgICdmaW5hbGx5JzogZnVuY3Rpb24gX2ZpbmFsbHkob25GaW5hbGx5KSB7CiAgICAgICAgICB2YXIgQyA9IHNwZWNpZXNDb25zdHJ1Y3Rvcih0aGlzLCBjb3JlLlByb21pc2UgfHwgZ2xvYmFsLlByb21pc2UpOwogICAgICAgICAgdmFyIGlzRnVuY3Rpb24gPSB0eXBlb2Ygb25GaW5hbGx5ID09ICdmdW5jdGlvbic7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKGlzRnVuY3Rpb24gPyBmdW5jdGlvbiAoeCkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gOiBvbkZpbmFsbHksIGlzRnVuY3Rpb24gPyBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSA6IG9uRmluYWxseSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMDMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLXByb21pc2UtdHJ5CgogICAgICB2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7CgogICAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTsKCiAgICAgIHZhciBwZXJmb3JtID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Nyk7CgogICAgICAkZXhwb3J0KCRleHBvcnQuUywgJ1Byb21pc2UnLCB7CiAgICAgICAgJ3RyeSc6IGZ1bmN0aW9uIF90cnkoY2FsbGJhY2tmbikgewogICAgICAgICAgdmFyIHByb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkuZih0aGlzKTsKICAgICAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGNhbGxiYWNrZm4pOwogICAgICAgICAgKHJlc3VsdC5lID8gcHJvbWlzZUNhcGFiaWxpdHkucmVqZWN0IDogcHJvbWlzZUNhcGFiaWxpdHkucmVzb2x2ZSkocmVzdWx0LnYpOwogICAgICAgICAgcmV0dXJuIHByb21pc2VDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMDQgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMTA1KTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMDUgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwNik7CgogICAgICB2YXIgJE9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMCkuT2JqZWN0OwoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBjcmVhdGUoUCwgRCkgewogICAgICAgIHJldHVybiAkT2JqZWN0LmNyZWF0ZShQLCBEKTsKICAgICAgfTsKICAgICAgLyoqKi8KCiAgICB9LAogICAgLyogMTA2ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOyAvLyAxOS4xLjIuMiAvIDE1LjIuMy41IE9iamVjdC5jcmVhdGUoTyBbLCBQcm9wZXJ0aWVzXSkKCgogICAgICAkZXhwb3J0KCRleHBvcnQuUywgJ09iamVjdCcsIHsKICAgICAgICBjcmVhdGU6IF9fd2VicGFja19yZXF1aXJlX18oNDIpCiAgICAgIH0pOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEwNyAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqCiAgICAgICAqIENvcHlyaWdodCAoYykgMjAxMy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLgogICAgICAgKgogICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgKi8KCiAgICAgIHZhciBSZWFjdFByb3BUeXBlc1NlY3JldCA9IF9fd2VicGFja19yZXF1aXJlX18oMTA4KTsKCiAgICAgIGZ1bmN0aW9uIGVtcHR5RnVuY3Rpb24oKSB7fQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gc2hpbShwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIGxvY2F0aW9uLCBwcm9wRnVsbE5hbWUsIHNlY3JldCkgewogICAgICAgICAgaWYgKHNlY3JldCA9PT0gUmVhY3RQcm9wVHlwZXNTZWNyZXQpIHsKICAgICAgICAgICAgLy8gSXQgaXMgc3RpbGwgc2FmZSB3aGVuIGNhbGxlZCBmcm9tIFJlYWN0LgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcignQ2FsbGluZyBQcm9wVHlwZXMgdmFsaWRhdG9ycyBkaXJlY3RseSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBgcHJvcC10eXBlc2AgcGFja2FnZS4gJyArICdVc2UgUHJvcFR5cGVzLmNoZWNrUHJvcFR5cGVzKCkgdG8gY2FsbCB0aGVtLiAnICsgJ1JlYWQgbW9yZSBhdCBodHRwOi8vZmIubWUvdXNlLWNoZWNrLXByb3AtdHlwZXMnKTsKICAgICAgICAgIGVyci5uYW1lID0gJ0ludmFyaWFudCBWaW9sYXRpb24nOwogICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgIH0KCiAgICAgICAgOwogICAgICAgIHNoaW0uaXNSZXF1aXJlZCA9IHNoaW07CgogICAgICAgIGZ1bmN0aW9uIGdldFNoaW0oKSB7CiAgICAgICAgICByZXR1cm4gc2hpbTsKICAgICAgICB9CgogICAgICAgIDsgLy8gSW1wb3J0YW50IQogICAgICAgIC8vIEtlZXAgdGhpcyBsaXN0IGluIHN5bmMgd2l0aCBwcm9kdWN0aW9uIHZlcnNpb24gaW4gYC4vZmFjdG9yeVdpdGhUeXBlQ2hlY2tlcnMuanNgLgoKICAgICAgICB2YXIgUmVhY3RQcm9wVHlwZXMgPSB7CiAgICAgICAgICBhcnJheTogc2hpbSwKICAgICAgICAgIGJvb2w6IHNoaW0sCiAgICAgICAgICBmdW5jOiBzaGltLAogICAgICAgICAgbnVtYmVyOiBzaGltLAogICAgICAgICAgb2JqZWN0OiBzaGltLAogICAgICAgICAgc3RyaW5nOiBzaGltLAogICAgICAgICAgc3ltYm9sOiBzaGltLAogICAgICAgICAgYW55OiBzaGltLAogICAgICAgICAgYXJyYXlPZjogZ2V0U2hpbSwKICAgICAgICAgIGVsZW1lbnQ6IHNoaW0sCiAgICAgICAgICBpbnN0YW5jZU9mOiBnZXRTaGltLAogICAgICAgICAgbm9kZTogc2hpbSwKICAgICAgICAgIG9iamVjdE9mOiBnZXRTaGltLAogICAgICAgICAgb25lT2Y6IGdldFNoaW0sCiAgICAgICAgICBvbmVPZlR5cGU6IGdldFNoaW0sCiAgICAgICAgICBzaGFwZTogZ2V0U2hpbSwKICAgICAgICAgIGV4YWN0OiBnZXRTaGltCiAgICAgICAgfTsKICAgICAgICBSZWFjdFByb3BUeXBlcy5jaGVja1Byb3BUeXBlcyA9IGVtcHR5RnVuY3Rpb247CiAgICAgICAgUmVhY3RQcm9wVHlwZXMuUHJvcFR5cGVzID0gUmVhY3RQcm9wVHlwZXM7CiAgICAgICAgcmV0dXJuIFJlYWN0UHJvcFR5cGVzOwogICAgICB9OwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMDggKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIC8qKgogICAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTMtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4KICAgICAgICoKICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICovCgogICAgICB2YXIgUmVhY3RQcm9wVHlwZXNTZWNyZXQgPSAnU0VDUkVUX0RPX05PVF9QQVNTX1RISVNfT1JfWU9VX1dJTExfQkVfRklSRUQnOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IFJlYWN0UHJvcFR5cGVzU2VjcmV0OwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDEwOSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgIHZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzsKICAgICAgLyohCiAgICAgIENvcHlyaWdodCAoYykgMjAxNyBKZWQgV2F0c29uLgogICAgICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UgKE1JVCksIHNlZQogICAgICBodHRwOi8vamVkd2F0c29uLmdpdGh1Yi5pby9jbGFzc25hbWVzCiAgICAgICovCgogICAgICAvKiBnbG9iYWwgZGVmaW5lICovCgoKICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAndXNlIHN0cmljdCc7CgogICAgICAgIHZhciBoYXNPd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTsKCiAgICAgICAgZnVuY3Rpb24gY2xhc3NOYW1lcygpIHsKICAgICAgICAgIHZhciBjbGFzc2VzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgaWYgKCFhcmcpIGNvbnRpbnVlOwogICAgICAgICAgICB2YXIgYXJnVHlwZSA9IHR5cGVvZiBhcmc7CgogICAgICAgICAgICBpZiAoYXJnVHlwZSA9PT0gJ3N0cmluZycgfHwgYXJnVHlwZSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICBjbGFzc2VzLnB1c2goYXJnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGFyZykgJiYgYXJnLmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBpbm5lciA9IGNsYXNzTmFtZXMuYXBwbHkobnVsbCwgYXJnKTsKCiAgICAgICAgICAgICAgaWYgKGlubmVyKSB7CiAgICAgICAgICAgICAgICBjbGFzc2VzLnB1c2goaW5uZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChhcmdUeXBlID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhcmcpIHsKICAgICAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChhcmcsIGtleSkgJiYgYXJnW2tleV0pIHsKICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNsYXNzZXMuam9pbignICcpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRydWUgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgICAgICAgIGNsYXNzTmFtZXNbImRlZmF1bHQiXSA9IGNsYXNzTmFtZXM7CiAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGNsYXNzTmFtZXM7CiAgICAgICAgfSBlbHNlIGlmICh0cnVlKSB7CiAgICAgICAgICAvLyByZWdpc3RlciBhcyAnY2xhc3NuYW1lcycsIGNvbnNpc3RlbnQgd2l0aCBucG0gcGFja2FnZSBuYW1lCiAgICAgICAgICAhKF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18gPSBbXSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWVzOwogICAgICAgICAgfS5hcHBseShleHBvcnRzLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fKSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpOwogICAgICAgIH0gZWxzZSB7fQogICAgICB9KSgpOwogICAgICAvKioqLwoKICAgIH0sCiAgICAvKiAxMTAgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgICAvKioKICAgICAgICAjIG9taXQKICAgICAgCiAgICAgICAgUmVtb3ZlIHZhbHVlcyBmcm9tIGFuIG9iamVjdCAob3IgYW4gYXJyYXkgb2Ygb2JqZWN0cykgYmFzZWQgb24ga2V5LCB2YWx1ZSBvcgogICAgICAgIGFuIGV2YWx1YXRvciBmdW5jdGlvbi4KICAgICAgCiAgICAgICAgIyMgRXhhbXBsZSBVc2FnZQogICAgICAKICAgICAgICA8PDwgZXhhbXBsZXMvb2JqZWN0LmpzCiAgICAgIAogICAgICAqKi8KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocnVsZSkgewogICAgICAgIGZ1bmN0aW9uIG9taXQodGFyZ2V0KSB7CiAgICAgICAgICB2YXIgYWNjZXB0VmFsOwogICAgICAgICAgdmFyIGNvcHkgPSB7fTsKICAgICAgICAgIHZhciBrZXk7CiAgICAgICAgICB2YXIgdmFsOyAvLyBpbiB0aGUgY2FzZSB0aGF0IHdlIGhhdmUgYmVlbiBwYXNzZWQgYSBmYWxzZXkgdmFsdWUsIGp1c3QgcmV0dXJuIHRoYXQKCiAgICAgICAgICBpZiAoIXRhcmdldCkgewogICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5tYXAob21pdCk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIHRhcmdldCkgewogICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAvLyBpZiB3ZSBkb24ndCBoYXZlIGEgdmFsaWQgcnVsZSwganVzdCBhY2NlcHQgdGhlIHZhbHVlCiAgICAgICAgICAgICAgYWNjZXB0VmFsID0gdHlwZW9mIHJ1bGUgIT0gJ2Z1bmN0aW9uJzsgLy8gaWYgd2Ugb25seSBoYXZlIGEga2V5IGNoZWNrLCB0aGVuIGRvIGEgdmVyeSBzaW1wbGUgdGVzdAoKICAgICAgICAgICAgICBpZiAocnVsZS5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIGFjY2VwdFZhbCA9ICFydWxlKGtleSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbCA9IHRhcmdldFtrZXldOwogICAgICAgICAgICAgICAgYWNjZXB0VmFsID0gIXJ1bGUoa2V5LCB2YWwgPSB0YXJnZXRba2V5XSwgdGFyZ2V0KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChhY2NlcHRWYWwpIHsKICAgICAgICAgICAgICAgIGNvcHlba2V5XSA9IHZhbCB8fCB0YXJnZXRba2V5XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY29weTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9taXRXaGVuRXF1YWwodmFsdWUpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiBrZXkgPT09IHZhbHVlOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9taXRXaGVuSW4odGFyZ2V0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmluZGV4T2Yoa2V5KSA+PSAwOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgcnVsZSA9PSAnc3RyaW5nJyB8fCBydWxlIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgICBydWxlID0gb21pdFdoZW5FcXVhbChydWxlKTsKICAgICAgICB9CgogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJ1bGUpKSB7CiAgICAgICAgICBydWxlID0gb21pdFdoZW5JbihydWxlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IG9taXQoYXJndW1lbnRzWzFdKSA6IG9taXQ7CiAgICAgIH07CiAgICAgIC8qKiovCgogICAgfSwKICAgIC8qIDExMSAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqCiAgICAgICAqIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLgogICAgICAgKgogICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgKiBTaW1pbGFyIHRvIGludmFyaWFudCBidXQgb25seSBsb2dzIGEgd2FybmluZyBpZiB0aGUgY29uZGl0aW9uIGlzIG5vdCBtZXQuCiAgICAgICAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gbG9nIGlzc3VlcyBpbiBkZXZlbG9wbWVudCBlbnZpcm9ubWVudHMgaW4gY3JpdGljYWwKICAgICAgICogcGF0aHMuIFJlbW92aW5nIHRoZSBsb2dnaW5nIGNvZGUgZm9yIHByb2R1Y3Rpb24gZW52aXJvbm1lbnRzIHdpbGwga2VlcCB0aGUKICAgICAgICogc2FtZSBsb2dpYyBhbmQgZm9sbG93IHRoZSBzYW1lIGNvZGUgcGF0aHMuCiAgICAgICAqLwoKICAgICAgdmFyIF9fREVWX18gPSAicHJvZHVjdGlvbiIgIT09ICdwcm9kdWN0aW9uJzsKCiAgICAgIHZhciB3YXJuaW5nID0gZnVuY3Rpb24gd2FybmluZygpIHt9OwoKICAgICAgaWYgKF9fREVWX18pIHsKICAgICAgICB2YXIgcHJpbnRXYXJuaW5nID0gZnVuY3Rpb24gcHJpbnRXYXJuaW5nKGZvcm1hdCwgYXJncykgewogICAgICAgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICBhcmdzID0gbmV3IEFycmF5KGxlbiA+IDIgPyBsZW4gLSAyIDogMCk7CgogICAgICAgICAgZm9yICh2YXIga2V5ID0gMjsga2V5IDwgbGVuOyBrZXkrKykgewogICAgICAgICAgICBhcmdzW2tleSAtIDJdID0gYXJndW1lbnRzW2tleV07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGFyZ0luZGV4ID0gMDsKICAgICAgICAgIHZhciBtZXNzYWdlID0gJ1dhcm5pbmc6ICcgKyBmb3JtYXQucmVwbGFjZSgvJXMvZywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gYXJnc1thcmdJbmRleCsrXTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvLyAtLS0gV2VsY29tZSB0byBkZWJ1Z2dpbmcgUmVhY3QgLS0tCiAgICAgICAgICAgIC8vIFRoaXMgZXJyb3Igd2FzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHRoYXQgeW91IGNhbiB1c2UgdGhpcyBzdGFjawogICAgICAgICAgICAvLyB0byBmaW5kIHRoZSBjYWxsc2l0ZSB0aGF0IGNhdXNlZCB0aGlzIHdhcm5pbmcgdG8gZmlyZS4KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgICAgICAgfSBjYXRjaCAoeCkge30KICAgICAgICB9OwoKICAgICAgICB3YXJuaW5nID0gZnVuY3Rpb24gd2FybmluZyhjb25kaXRpb24sIGZvcm1hdCwgYXJncykgewogICAgICAgICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICBhcmdzID0gbmV3IEFycmF5KGxlbiA+IDIgPyBsZW4gLSAyIDogMCk7CgogICAgICAgICAgZm9yICh2YXIga2V5ID0gMjsga2V5IDwgbGVuOyBrZXkrKykgewogICAgICAgICAgICBhcmdzW2tleSAtIDJdID0gYXJndW1lbnRzW2tleV07CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZvcm1hdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYHdhcm5pbmcoY29uZGl0aW9uLCBmb3JtYXQsIC4uLmFyZ3MpYCByZXF1aXJlcyBhIHdhcm5pbmcgJyArICdtZXNzYWdlIGFyZ3VtZW50Jyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFjb25kaXRpb24pIHsKICAgICAgICAgICAgcHJpbnRXYXJuaW5nLmFwcGx5KG51bGwsIFtmb3JtYXRdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB3YXJuaW5nOwogICAgICAvKioqLwogICAgfSwKICAgIC8qIDExMiAqLwoKICAgIC8qKiovCiAgICBmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOwoKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwoKICAgICAgZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gdm9pZCAwOwoKICAgICAgdmFyIF9pbmhlcml0c0xvb3NlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX193ZWJwYWNrX3JlcXVpcmVfXygyOCkpOwoKICAgICAgdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9fd2VicGFja19yZXF1aXJlX18oMjkpKTsKICAgICAgLyoqCiAgICAgICAqIOiZmuaLn+e7hOS7tu+8jOeUqOS6juaUtumbhuWIl+a4suafk+inhOWImQogICAgICAgKi8KCgogICAgICB2YXIgQ29sdW1uID0KICAgICAgLyojX19QVVJFX18qLwogICAgICBmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogICAgICAgICgwLCBfaW5oZXJpdHNMb29zZTJbImRlZmF1bHQiXSkoQ29sdW1uLCBfQ29tcG9uZW50KTsKCiAgICAgICAgZnVuY3Rpb24gQ29sdW1uKCkgewogICAgICAgICAgcmV0dXJuIF9Db21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwogICAgICAgIH0KCiAgICAgICAgdmFyIF9wcm90byA9IENvbHVtbi5wcm90b3R5cGU7CgogICAgICAgIF9wcm90by5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gQ29sdW1uOwogICAgICB9KF9yZWFjdC5Db21wb25lbnQpOwoKICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gQ29sdW1uOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsKICAgICAgLyoqKi8KICAgIH0sCiAgICAvKiAxMTMgKi8KCiAgICAvKioqLwogICAgZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsKCiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsKCiAgICAgIGV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IFNlYXJjaEZvcm1EZWNvcmF0b3I7CgogICAgICB2YXIgX2luaGVyaXRzTG9vc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KSk7CgogICAgICB2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX193ZWJwYWNrX3JlcXVpcmVfXygyOSkpOwoKICAgICAgdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9fd2VicGFja19yZXF1aXJlX18oNDkpKTsKCiAgICAgIHZhciBfYW50ZCA9IF9fd2VicGFja19yZXF1aXJlX18oNTApOwogICAgICAvKioKICAgICAgICog6Jma5ouf57uE5Lu277yM55So5LqO5pS26ZuG5YiX5riy5p+T6KeE5YiZCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIFNlYXJjaEZvcm1EZWNvcmF0b3IoRm9ybUNvbnRlbnQpIHsKICAgICAgICB2YXIgU2VhcmNoRm9ybSA9CiAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgIGZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgICAgICAgICAoMCwgX2luaGVyaXRzTG9vc2UyWyJkZWZhdWx0Il0pKFNlYXJjaEZvcm0sIF9Db21wb25lbnQpOwoKICAgICAgICAgIGZ1bmN0aW9uIFNlYXJjaEZvcm0oKSB7CiAgICAgICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgICAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzID0gX0NvbXBvbmVudC5jYWxsLmFwcGx5KF9Db21wb25lbnQsIFt0aGlzXS5jb25jYXQoYXJncykpIHx8IHRoaXM7CgogICAgICAgICAgICBfdGhpcy5kb1NlYXJjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgX3RoaXMkcHJvcHMgPSBfdGhpcy5wcm9wcywKICAgICAgICAgICAgICAgICAgZG9TZWFyY2ggPSBfdGhpcyRwcm9wcy5kb1NlYXJjaCwKICAgICAgICAgICAgICAgICAgZm9ybSA9IF90aGlzJHByb3BzLmZvcm07CiAgICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGZvcm0uZ2V0RmllbGRzVmFsdWUoKTsgLy8g5p+l6K+i5pWw5o2u6L2s5o2iCgogICAgICAgICAgICAgIHZhbHVlcyA9IF90aGlzLmZvcm0gJiYgX3RoaXMuZm9ybS5ub3JtYWxpemUgPyBfdGhpcy5mb3JtLm5vcm1hbGl6ZSh2YWx1ZXMpIDogdmFsdWVzOwogICAgICAgICAgICAgIGRvU2VhcmNoICYmIGRvU2VhcmNoKHZhbHVlcyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBfdGhpcy5kb1Jlc2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBfdGhpcyRwcm9wczIgPSBfdGhpcy5wcm9wcywKICAgICAgICAgICAgICAgICAgZG9TZWFyY2ggPSBfdGhpcyRwcm9wczIuZG9TZWFyY2gsCiAgICAgICAgICAgICAgICAgIGZvcm0gPSBfdGhpcyRwcm9wczIuZm9ybTsKICAgICAgICAgICAgICBmb3JtLnJlc2V0RmllbGRzKCk7CiAgICAgICAgICAgICAgZG9TZWFyY2ggJiYgZG9TZWFyY2goKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX3Byb3RvID0gU2VhcmNoRm9ybS5wcm90b3R5cGU7CgogICAgICAgICAgX3Byb3RvLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgZm9ybSA9IHRoaXMucHJvcHMuZm9ybTsKICAgICAgICAgICAgcmV0dXJuIF9yZWFjdFsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICBjbGFzc05hbWU6ICJzZWFyY2hhYmxlLXRhYmxlLWZvcm0tY29udGVudCIKICAgICAgICAgICAgfSwgX3JlYWN0WyJkZWZhdWx0Il0uY3JlYXRlRWxlbWVudChGb3JtQ29udGVudCwgewogICAgICAgICAgICAgIGZvcm06IGZvcm0sCiAgICAgICAgICAgICAgcmVmOiBmdW5jdGlvbiByZWYoYykgewogICAgICAgICAgICAgICAgaWYgKGMpIF90aGlzMi5mb3JtID0gYzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLCBfcmVhY3RbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAic2VhcmNoYWJsZS10YWJsZS1mb3JtLWJ0bnMiCiAgICAgICAgICAgIH0sIF9yZWFjdFsiZGVmYXVsdCJdLmNyZWF0ZUVsZW1lbnQoX2FudGQuQnV0dG9uLCB7CiAgICAgICAgICAgICAgdHlwZTogInByaW1hcnkiLAogICAgICAgICAgICAgIGNsYXNzTmFtZTogInNlYXJjaC1idG4iLAogICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuZG9TZWFyY2gKICAgICAgICAgICAgfSwgIlx1NjQxQ1x1N0QyMiIpLCBfcmVhY3RbImRlZmF1bHQiXS5jcmVhdGVFbGVtZW50KF9hbnRkLkJ1dHRvbiwgewogICAgICAgICAgICAgIHR5cGU6ICJkZWZhdWx0IiwKICAgICAgICAgICAgICBjbGFzc05hbWU6ICJyZXNldC1idG4iLAogICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuZG9SZXNldAogICAgICAgICAgICB9LCAiXHU5MUNEXHU3RjZFIikpKTsKICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIFNlYXJjaEZvcm07CiAgICAgICAgfShfcmVhY3QuQ29tcG9uZW50KTsKCiAgICAgICAgU2VhcmNoRm9ybS5wcm9wVHlwZXMgPSB7CiAgICAgICAgICBkb1NlYXJjaDogX3Byb3BUeXBlc1siZGVmYXVsdCJdLmZ1bmMuaXNSZXF1aXJlZAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIF9hbnRkLkZvcm0uY3JlYXRlKCkoU2VhcmNoRm9ybSk7CiAgICAgIH0KCiAgICAgIDsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CiAgICAgIC8qKiovCiAgICB9LAogICAgLyogMTE0ICovCgogICAgLyoqKi8KICAgIGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgICAgLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luCiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgICJzZWFyY2hhYmxlLXRhYmxlLWNvbnRhaW5lciI6ICJzZWFyY2hhYmxlLXRhYmxlLWNvbnRhaW5lciIsCiAgICAgICAgInNlYXJjaGFibGVUYWJsZUNvbnRhaW5lciI6ICJzZWFyY2hhYmxlLXRhYmxlLWNvbnRhaW5lciIsCiAgICAgICAgInNlYXJjaGFibGUtdGFibGUtc3BpbiI6ICJzZWFyY2hhYmxlLXRhYmxlLXNwaW4iLAogICAgICAgICJzZWFyY2hhYmxlVGFibGVTcGluIjogInNlYXJjaGFibGUtdGFibGUtc3BpbiIsCiAgICAgICAgInNlYXJjaGFibGUtdGFibGUtZm9ybSI6ICJzZWFyY2hhYmxlLXRhYmxlLWZvcm0iLAogICAgICAgICJzZWFyY2hhYmxlVGFibGVGb3JtIjogInNlYXJjaGFibGUtdGFibGUtZm9ybSIsCiAgICAgICAgInNlYXJjaGFibGUtdGFibGUtZm9ybS1jb250ZW50IjogInNlYXJjaGFibGUtdGFibGUtZm9ybS1jb250ZW50IiwKICAgICAgICAic2VhcmNoYWJsZVRhYmxlRm9ybUNvbnRlbnQiOiAic2VhcmNoYWJsZS10YWJsZS1mb3JtLWNvbnRlbnQiLAogICAgICAgICJzZWFyY2hhYmxlLXRhYmxlLWZvcm0tYnRucyI6ICJzZWFyY2hhYmxlLXRhYmxlLWZvcm0tYnRucyIsCiAgICAgICAgInNlYXJjaGFibGVUYWJsZUZvcm1CdG5zIjogInNlYXJjaGFibGUtdGFibGUtZm9ybS1idG5zIiwKICAgICAgICAic2VhcmNoLWJ0biI6ICJzZWFyY2gtYnRuIiwKICAgICAgICAic2VhcmNoQnRuIjogInNlYXJjaC1idG4iCiAgICAgIH07CiAgICAgIC8qKiovCiAgICB9XSkKICApOwp9KTs="},null]}